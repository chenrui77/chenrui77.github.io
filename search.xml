<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>tomcat占用问题</title>
      <link href="/2022/08/19/tomcat%E5%8D%A0%E7%94%A8/"/>
      <url>/2022/08/19/tomcat%E5%8D%A0%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Microsoft Windows [版本 10.0.19044.2251]<br>(c) Microsoft Corporation。保留所有权利。</p><p>C:\Users\PC&gt;netstat -aon|findstr 9006<br>  TCP    0.0.0.0:9006           0.0.0.0:0              LISTENING       19164<br>  TCP    [::]:9006              [::]:0                 LISTENING       19164</p><p>C:\Users\PC&gt;tasklist|findstr 19164<br>java.exe                     19164 Console                    1    547,712 K</p><p>C:\Users\PC&gt;taskkill /f /t /im java.exe<br>成功: 已终止 PID 21628 (属于 PID 19164 子进程)的进程。<br>成功: 已终止 PID 17388 (属于 PID 22276 子进程)的进程。<br>成功: 已终止 PID 19164 (属于 PID 12676 子进程)的进程。<br>成功: 已终止 PID 22276 (属于 PID 7832 子进程)的进程。</p><p>C:\Users\PC&gt;</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux es环境部署</title>
      <link href="/2022/08/17/linux%20es%E9%83%A8%E7%BD%B2/"/>
      <url>/2022/08/17/linux%20es%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<h1 id="linux-es部署指南"><a href="#linux-es部署指南" class="headerlink" title="linux es部署指南"></a>linux es部署指南</h1><h2 id="1、安装java环境"><a href="#1、安装java环境" class="headerlink" title="1、安装java环境"></a>1、安装java环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum search java|grep jdk</span><br><span class="line">yum -y install java-1.8.0-openjdk</span><br></pre></td></tr></table></figure><h2 id="2、安装es"><a href="#2、安装es" class="headerlink" title="2、安装es"></a>2、安装es</h2><h3 id="2-1下载并解压软件包"><a href="#2-1下载并解压软件包" class="headerlink" title="2.1下载并解压软件包"></a>2.1下载并解压软件包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src/</span><br><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.6-linux-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.6-linux-x86_64.tar.gz.sha512</span><br><span class="line"></span><br><span class="line">shasum -a 512 -c elasticsearch-7.17.6-linux-x86_64.tar.gz.sha512</span><br><span class="line"></span><br><span class="line">tar -xzf elasticsearch-7.17.6-linux-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line">mv elasticsearch-7.17.6 /usr/local/es/</span><br><span class="line"></span><br><span class="line">useradd es</span><br><span class="line"></span><br><span class="line">chown -R es:es /usr/local/es/</span><br><span class="line"></span><br><span class="line">chmod -R 755 /usr/local/es</span><br></pre></td></tr></table></figure><h3 id="2-2、修改配置文件"><a href="#2-2、修改配置文件" class="headerlink" title="2.2、修改配置文件"></a>2.2、修改配置文件</h3><h4 id="2-2-1-编辑jvm-option"><a href="#2-2-1-编辑jvm-option" class="headerlink" title="2.2.1 编辑jvm.option"></a>2.2.1 编辑jvm.option</h4><p>Elasticsearch基于Lucene的，而Lucene底层是java实现，因此我们需要配置jvm参数。编辑jvm.option</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi jvm.options</span><br><span class="line">修改默认配置：-Xms1g -Xmx1g</span><br></pre></td></tr></table></figure><h4 id="2-2-2-编辑elasticsearch-yml"><a href="#2-2-2-编辑elasticsearch-yml" class="headerlink" title="2.2.2 编辑elasticsearch.yml"></a>2.2.2 编辑elasticsearch.yml</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#配置elasticsearch的集群名称</span><br><span class="line">cluster.name: skywalking-es</span><br><span class="line">#配置节点名</span><br><span class="line">node.name: node-1</span><br><span class="line">#设置索引数据的存储路径，默认是es根目录下的data文件夹，可以设置多个存储路径，用逗号隔开</span><br><span class="line">path.data: /usr/local/es/data</span><br><span class="line">#设置日志文件的存储路径，默认是es根目录下的logs文件夹</span><br><span class="line">path.logs: /usr/local/es/logs</span><br><span class="line">#设置bind_host和publish_host，设置为0.0.0.0允许外网访问</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">#http.port设置对外服务的http端口，默认为9200</span><br><span class="line">http.port: 9200</span><br><span class="line"># 配置节点信息（这里我们只有一个节点所以配置了1个）</span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;]</span><br></pre></td></tr></table></figure><h3 id="2-3、修改系统相关配置文件"><a href="#2-3、修改系统相关配置文件" class="headerlink" title="2.3、修改系统相关配置文件"></a>2.3、修改系统相关配置文件</h3><h4 id="2-3-1-修改-etc-security-limits-conf文件"><a href="#2-3-1-修改-etc-security-limits-conf文件" class="headerlink" title="2.3.1 修改/etc/security/limits.conf文件"></a>2.3.1 修改/etc/security/limits.conf文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/security/limits.conf</span><br><span class="line">#在文件最后，增加如下配置：</span><br><span class="line"></span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 65536</span><br></pre></td></tr></table></figure><h4 id="2-3-2-修改-etc-sysctl-conf文件"><a href="#2-3-2-修改-etc-sysctl-conf文件" class="headerlink" title="2.3.2 修改/etc/sysctl.conf文件"></a>2.3.2 修改/etc/sysctl.conf文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>最后添加一行 vm.max_map_count=655360</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure><p>添加完毕之后，执行命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h3 id="2-4-、启动es"><a href="#2-4-、启动es" class="headerlink" title="2.4 、启动es"></a>2.4 、启动es</h3><h4 id="2-4-1-切换到es用户"><a href="#2-4-1-切换到es用户" class="headerlink" title="2.4.1 切换到es用户"></a>2.4.1 切换到es用户</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su es</span><br></pre></td></tr></table></figure><h4 id="2-4-2-启动es"><a href="#2-4-2-启动es" class="headerlink" title="2.4.2 启动es"></a>2.4.2 启动es</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/es/config</span><br><span class="line">../bin/elasticsearch -d</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux常用开发环境部署</title>
      <link href="/2022/08/17/linux%20%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
      <url>/2022/08/17/linux%20%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<p>linux 环境部署</p><h5 id="1-nginx-安装：http-nginx-org-en-download-html"><a href="#1-nginx-安装：http-nginx-org-en-download-html" class="headerlink" title="1 nginx 安装：http://nginx.org/en/download.html"></a>1 nginx 安装：<a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.16.1.tar.gz</span><br></pre></td></tr></table></figure><h5 id="2-jdk安装：https-jdk-java-net-18"><a href="#2-jdk安装：https-jdk-java-net-18" class="headerlink" title="2  jdk安装：https://jdk.java.net/18/"></a>2  jdk安装：<a href="https://jdk.java.net/18/">https://jdk.java.net/18/</a></h5><p>2-2.1 解压文件上传到服务器后解压</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf 上传的jdk压缩包名</span><br></pre></td></tr></table></figure><p>2-2.2  配置环境变量</p><p>​    打开配置文件    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><p>​    追加 wq退出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">JAVA_HOME=/usr/local/java/jdk文件名</span><br><span class="line">CLASSPATH=%JAVA_HOME%/lib:%JAVA_HOME%/jre/lib</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/bin</span><br><span class="line">export PATH CLASSPATH JAVA_HOME</span><br><span class="line"></span><br><span class="line">注意：`/usr/local/java/jdk文件名`中的`jdk文件名`需要改为自己准确的文件名称哦</span><br></pre></td></tr></table></figure><p>2-2.3  使配置文件生效</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>2-2.4  检查是否安装成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><h5 id="3-maven-安装-https-maven-apache-org-download-cgi"><a href="#3-maven-安装-https-maven-apache-org-download-cgi" class="headerlink" title="3 maven 安装  https://maven.apache.org/download.cgi"></a>3 maven 安装  <a href="https://maven.apache.org/download.cgi">https://maven.apache.org/download.cgi</a></h5><p> <a href="https://archive.apache.org/dist/maven/maven-3/">archives</a>  安装其他版本</p><p>3.1 解压</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-maven-3.6.3-bin.tar.gz</span><br></pre></td></tr></table></figure><p>3.2 配置maven仓库，设置阿里镜像仓库，一定要配置一下，国内的下载jar快些，首先进入cd apache-maven-3.6.3目录，创建仓库存储目录，mkdir repository。如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd apache-maven-3.6.3   #进入apache-maven-3.6.3目录</span><br><span class="line">mkdir repository    #创建repository目录</span><br></pre></td></tr></table></figure><p>3.3 进入cd conf目录，编辑 vi settings.xml文件，找到·localRepository下面复制一行加上/usr/local/apache-maven-3.6.3/repository， 在找到mirror 加上阿里的仓库配置，配置完成保存退出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd conf            # 进入conf目录</span><br><span class="line">vi settings.xm # settings.xm文件</span><br><span class="line"></span><br><span class="line">&lt;localRepository&gt;/usr/local/apache-maven-3.6.3/repository&lt;/localRepository&gt;</span><br><span class="line"></span><br><span class="line">&lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;alimaven&lt;/id&gt;</span><br><span class="line">      &lt;name&gt;aliyun maven&lt;/name&gt;</span><br><span class="line">       &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;</span><br><span class="line">      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">&lt;/mirror&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3.4 .配置maven环境变量，编辑：vi /etc/profile 文件，翻到最后一行加上 export MAVEN_HOME=/usr/local/apache-maven-3.6.3 export PATH=P A T H : PATH:PATH:MAVEN_HOME/bin 保存退出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line">export MAVEN_HOME=/usr/local/apache-maven-3.6.3</span><br><span class="line">export PATH=$PATH:$MAVEN_HOME/bin</span><br></pre></td></tr></table></figure><p>3.5 使配置文件生效</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>3.6  测试是否成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -v</span><br></pre></td></tr></table></figure><h5 id="4-mysql-安装-https-downloads-mysql-com-archives-community"><a href="#4-mysql-安装-https-downloads-mysql-com-archives-community" class="headerlink" title="4 mysql 安装 https://downloads.mysql.com/archives/community/"></a>4 mysql 安装 <a href="https://downloads.mysql.com/archives/community/">https://downloads.mysql.com/archives/community/</a></h5><p> 4.1.1首先检查自己电脑有没有安装过mysql，输入如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep mysql </span><br></pre></td></tr></table></figure><p> 4.1.2 如果有则清理干净在安装，输入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whereis mysql</span><br><span class="line">find / -name mysql</span><br></pre></td></tr></table></figure><p> 4.1.3 找到文件夹目录，再把它删除。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /--文件目录</span><br></pre></td></tr></table></figure><p> 4.2.1 然后检查你系统是否自带mariadb，输入如下检查。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep mariadb </span><br></pre></td></tr></table></figure><p> 4.2.2 如果有则需要把它卸载掉，因为会和Mysql引起冲突，输入如下卸载掉。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -e --nodeps mariadb-libs</span><br></pre></td></tr></table></figure><p>开始下载</p><p>1先检查是否有mysql用户组和mysql用户,没有就添加有就忽略：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groups mysql </span><br></pre></td></tr></table></figure><p>2添加用户组和用户 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql &amp;&amp; useradd -r -g mysql mysql  groudel  userdel –删除用户组</span><br></pre></td></tr></table></figure><p>3进入到mysql目录下，先创建data目录用于保存数据文件。输入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir data</span><br></pre></td></tr></table></figure><p>4创建数据目录并赋予权限（返回上级目录）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:mysql /usr/local/mysql  --授权</span><br><span class="line">chmod -R 755 /usr/local/mysql</span><br></pre></td></tr></table></figure><p>然后再进入**<code>bin</code>**目录下，执行初始化安装命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mysqld --initialize --user=mysql --datadir=/usr/local/mysql/data --basedir=/usr/local/mysql</span><br></pre></td></tr></table></figure><p>这里会获得一个初始密码</p><p><img src="C:\Users\PC\AppData\Roaming\Typora\typora-user-images\image-20221031150128543.png" alt="image-20221031150128543"></p><p>如果以上不成功 则需要检查以下插件是否安装成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install numactl</span><br><span class="line">yum install  libaio-devel.x86_64</span><br></pre></td></tr></table></figure><p>尝试启动mysql  以下命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure><p>如果启动出现未出现问题 请检查</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep mysql | grep -v grep</span><br><span class="line">ps -ef|grep mysqld | grep -v grep</span><br></pre></td></tr></table></figure><p>如果有问题 也检查一下 如果存在以上服务 则kill掉</p><p>确认没服务后 执行以下命令启动    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure><p>启动服务成功后</p><p>6 添加软连接，并重启mysql服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql</span><br></pre></td></tr></table></figure><p>7 检查是否成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /etc/init.d/mysql</span><br></pre></td></tr></table></figure><p>8 再添加bin目录的软连接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/chenrui/mysql5.7/bin/mysql /usr/local/bin/mysql</span><br></pre></td></tr></table></figure><p>9  检查是否成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /usr/local/bin/mysql</span><br></pre></td></tr></table></figure><p>10 然后重启服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql restart</span><br></pre></td></tr></table></figure><p>11 登录</p><p>输入生成的随机密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root –p</span><br></pre></td></tr></table></figure><p>修改密码 命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set password for root@localhost = password(‘需要修改的密码’);</span><br></pre></td></tr></table></figure><p> 开放远程连接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;use mysql;</span><br><span class="line">msyql&gt;update user set user.Host=&#x27;%&#x27; where user.User=&#x27;root&#x27;;</span><br><span class="line">mysql&gt;flush privileges;</span><br></pre></td></tr></table></figure><p>设置开机启动</p><p>设置开机自动启动</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1、将服务文件拷贝到init.d下，并重命名为mysql</span><br><span class="line"></span><br><span class="line">[root@localhost /]# cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line">2、赋予可执行权限</span><br><span class="line"></span><br><span class="line">[root@localhost /]# chmod +x /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line">3、添加服务</span><br><span class="line"></span><br><span class="line">[root@localhost /]# chkconfig --add mysqld</span><br><span class="line"></span><br><span class="line">4、显示服务列表</span><br><span class="line"></span><br><span class="line">[root@localhost /]# chkconfig --list</span><br></pre></td></tr></table></figure><p>防火墙添加访问 测试连接完成</p><p><img src="C:\Users\PC\AppData\Roaming\Typora\typora-user-images\image-20221101100002674.png" alt="image-20221101100002674"></p><h5 id="5-tomcat安装-https-downloads-mysql-com-archives-community"><a href="#5-tomcat安装-https-downloads-mysql-com-archives-community" class="headerlink" title="5 tomcat安装 https://downloads.mysql.com/archives/community/"></a>5 tomcat安装 <a href="https://downloads.mysql.com/archives/community/">https://downloads.mysql.com/archives/community/</a></h5><p><strong>1、</strong><em><strong>*下载Linux版本*</strong></em><em><strong>*的Tomcat*</strong></em></p><p>官网下载地址：<a href="https://tomcat.apache.org/download-80.cgi">https://tomcat.apache.org/download-80.cgi</a></p><p><strong>2、</strong><em><strong>*在usr目录下新建tomcat目录，然后将下载的tomcat拷贝到新建的tomcat目录中*</strong></em></p><p>创建目录命令：mkdir /usr/local/tomcat</p><p><strong>3、</strong><em><strong>*进入到tomcat目录中解压下载的tomcat安装包*</strong></em></p><p>解压命令：tar -zxvf apache-tomcat-9.0.82.tar.gz</p><p><strong>4、</strong><em><strong>*配置环境变量*</strong></em></p><p>注意：这里我们配置环境变量的前提是已经安装并配置好了JDK，具体教程：看上面</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">配置命令：vim /etc/profile</span><br><span class="line"></span><br><span class="line">输入上面的命令后，shift+g快速将光标定位到最后一行，然后按i，再输入下面代码</span><br><span class="line"></span><br><span class="line">CATALINA_HOME=/usr/local/tomcat</span><br><span class="line"></span><br><span class="line">填写完代码后按ESC键，输入“:wq”保存并退出编辑页面</span><br></pre></td></tr></table></figure><p><strong>5、</strong><em><strong>*输入下面命令让设置的环境变量生效*</strong></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">生效命令：source /etc/profile</span><br></pre></td></tr></table></figure><p><strong>6、</strong><em><strong>*启动tomcat*</strong></em></p><p>1）第一种启动方法：进入到/usr/tomcat/tomcat8.5/bin目录下，输入以下命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./startup.sh</span><br></pre></td></tr></table></figure><p>2）第二种方法，无论在哪个目录都可以启动tomcat</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh /usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure><p><strong>7、</strong><em><strong>*查看tomcat是否启动成功，输入以下命令查看*</strong></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看命令： ps -ef | grep tomcat</span><br></pre></td></tr></table></figure><p><strong>8、</strong><em><strong>*关闭tomcat*</strong></em></p><p>1）第一种启动方法：进入到/usr/tomcat/tomcat8.5/bin目录下，输入以下命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./shutdown.sh</span><br></pre></td></tr></table></figure><p>2）第二种方法，无论在哪个目录都可以关闭Tomcat</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh /usr/local/tomcat/bin/shutdown.sh</span><br></pre></td></tr></table></figure><p><strong>9、</strong><em><strong>*验证tomcat是否安装成功*</strong></em></p><p>Linux启动tomcat后，我们在浏览器中输入：http:\IP地址:8080 如果出现tomcat的主页则代表安装成功</p><p>提示：如果访问tomcat主页失败，有可能是防火墙没有关闭</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">关闭防火墙命令：</span><br><span class="line"></span><br><span class="line">service iptables stop</span><br><span class="line"></span><br><span class="line">chkconfig iptables off</span><br></pre></td></tr></table></figure><h6 id="Linux下tomcat域名配置"><a href="#Linux下tomcat域名配置" class="headerlink" title="Linux下tomcat域名配置"></a>Linux下tomcat域名配置</h6><p><strong>一、修改Linux hosts文件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line">在文件末尾加入如下这段：</span><br><span class="line">127.0.0.1  www.test.com</span><br></pre></td></tr></table></figure><p><strong>二、需要tomcat的server.xml文件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/tomcat/conf/server.xml</span><br><span class="line"></span><br><span class="line">&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;www.**.com&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;Host name=&quot;www.**.com&quot;  appBase=&quot;webapps&quot;</span><br><span class="line"></span><br><span class="line">&lt;Connector port=&quot;80&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">               connectionTimeout=&quot;20000&quot;</span><br><span class="line">               redirectPort=&quot;443&quot; </span><br><span class="line">   URIEncoding=&quot;utf-8&quot;/&gt;</span><br><span class="line">   </span><br><span class="line">&lt;Connector port=&quot;443&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">               maxThreads=&quot;150&quot; SSLEnabled=&quot;true&quot; scheme=&quot;https&quot; secure=&quot;true&quot;</span><br><span class="line">               clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot; </span><br><span class="line">               keystoreFile=&quot;/app/kaifa/configuration/tomcatKey/cineacloud.cloud.pfx&quot;  </span><br><span class="line">               keystorePass=&quot;z5t09t14mwkr9y0&quot; /&gt; </span><br></pre></td></tr></table></figure><h5 id="6-node环境部署https-nodejs-org-en-download"><a href="#6-node环境部署https-nodejs-org-en-download" class="headerlink" title="6 node环境部署https://nodejs.org/en/download"></a>6 node环境部署<a href="https://nodejs.org/en/download">https://nodejs.org/en/download</a></h5><p>6.1下载指定版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">--下载</span><br><span class="line">wget https://nodejs.org/dist/v16.18.0/node-v16.18.0-linux-x64.tar.xz</span><br><span class="line"></span><br><span class="line">--解压</span><br><span class="line">tar xvf node-v16.18.0-linux-x64.tar.xz</span><br><span class="line"></span><br><span class="line">--更名</span><br><span class="line">mv node-v16.18.0-linux-x64 /usr/local/node</span><br></pre></td></tr></table></figure><p>6.2 设置环境变量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line">// 在打开的文件的最后加上这句话：</span><br><span class="line">export PATH=$PATH:/usr/local/node/bin</span><br></pre></td></tr></table></figure><p>生效</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line">npm -v --查看版本</span><br><span class="line">node-v --查看版本</span><br></pre></td></tr></table></figure><p><strong>配置软连接</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/node/bin/node /usr/local/bin/</span><br><span class="line">ln -s /usr/local/node/bin/npm /usr/local/bin/</span><br></pre></td></tr></table></figure><p><strong>额外知识 查看软连接</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -il</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>swagger2+knife4j(swagger美化)</title>
      <link href="/2022/03/09/swagger+knife4j/"/>
      <url>/2022/03/09/swagger+knife4j/</url>
      
        <content type="html"><![CDATA[<h5 id="swagger-knife4j"><a href="#swagger-knife4j" class="headerlink" title="swagger+knife4j"></a>swagger+knife4j</h5><p>引入依赖</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;knife4j-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.3&lt;/version&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">    &lt;exclusion&gt;</span><br><span class="line">        &lt;artifactId&gt;swagger-annotations&lt;/artifactId&gt;</span><br><span class="line">            &lt;groupId&gt;io.swagger&lt;/groupId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;artifactId&gt;swagger-annotations&lt;/artifactId&gt;</span><br><span class="line">    &lt;groupId&gt;io.swagger&lt;/groupId&gt;</span><br><span class="line">    &lt;version&gt;1.5.22&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line"> &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>添加配置文件 SwaggerConfig.java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">package com.ry.config;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.github.xiaoymin.knife4j.spring.annotations.EnableKnife4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line">import springfox.documentation.builders.PathSelectors;</span><br><span class="line">import springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line">import springfox.documentation.spi.DocumentationType;</span><br><span class="line">import springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line">import springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @创建人 lx_chenrui</span><br><span class="line"> * @创建时间 2022/11/8</span><br><span class="line"> * @描述</span><br><span class="line"> */</span><br><span class="line">@EnableSwagger2</span><br><span class="line">@EnableKnife4j</span><br><span class="line">@Configuration</span><br><span class="line">public class SwaggerConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;server.servlet.context-path&quot;)</span><br><span class="line">    private String contextPath;</span><br><span class="line">    @Value(&quot;$&#123;spring.profiles.active&#125;&quot;)</span><br><span class="line">    private String deployMode;</span><br><span class="line"></span><br><span class="line">    @Bean(value = &quot;defaultApi2&quot;)</span><br><span class="line">    public Docket defaultApi2() &#123;</span><br><span class="line">        Docket docket = new Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(new ApiInfoBuilder()</span><br><span class="line">                        //.title(&quot;swagger-bootstrap-ui-demo RESTful APIs&quot;)</span><br><span class="line">                        .description(&quot;# swagger-bootstrap-ui-demo RESTful APIs&quot;)</span><br><span class="line">                        .version(&quot;1.0&quot;)</span><br><span class="line">                        .build())</span><br><span class="line">                .pathMapping(!deployMode.toLowerCase().equals(&quot;dev&quot;) ? contextPath : &quot;/&quot;)</span><br><span class="line">                //分组名称</span><br><span class="line">                .groupName(&quot;2.X版本&quot;)</span><br><span class="line">                .select()</span><br><span class="line">                //这里指定Controller扫描包路径</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(&quot;com.example.controller&quot;))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">        return docket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动后请求本地即可</p><p><a href="http://localhost:8088/doc.html#/home">http://localhost:8088/doc.html#/home</a></p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20221108161311360.png" alt="image-20221108161311360"></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>索尼a6000拍摄笔记</title>
      <link href="/2022/03/09/%E7%B4%A2%E5%B0%BCa6000%E6%8B%8D%E6%91%84%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/03/09/%E7%B4%A2%E5%B0%BCa6000%E6%8B%8D%E6%91%84%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>因为最近对摄影感兴趣，所以入手了一台索尼a6000,据说是性价比非常高的微单相机，所以打算搜素一些不错的教程和经验放在自己的笔记里面。<br>以防找不到链接或者笔记丢失的问题。本文来自Lorna Tong的文章索尼A6000相机的拍摄技巧笔记，仅作参考使用。</p><p>ISO：白天调100-200，晚上光线差🌃800⬆，或者直接自动。</p><p>拍背景虚化的要领：</p><p>1、开启大光圈，2、开启大变焦，3、尽量把镜头靠近被拍物体，4、尽量让主体离背景远一些。</p><p>逆光用测光模式的点测光</p><p>光圈：</p><p>1、想要背景虚化来突出主体，要尽量使用大光圈，2、想要画面拍清晰，尽量使用小光圈，3，大光圈能有效增加进光量，同时可以加快快门速度，防止因相机抖动导致照片拍糊。</p><p>拍摄🎬一般推荐用A档和S档</p><p>夜景拍摄技巧：</p><p>1、关闭闪光灯，三脚架，A档，ISO100-400，F8.0-16.0，延时自拍功能2秒以上。</p><p>2、关闭闪光灯，无三脚架，S档，快门1/30秒，ISO自动，保持正确拍照姿势。</p><p>3、夜间拍尾灯拉丝星轨，快门10s，F16，利用三脚架。</p><p>如何拍夕阳🌇和日出🌅：A档，F8-16，ISO100-400，调成中间对焦，点测光，对着夕阳周围的区域测光拍摄🎬。不要直接对着太阳或者建筑。要对焦在太阳周围的天空，亮度合适，颜色丰富。</p><p>拍日出建议尽量设置小光圈，有光芒四射效果。相机白平衡调成“阴影”，会更暖色调。</p><p>如何拍剪影；逆光，其他同夕阳，日出。</p><p>拍月亮🌜，M档，快门1/125s，F5.6-8，ISO200，太暗可调大光圈。200mm以上的单反镜头，三脚架。</p><p>拍雪景：备用电池，A档，合理设置光圈，ISO100-400，适当增加曝光补偿。大场景的光圈用F8-16。细微处的小别致雪景用F5.6。曝光补偿+1.5或者2。可以雪景洁白。（雪景占照片比例1/3，就+1，1/2以上的就+1.5或者2）</p><p>拍烟花：找一个拍照绝佳位置，M档，快门3-5s，F8-16，ISO100。不要开变焦，利用三脚架。对着远处夜景对焦。</p><p>第一次半按快门对焦完成后，就赶紧调到手动对焦MF即可。这样后续烟花🎆，只需按全快门拍照即可。前提是拍照位置不变。</p><p>夜景拍人像：A档，设置最大光圈，ISO100-400，拍一张照片，记住光圈，快门，ISO。再调到M档，参数一样，打开闪光灯，设置成单点对焦，并对人脸半按快门对焦拍照。</p><p>市中心繁华、光线好的地方，人物手持手机并将显示调节成白色为主界面给脸部补光。A档，最大光圈，ISO自动，</p><p>注意⚠：50-1.8mm定焦镜头拍人像效果最好。</p><p>抓拍运动员：S档，1/500s以上，连续AF，高速连拍。</p><p>抓拍小孩：S档，1/100s以上的快门，灵活设置ISO自动，连续AF自动对焦，设置为高速连拍。光线亮，关闭闪光灯。</p><p>把宝宝拍的好看，A档，关闭闪光灯，F3.5，ISO自动，自由点对焦，对焦在宝宝的眼睛上。</p><p>拍花卉：SCN-微距，连续自动对焦，如果拍单多就自由点对焦，</p><p>抓拍动态天鹅：S，1/500是，或更快，光线好的ISO400以内，光线较差的就自动AUTO，连续AF自动对焦，高速连拍。</p><p>拍美丽天鹅：A档，ISO100-400，单点对焦，上午九点或下午三点最佳拍摄时间。</p><p>夜间拍花灯：S档，关闭闪光灯，阴天/阴影白平衡，曝光补偿-1/-2。1/30s的快门，ISO自动。</p><p>拍花灯人像：A档，F3.5，ISO自动，单点对焦，夜景人像类似。</p><p>拍蓝天白云：A档，F11或更小，ISO100，焦在云层，广角端拍摄，适当减曝光补偿，选“日光”白平衡，善用偏振镜，适当➕一些地面景物。</p><p>拍光斑：A档，50mm+F5.6，ISO自动，曝光补偿-0.7，MF手动对焦。</p><p>拍搞笑创意照：A档，F8或更小光圈，未变焦时候拍摄，寻找合适角度。</p><p>本文来自微信公众号Lorna Tong的文章索尼A6000相机的拍摄技巧笔记，转载请注明出处。</p>]]></content>
      
      
      <categories>
          
          <category> 摄影 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 摄影 </tag>
            
            <tag> 索尼a6000 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis-plus使用篇</title>
      <link href="/2022/02/22/springboot+mybatisplus/"/>
      <url>/2022/02/22/springboot+mybatisplus/</url>
      
        <content type="html"><![CDATA[<p>MyBatis-plus 是一款 Mybatis 增强工具，用于简化开发，提高效率。下文使用缩写 mp来简化表示 MyBatis-plus，本文主要介绍 mp 搭配 Spring Boot 的使用。</p><p>注：本文使用的 mp 版本是当前最新的3.4.2，早期版本的差异请自行查阅文档</p><p>官方网站：baomidou.com/</p><h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><ol><li><p>创建一个Spring Boot项目，本教程是 mp 搭配 Spring Boot 使用的教程，关于 Spring boot 也发布过很多文字，关注公众号 Java后端，关注后搜索 Spring Boot 即可。</p></li><li><p>导入依赖</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- pom.xml --&gt;</span><br><span class="line">   &lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">   &lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">            xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">       &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line">       &lt;parent&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;<span class="number">2.3</span><span class="number">.4</span>.RELEASE&lt;/version&gt;</span><br><span class="line">           &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">       &lt;/parent&gt;</span><br><span class="line">       &lt;groupId&gt;com.example&lt;/groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;mybatis-plus&lt;/artifactId&gt;</span><br><span class="line">       &lt;version&gt;<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">       &lt;name&gt;mybatis-plus&lt;/name&gt;</span><br><span class="line">       &lt;properties&gt;</span><br><span class="line">           &lt;java.version&gt;<span class="number">1.8</span>&lt;/java.version&gt;</span><br><span class="line">       &lt;/properties&gt;</span><br><span class="line">       &lt;dependencies&gt;</span><br><span class="line">           &lt;dependency&gt;</span><br><span class="line">               &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">           &lt;/dependency&gt;</span><br><span class="line">           &lt;dependency&gt;</span><br><span class="line">               &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">               &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">           &lt;/dependency&gt;</span><br><span class="line">           &lt;dependency&gt;</span><br><span class="line">               &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span><br><span class="line">           &lt;/dependency&gt;</span><br><span class="line">           &lt;dependency&gt;</span><br><span class="line">               &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">               &lt;version&gt;<span class="number">3.4</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">           &lt;/dependency&gt;</span><br><span class="line">           &lt;dependency&gt;</span><br><span class="line">               &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">               &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">           &lt;/dependency&gt;</span><br><span class="line">           &lt;dependency&gt;</span><br><span class="line">               &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">           &lt;/dependency&gt;</span><br><span class="line">       &lt;/dependencies&gt;</span><br><span class="line">       &lt;build&gt;</span><br><span class="line">           &lt;plugins&gt;</span><br><span class="line">               &lt;plugin&gt;</span><br><span class="line">                   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                   &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">               &lt;/plugin&gt;</span><br><span class="line">           &lt;/plugins&gt;</span><br><span class="line">       &lt;/build&gt;</span><br><span class="line">   &lt;/project&gt;</span><br></pre></td></tr></table></figure><ol><li>配置数据库</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># application.yml</span><br><span class="line">   spring:</span><br><span class="line">     datasource:</span><br><span class="line">       driver-<span class="class"><span class="keyword">class</span>-<span class="title">name</span>: <span class="title">com</span>.<span class="title">mysql</span>.<span class="title">cj</span>.<span class="title">jdbc</span>.<span class="title">Driver</span></span></span><br><span class="line"><span class="class">       <span class="title">url</span>: <span class="title">jdbc</span>:<span class="title">mysql</span>://<span class="title">localhost</span>:3306/<span class="title">yogurt</span>?<span class="title">serverTimezone</span></span>=Asia/Shanghai</span><br><span class="line">       username: root</span><br><span class="line">       password: root</span><br><span class="line">       </span><br><span class="line">   mybatis-plus:</span><br><span class="line">     configuration:</span><br><span class="line">       log-impl: org.apache.ibatis.logging.stdout.StdOutImpl #开启SQL语句打印</span><br></pre></td></tr></table></figure><ol><li>创建一个实体类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.po;</span><br><span class="line">   <span class="keyword">import</span> lombok.Data;</span><br><span class="line">   <span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line">   <span class="meta">@Data</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Long managerId;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol><li>创建一个mapper接口</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.mappers;</span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line">   <span class="keyword">import</span> com.example.mp.po.User;</span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123; &#125;</span><br></pre></td></tr></table></figure><ol><li>在SpringBoot启动类上配置mapper接口的扫描路径</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp;</span><br><span class="line">   <span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">   <span class="meta">@SpringBootApplication</span></span><br><span class="line">   <span class="meta">@MapperScan(&quot;com.example.mp.mappers&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">     SpringApplication.run(MybatisPlusApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol><li>在数据库中创建表</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS user;</span><br><span class="line">   <span class="function">CREATE TABLE <span class="title">user</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">   id BIGINT(<span class="number">20</span>)</span> PRIMARY KEY NOT NULL COMMENT &#x27;主键&#x27;,</span></span><br><span class="line"><span class="function">   name <span class="title">VARCHAR</span><span class="params">(<span class="number">30</span>)</span> DEFAULT NULL COMMENT &#x27;姓名&#x27;,</span></span><br><span class="line"><span class="function">   age <span class="title">INT</span><span class="params">(<span class="number">11</span>)</span> DEFAULT NULL COMMENT &#x27;年龄&#x27;,</span></span><br><span class="line"><span class="function">   email <span class="title">VARCHAR</span><span class="params">(<span class="number">50</span>)</span> DEFAULT NULL COMMENT &#x27;邮箱&#x27;,</span></span><br><span class="line"><span class="function">   manager_id <span class="title">BIGINT</span><span class="params">(<span class="number">20</span>)</span> DEFAULT NULL COMMENT &#x27;直属上级id&#x27;,</span></span><br><span class="line"><span class="function">   create_time DATETIME DEFAULT NULL COMMENT &#x27;创建时间&#x27;,</span></span><br><span class="line"><span class="function">   CONSTRAINT manager_fk FOREIGN <span class="title">KEY</span><span class="params">(manager_id)</span> REFERENCES <span class="title">user</span> <span class="params">(id)</span></span></span><br><span class="line"><span class="function">   ) ENGINE</span>=INNODB CHARSET=UTF8;</span><br><span class="line">   </span><br><span class="line">   <span class="function">INSERT INTO <span class="title">user</span> <span class="params">(id, name, age ,email, manager_id, create_time)</span> <span class="title">VALUES</span></span></span><br><span class="line"><span class="function">   <span class="params">(<span class="number">1</span>, <span class="string">&#x27;大BOSS&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;boss@baomidou.com&#x27;</span>, NULL, <span class="string">&#x27;2021-03-22 09:48:00&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function">   <span class="params">(<span class="number">2</span>, <span class="string">&#x27;李经理&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;boss@baomidou.com&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;2021-01-22 09:48:00&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function">   <span class="params">(<span class="number">3</span>, <span class="string">&#x27;黄主管&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;boss@baomidou.com&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;2021-01-22 09:48:00&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function">   <span class="params">(<span class="number">4</span>, <span class="string">&#x27;吴组长&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;boss@baomidou.com&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;2021-02-22 09:48:00&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function">   <span class="params">(<span class="number">5</span>, <span class="string">&#x27;小菜&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;boss@baomidou.com&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;2021-02-22 09:48:00&#x27;</span>)</span></span></span><br></pre></td></tr></table></figure><ol><li>编写一个SpringBoot测试类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp;</span><br><span class="line">   <span class="keyword">import</span> com.example.mp.mappers.UserMapper;</span><br><span class="line">   <span class="keyword">import</span> com.example.mp.po.User;</span><br><span class="line">   <span class="keyword">import</span> org.junit.Test;</span><br><span class="line">   <span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">   <span class="keyword">import</span> java.util.List;</span><br><span class="line">   <span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line">   <span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line">   <span class="meta">@SpringBootTest</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper mapper;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     List&lt;User&gt; list = mapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">     assertEquals(<span class="number">5</span>, list.size());</span><br><span class="line">     list.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>准备工作完成，数据库情况如下：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/670.jpg" alt="670"></p><p>项目目录如下：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/640.jpg" alt="640"></p><p>运行测试类</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p>可以看到，针对单表的基本CRUD操作，只需要创建好实体类，并创建一个继承自<code>BaseMapper</code>的接口即可，可谓非常简洁。并且，我们注意到，<code>User</code>类中的<code>managerId</code>，<code>createTime</code>属性，自动和数据库表中的<code>manager_id</code>，<code>create_time</code>对应了起来，这是因为mp自动做了数据库下划线命名，到Java类的驼峰命名之间的转化。</p><h2 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h2><h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p>mp一共提供了8个注解，这些注解是用在Java的实体类上面的。</p><ul><li><p><code>@TableName</code></p><p>注解在类上，指定类和数据库表的映射关系。<strong>实体类的类名（转成小写后）和数据库表名相同时</strong>，可以不指定该注解。</p></li><li><p><code>@TableId</code></p><p>注解在实体类的某一字段上，<strong>表示这个字段对应数据库表的主键</strong>。当主键名为id时（表中列名为id，实体类中字段名为id），无需使用该注解显式指定主键，mp会自动关联。若类的字段名和表的列名不一致，可用<code>value</code>属性指定表的列名。另，这个注解有个重要的属性<code>type</code>，用于指定主键策略。</p></li><li><p><code>@TableField</code></p><p>注解在某一字段上，指定Java实体类的字段和数据库表的列的映射关系。这个注解有如下几个应用场景。</p></li><li><ul><li><p><strong>排除非表字段</strong></p><p>若Java实体类中某个字段，不对应表中的任何列，它只是用于保存一些额外的，或组装后的数据，则可以设置<code>exist</code>属性为<code>false</code>，这样在对实体对象进行插入时，会忽略这个字段。排除非表字段也可以通过其他方式完成，如使用<code>static</code>或<code>transient</code>关键字，但个人觉得不是很合理，不做赘述</p></li><li><p><strong>字段验证策略</strong></p><p>通过<code>insertStrategy</code>，<code>updateStrategy</code>，<code>whereStrategy</code>属性进行配置，可以控制在实体对象进行插入，更新，或作为WHERE条件时，对象中的字段要如何组装到SQL语句中。</p></li><li><p><strong>字段填充策略</strong></p><p>通过<code>fill</code>属性指定，字段为空时会进行自动填充</p></li></ul></li><li><p><code>@Version</code></p><p>乐观锁注解</p></li><li><p><code>@EnumValue</code></p><p>注解在枚举字段上</p></li><li><p><code>@TableLogic</code></p><p>逻辑删除</p></li><li><p><code>KeySequence</code></p><p>序列主键策略（<code>oracle</code>）</p></li><li><p><code>InterceptorIgnore</code></p><p>插件过滤规则</p></li></ul><h3 id="CRUD接口"><a href="#CRUD接口" class="headerlink" title="CRUD接口"></a>CRUD接口</h3><p>mp封装了一些最基础的CRUD方法，只需要直接继承mp提供的接口，无需编写任何SQL，即可食用。mp提供了两套接口，分别是Mapper CRUD接口和Service CRUD接口。并且mp还提供了条件构造器<code>Wrapper</code>，可以方便地组装SQL语句中的WHERE条件。</p><h4 id="Mapper-CRUD接口"><a href="#Mapper-CRUD接口" class="headerlink" title="Mapper CRUD接口"></a>Mapper CRUD接口</h4><p>只需定义好实体类，然后创建一个接口，继承mp提供的<code>BaseMapper</code>，即可食用。mp会在mybatis启动时，自动解析实体类和表的映射关系，并注入带有通用CRUD方法的mapper。<code>BaseMapper</code>里提供的方法，部分列举如下：</p><ul><li><code>insert(T entity)</code> 插入一条记录</li><li><code>deleteById(Serializable id)</code> 根据主键id删除一条记录</li><li><code>delete(Wrapper&lt;T&gt; wrapper)</code> 根据条件构造器wrapper进行删除</li><li><code>selectById(Serializable id)</code> 根据主键id进行查找</li><li><code>selectBatchIds(Collection idList)</code> 根据主键id进行批量查找</li><li><code>selectByMap(Map&lt;String,Object&gt; map)</code> 根据map中指定的列名和列值进行<strong>等值匹配</strong>查找</li><li><code>selectMaps(Wrapper&lt;T&gt; wrapper)</code> 根据 wrapper 条件，查询记录，将查询结果封装为一个Map，Map的key为结果的列，value为值</li><li><code>selectList(Wrapper&lt;T&gt; wrapper)</code> 根据条件构造器<code>wrapper</code>进行查询</li><li><code>update(T entity, Wrapper&lt;T&gt; wrapper)</code> 根据条件构造器<code>wrapper</code>进行更新</li><li><code>updateById(T entity)</code></li><li>…</li></ul><p>下面讲解几个比较特别的方法</p><h6 id="selectMaps"><a href="#selectMaps" class="headerlink" title="selectMaps"></a>selectMaps</h6><p><code>BaseMapper</code>接口还提供了一个<code>selectMaps</code>方法，这个方法会将查询结果封装为一个Map，Map的key为结果的列，value为值</p><p>该方法的使用场景如下：</p><ul><li><p><strong>只查部分列</strong></p><p>当某个表的列特别多，而SELECT的时候只需要选取个别列，查询出的结果也没必要封装成Java实体类对象时（只查部分列时，封装成实体后，实体对象中的很多属性会是null），则可以用<code>selectMaps</code>，获取到指定的列后，再自行进行处理即可</p><p>比如</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.select(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;email&quot;</span>).likeRight(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;黄&quot;</span>);</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; maps = userMapper.selectMaps(wrapper);</span><br><span class="line">    maps.forEach(System.out::println);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><ul><li><p><strong>进行数据统计</strong></p><p>比如</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按照直属上级进行分组，查询每组的平均年龄，最大年龄，最小年龄</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  select avg(age) avg_age ,min(age) min_age, max(age) max_age from user group by manager_id having sum(age) &lt; 500;</span></span><br><span class="line"><span class="comment">  **/</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">   wrapper.select(<span class="string">&quot;manager_id&quot;</span>, <span class="string">&quot;avg(age) avg_age&quot;</span>, <span class="string">&quot;min(age) min_age&quot;</span>, <span class="string">&quot;max(age) max_age&quot;</span>)</span><br><span class="line">     .groupBy(<span class="string">&quot;manager_id&quot;</span>).having(<span class="string">&quot;sum(age) &lt; &#123;0&#125;&quot;</span>, <span class="number">500</span>);</span><br><span class="line">   List&lt;Map&lt;String, Object&gt;&gt; maps = userMapper.selectMaps(wrapper);</span><br><span class="line">   maps.forEach(System.out::println);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><h6 id="selectObjs"><a href="#selectObjs" class="headerlink" title="selectObjs"></a>selectObjs</h6><p>只会返回第一个字段（第一列）的值，其他字段会被舍弃</p><p>比如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">  wrapper.select(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>).like(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;黄&quot;</span>);</span><br><span class="line">  List&lt;Object&gt; objects = userMapper.selectObjs(wrapper);</span><br><span class="line">  objects.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>得到的结果，只封装了第一列的id</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><h6 id="selectCount"><a href="#selectCount" class="headerlink" title="selectCount"></a>selectCount</h6><p>查询满足条件的总数，注意，使用这个方法，不能调用<code>QueryWrapper</code>的<code>select</code>方法设置要查询的列了。这个方法会自动添加<code>select count(1)</code></p><p>比如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">  wrapper.like(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;黄&quot;</span>);</span><br><span class="line"></span><br><span class="line">  Integer count = userMapper.selectCount(wrapper);</span><br><span class="line">  System.out.println(count);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/641.jpg" alt="641"></p><h4 id="Service-CRUD-接口"><a href="#Service-CRUD-接口" class="headerlink" title="Service CRUD 接口"></a>Service CRUD 接口</h4><p>另外一套CRUD是Service层的，只需要编写一个接口，继承<code>IService</code>，并创建一个接口实现类，即可食用。（这个接口提供的CRUD方法，和Mapper接口提供的功能大同小异，<strong>比较明显的区别在于</strong><strong><code>IService</code>支持了更多的批量化操作</strong>，如<code>saveBatch</code>，<code>saveOrUpdateBatch</code>等方法。</p><p>食用示例如下</p><p>\1. 首先，新建一个接口，继承<code>IService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.service;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line">   <span class="keyword">import</span> com.example.mp.po.User;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>创建这个接口的实现类，并继承<code>ServiceImpl</code>，最后打上<code>@Service</code>注解，注册到Spring容器中，即可食用</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.service.impl;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line">   <span class="keyword">import</span> com.example.mp.mappers.UserMapper;</span><br><span class="line">   <span class="keyword">import</span> com.example.mp.po.User;</span><br><span class="line">   <span class="keyword">import</span> com.example.mp.service.UserService;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Service</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">UserMapper</span>, <span class="title">User</span>&gt; <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>测试代码</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.Wrappers;</span><br><span class="line">   <span class="keyword">import</span> com.example.mp.po.User;</span><br><span class="line">   <span class="keyword">import</span> com.example.mp.service.UserService;</span><br><span class="line">   <span class="keyword">import</span> org.junit.Test;</span><br><span class="line">   <span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">   <span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line">   <span class="meta">@SpringBootTest</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     LambdaQueryWrapper&lt;User&gt; wrapper = Wrappers.&lt;User&gt;lambdaQuery();</span><br><span class="line">     wrapper.gt(User::getAge, <span class="number">28</span>);</span><br><span class="line">     User one = userService.getOne(wrapper, <span class="keyword">false</span>); <span class="comment">// 第二参数指定为false,使得在查到了多行记录时,不抛出异常,而返回第一条记录</span></span><br><span class="line">     System.out.println(one);</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>结果</li></ol><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p>另，<code>IService</code>也支持链式调用，代码写起来非常简洁，查询示例如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  List&lt;User&gt; list = userService.lambdaQuery()</span><br><span class="line">    .gt(User::getAge, <span class="number">39</span>)</span><br><span class="line">    .likeRight(User::getName, <span class="string">&quot;王&quot;</span>)</span><br><span class="line">    .list();</span><br><span class="line">  list.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p>更新示例如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  userService.lambdaUpdate()</span><br><span class="line">    .gt(User::getAge, <span class="number">39</span>)</span><br><span class="line">    .likeRight(User::getName, <span class="string">&quot;王&quot;</span>)</span><br><span class="line">    .set(User::getEmail, <span class="string">&quot;w39@baomidou.com&quot;</span>)</span><br><span class="line">    .update();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p>删除示例如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  userService.lambdaUpdate()</span><br><span class="line">    .like(User::getName, <span class="string">&quot;青蛙&quot;</span>)</span><br><span class="line">    .remove();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><h3 id="条件构造器"><a href="#条件构造器" class="headerlink" title="条件构造器"></a>条件构造器</h3><p>mp让我觉得极其方便的一点在于其提供了强大的条件构造器<code>Wrapper</code>，可以非常方便的构造WHERE条件。条件构造器主要涉及到3个类，<code>AbstractWrapper</code>。<code>QueryWrapper</code>，<code>UpdateWrapper</code>，它们的类关系如下</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/642.jpg" alt="642"></p><p>在<code>AbstractWrapper</code>中提供了非常多的方法用于构建WHERE条件，而<code>QueryWrapper</code>针对<code>SELECT</code>语句，提供了<code>select()</code>方法，可自定义需要查询的列，而<code>UpdateWrapper</code>针对<code>UPDATE</code>语句，提供了<code>set()</code>方法，用于构造<code>set</code>语句。条件构造器也支持lambda表达式，写起来非常舒爽。</p><p>下面对<code>AbstractWrapper</code>中用于构建SQL语句中的WHERE条件的方法进行部分列举</p><ul><li><code>eq</code>：equals，等于</li><li><code>allEq</code>：all equals，全等于</li><li><code>ne</code>：not equals，不等于</li><li><code>gt</code>：greater than ，大于 <code>&gt;</code></li><li><code>ge</code>：greater than or equals，大于等于<code>≥</code></li><li><code>lt</code>：less than，小于<code>&lt;</code></li><li><code>le</code>：less than or equals，小于等于<code>≤</code></li><li><code>between</code>：相当于SQL中的BETWEEN</li><li><code>notBetween</code></li><li><code>like</code>：模糊匹配。<code>like(&quot;name&quot;,&quot;黄&quot;)</code>，相当于SQL的<code>name like &#39;%黄%&#39;</code></li><li><code>likeRight</code>：模糊匹配右半边。<code>likeRight(&quot;name&quot;,&quot;黄&quot;)</code>，相当于SQL的<code>name like &#39;黄%&#39;</code></li><li><code>likeLeft</code>：模糊匹配左半边。<code>likeLeft(&quot;name&quot;,&quot;黄&quot;)</code>，相当于SQL的<code>name like &#39;%黄&#39;</code></li><li><code>notLike</code>：<code>notLike(&quot;name&quot;,&quot;黄&quot;)</code>，相当于SQL的<code>name not like &#39;%黄%&#39;</code></li><li><code>isNull</code></li><li><code>isNotNull</code></li><li><code>in</code></li><li><code>and</code>：SQL连接符AND</li><li><code>or</code>：SQL连接符OR</li><li><code>apply</code>：用于拼接SQL，该方法可用于数据库函数，并可以动态传参</li><li>…….</li></ul><h4 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h4><p>下面通过一些具体的案例来练习条件构造器的使用。（使用前文创建的<code>user</code>表）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 案例先展示需要完成的SQL语句，后展示Wrapper的写法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 名字中包含佳，且年龄小于25</span></span><br><span class="line"><span class="comment">// SELECT * FROM user WHERE name like &#x27;%佳%&#x27; AND age &lt; 25</span></span><br><span class="line">QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">wrapper.like(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;佳&quot;</span>).lt(<span class="string">&quot;age&quot;</span>, <span class="number">25</span>);</span><br><span class="line">List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line"><span class="comment">// 下面展示SQL时，仅展示WHERE条件；展示代码时, 仅展示Wrapper构建部分</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 姓名为黄姓，且年龄大于等于20，小于等于40，且email字段不为空</span></span><br><span class="line"><span class="comment">// name like &#x27;黄%&#x27; AND age BETWEEN 20 AND 40 AND email is not null</span></span><br><span class="line">wrapper.likeRight(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;黄&quot;</span>).between(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>, <span class="number">40</span>).isNotNull(<span class="string">&quot;email&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 姓名为黄姓，或者年龄大于等于40，按照年龄降序排列，年龄相同则按照id升序排列</span></span><br><span class="line"><span class="comment">// name like &#x27;黄%&#x27; OR age &gt;= 40 order by age desc, id asc</span></span><br><span class="line">wrapper.likeRight(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;黄&quot;</span>).or().ge(<span class="string">&quot;age&quot;</span>,<span class="number">40</span>).orderByDesc(<span class="string">&quot;age&quot;</span>).orderByAsc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.创建日期为2021年3月22日，并且直属上级的名字为李姓</span></span><br><span class="line"><span class="comment">// date_format(create_time,&#x27;%Y-%m-%d&#x27;) = &#x27;2021-03-22&#x27; AND manager_id IN (SELECT id FROM user WHERE name like &#x27;李%&#x27;)</span></span><br><span class="line">wrapper.apply(<span class="string">&quot;date_format(create_time, &#x27;%Y-%m-%d&#x27;) = &#123;0&#125;&quot;</span>, <span class="string">&quot;2021-03-22&quot;</span>) <span class="comment">// 建议采用&#123;index&#125;这种方式动态传参, 可防止SQL注入</span></span><br><span class="line">    .inSql(<span class="string">&quot;manager_id&quot;</span>, <span class="string">&quot;SELECT id FROM user WHERE name like &#x27;李%&#x27;&quot;</span>);</span><br><span class="line"><span class="comment">// 上面的apply, 也可以直接使用下面这种方式做字符串拼接，但当这个日期是一个外部参数时，这种方式有SQL注入的风险</span></span><br><span class="line">wrapper.apply(<span class="string">&quot;date_format(create_time, &#x27;%Y-%m-%d&#x27;) = &#x27;2021-03-22&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 名字为王姓，并且（年龄小于40，或者邮箱不为空）</span></span><br><span class="line"><span class="comment">// name like &#x27;王%&#x27; AND (age &lt; 40 OR email is not null)</span></span><br><span class="line">wrapper.likeRight(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>).and(q -&gt; q.lt(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>).or().isNotNull(<span class="string">&quot;email&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 名字为王姓，或者（年龄小于40并且年龄大于20并且邮箱不为空）</span></span><br><span class="line"><span class="comment">// name like &#x27;王%&#x27; OR (age &lt; 40 AND age &gt; 20 AND email is not null)</span></span><br><span class="line">wrapper.likeRight(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>).or(</span><br><span class="line">    q -&gt; q.lt(<span class="string">&quot;age&quot;</span>,<span class="number">40</span>)</span><br><span class="line">      .gt(<span class="string">&quot;age&quot;</span>,<span class="number">20</span>)</span><br><span class="line">      .isNotNull(<span class="string">&quot;email&quot;</span>)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. (年龄小于40或者邮箱不为空) 并且名字为王姓</span></span><br><span class="line"><span class="comment">// (age &lt; 40 OR email is not null) AND name like &#x27;王%&#x27;</span></span><br><span class="line">wrapper.nested(q -&gt; q.lt(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>).or().isNotNull(<span class="string">&quot;email&quot;</span>))</span><br><span class="line">    .likeRight(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. 年龄为30，31，34，35</span></span><br><span class="line"><span class="comment">// age IN (30,31,34,35)</span></span><br><span class="line">wrapper.in(<span class="string">&quot;age&quot;</span>, Arrays.asList(<span class="number">30</span>,<span class="number">31</span>,<span class="number">34</span>,<span class="number">35</span>));</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line">wrapper.inSql(<span class="string">&quot;age&quot;</span>,<span class="string">&quot;30,31,34,35&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 9. 年龄为30，31，34，35, 返回满足条件的第一条记录</span></span><br><span class="line"><span class="comment">// age IN (30,31,34,35) LIMIT 1</span></span><br><span class="line">wrapper.in(<span class="string">&quot;age&quot;</span>, Arrays.asList(<span class="number">30</span>,<span class="number">31</span>,<span class="number">34</span>,<span class="number">35</span>)).last(<span class="string">&quot;LIMIT 1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10. 只选出id, name 列 (QueryWrapper 特有)</span></span><br><span class="line"><span class="comment">// SELECT id, name FROM user;</span></span><br><span class="line">wrapper.select(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 11. 选出id, name, age, email, 等同于排除 manager_id 和 create_time</span></span><br><span class="line"><span class="comment">// 当列特别多, 而只需要排除个别列时, 采用上面的方式可能需要写很多个列, 可以采用重载的select方法，指定需要排除的列</span></span><br><span class="line">wrapper.select(User.class, info -&gt; &#123;</span><br><span class="line">   String columnName = info.getColumn();</span><br><span class="line">   <span class="keyword">return</span> !<span class="string">&quot;create_time&quot;</span>.equals(columnName) &amp;&amp; !<span class="string">&quot;manager_id&quot;</span>.equals(columnName);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h4 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h4><p>条件构造器的诸多方法中，均可以指定一个<code>boolean</code>类型的参数<code>condition</code>，用来决定该条件是否加入最后生成的WHERE语句中，比如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String name = <span class="string">&quot;黄&quot;</span>; <span class="comment">// 假设name变量是一个外部传入的参数</span></span><br><span class="line">QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">wrapper.like(StringUtils.hasText(name), <span class="string">&quot;name&quot;</span>, name);</span><br><span class="line"><span class="comment">// 仅当 StringUtils.hasText(name) 为 true 时, 会拼接这个like语句到WHERE中</span></span><br><span class="line"><span class="comment">// 其实就是对下面代码的简化</span></span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasText(name)) &#123;</span><br><span class="line"> wrapper.like(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="实体对象作为条件"><a href="#实体对象作为条件" class="headerlink" title="实体对象作为条件"></a>实体对象作为条件</h4><p>调用构造函数创建一个<code>Wrapper</code>对象时，可以传入一个实体对象。后续使用这个<code>Wrapper</code>时，会以实体对象中的非空属性，构建WHERE条件（默认构建<strong>等值匹配</strong>的WHERE条件，这个行为可以通过实体类里各个字段上的<code>@TableField</code>注解中的<code>condition</code>属性进行改变）</p><p>示例如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  User user = <span class="keyword">new</span> User();</span><br><span class="line">  user.setName(<span class="string">&quot;黄主管&quot;</span>);</span><br><span class="line">  user.setAge(<span class="number">28</span>);</span><br><span class="line">  QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;(user);</span><br><span class="line">  List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">  users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>执行结果如下。可以看到，是根据实体对象中的非空属性，进行了<strong>等值匹配查询</strong>。</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/643.jpg" alt="643"></p><p>若希望针对某些属性，改变<strong>等值匹配</strong>的行为，则可以在实体类中用<code>@TableField</code>注解进行配置，示例如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.po;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.SqlCondition;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> Long id;</span><br><span class="line"> <span class="meta">@TableField(condition = SqlCondition.LIKE)</span> <span class="comment">// 配置该字段使用like进行拼接</span></span><br><span class="line"> <span class="keyword">private</span> String name;</span><br><span class="line"> <span class="keyword">private</span> Integer age;</span><br><span class="line"> <span class="keyword">private</span> String email;</span><br><span class="line"> <span class="keyword">private</span> Long managerId;</span><br><span class="line"> <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行下面的测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  User user = <span class="keyword">new</span> User();</span><br><span class="line">  user.setName(<span class="string">&quot;黄&quot;</span>);</span><br><span class="line">  QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;(user);</span><br><span class="line">  List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">  users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>从下图得到的结果来看，对于实体对象中的<code>name</code>字段，采用了<code>like</code>进行拼接</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p><code>@TableField</code>中配置的<code>condition</code>属性实则是一个字符串，<code>SqlCondition</code>类中预定义了一些字符串以供选择</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.baomidou.mybatisplus.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlCondition</span> </span>&#123;</span><br><span class="line">    <span class="comment">//下面的字符串中, %s 是占位符, 第一个 %s 是列名, 第二个 %s 是列的值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EQUAL = <span class="string">&quot;%s=#&#123;%s&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NOT_EQUAL = <span class="string">&quot;%s&amp;lt;&amp;gt;#&#123;%s&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LIKE = <span class="string">&quot;%s LIKE CONCAT(&#x27;%%&#x27;,#&#123;%s&#125;,&#x27;%%&#x27;)&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LIKE_LEFT = <span class="string">&quot;%s LIKE CONCAT(&#x27;%%&#x27;,#&#123;%s&#125;)&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LIKE_RIGHT = <span class="string">&quot;%s LIKE CONCAT(#&#123;%s&#125;,&#x27;%%&#x27;)&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>SqlCondition</code>中提供的配置比较有限，当我们需要<code>&lt;</code>或<code>&gt;</code>等拼接方式，则需要自己定义。比如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.po;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.SqlCondition;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> Long id;</span><br><span class="line"> <span class="meta">@TableField(condition = SqlCondition.LIKE)</span></span><br><span class="line"> <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(condition = &quot;%s &amp;gt; #&#123;%s&#125;&quot;)</span> <span class="comment">// 这里相当于大于, 其中 &amp;gt; 是字符实体</span></span><br><span class="line"> <span class="keyword">private</span> Integer age;</span><br><span class="line"> <span class="keyword">private</span> String email;</span><br><span class="line"> <span class="keyword">private</span> Long managerId;</span><br><span class="line"> <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  User user = <span class="keyword">new</span> User();</span><br><span class="line">  user.setName(<span class="string">&quot;黄&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">30</span>);</span><br><span class="line">  QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;(user);</span><br><span class="line">  List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">  users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>从下图得到的结果，可以看出，<code>name</code>属性是用<code>like</code>拼接的，而<code>age</code>属性是用<code>&gt;</code>拼接的</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><h4 id="allEq方法"><a href="#allEq方法" class="headerlink" title="allEq方法"></a>allEq方法</h4><p>allEq方法传入一个<code>map</code>，用来做等值匹配</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">  Map&lt;String, Object&gt; param = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  param.put(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>);</span><br><span class="line">  param.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;黄飞飞&quot;</span>);</span><br><span class="line">  wrapper.allEq(param);</span><br><span class="line">  List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">  users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p>当allEq方法传入的Map中有value为<code>null</code>的元素时，默认会设置为<code>is null</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">  Map&lt;String, Object&gt; param = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  param.put(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>);</span><br><span class="line">  param.put(<span class="string">&quot;name&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">  wrapper.allEq(param);</span><br><span class="line">  List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">  users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p>若想忽略map中value为<code>null</code>的元素，可以在调用allEq时，设置参数<code>boolean null2IsNull</code>为<code>false</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">  Map&lt;String, Object&gt; param = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  param.put(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>);</span><br><span class="line">  param.put(<span class="string">&quot;name&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">  wrapper.allEq(param, <span class="keyword">false</span>);</span><br><span class="line">  List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">  users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/644.jpg" alt="644"></p><p>若想要在执行allEq时，过滤掉Map中的某些元素，可以调用allEq的重载方法<code>allEq(BiPredicate&lt;R, V&gt; filter, Map&lt;R, V&gt; params)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">  Map&lt;String, Object&gt; param = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  param.put(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>);</span><br><span class="line">  param.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;黄飞飞&quot;</span>);</span><br><span class="line">  wrapper.allEq((k,v) -&gt; !<span class="string">&quot;name&quot;</span>.equals(k), param); <span class="comment">// 过滤掉map中key为name的元素</span></span><br><span class="line">  List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">  users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/645.jpg" alt="645"></p><h4 id="lambda条件构造器"><a href="#lambda条件构造器" class="headerlink" title="lambda条件构造器"></a>lambda条件构造器</h4><p>lambda条件构造器，支持lambda表达式，可以不必像普通条件构造器一样，以字符串形式指定列名，它可以直接以实体类的<strong>方法引用</strong>来指定列。示例如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLambda</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">  wrapper.like(User::getName, <span class="string">&quot;黄&quot;</span>).lt(User::getAge, <span class="number">30</span>);</span><br><span class="line">  List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">  users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p>像普通的条件构造器，列名是用字符串的形式指定，无法在编译期进行列名合法性的检查，这就不如lambda条件构造器来的优雅。</p><p>另外，还有个<strong>链式lambda条件构造器</strong>，使用示例如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLambda</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  LambdaQueryChainWrapper&lt;User&gt; chainWrapper = <span class="keyword">new</span> LambdaQueryChainWrapper&lt;&gt;(userMapper);</span><br><span class="line">  List&lt;User&gt; users = chainWrapper.like(User::getName, <span class="string">&quot;黄&quot;</span>).gt(User::getAge, <span class="number">30</span>).list();</span><br><span class="line">  users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><h3 id="更新操作"><a href="#更新操作" class="headerlink" title="更新操作"></a>更新操作</h3><p>上面介绍的都是查询操作,现在来讲更新和删除操作。</p><p><code>BaseMapper</code>中提供了2个更新方法</p><ul><li><p><code>updateById(T entity)</code></p><p>根据入参<code>entity</code>的<code>id</code>（主键）进行更新，对于<code>entity</code>中非空的属性，会出现在UPDATE语句的SET后面，即<code>entity</code>中非空的属性，会被更新到数据库，示例如下</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line">  <span class="meta">@SpringBootTest</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdateTest</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setId(<span class="number">2L</span>);</span><br><span class="line">    user.setAge(<span class="number">18</span>);</span><br><span class="line">    userMapper.updateById(user);</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><ul><li><p><code>update(T entity, Wrapper&lt;T&gt; wrapper)</code></p><p>根据实体<code>entity</code>和条件构造器<code>wrapper</code>进行更新，示例如下</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">&quot;王三蛋&quot;</span>);</span><br><span class="line">    LambdaUpdateWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> LambdaUpdateWrapper&lt;&gt;();</span><br><span class="line">    wrapper.between(User::getAge, <span class="number">26</span>,<span class="number">31</span>).likeRight(User::getName,<span class="string">&quot;吴&quot;</span>);</span><br><span class="line">    userMapper.update(user, wrapper);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p>额外演示一下，把实体对象传入<code>Wrapper</code>，即用实体对象构造WHERE条件的案例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User whereUser = <span class="keyword">new</span> User();</span><br><span class="line">    whereUser.setAge(<span class="number">40</span>);</span><br><span class="line">    whereUser.setName(<span class="string">&quot;王&quot;</span>);</span><br><span class="line">  </span><br><span class="line">    LambdaUpdateWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> LambdaUpdateWrapper&lt;&gt;(whereUser);</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setEmail(<span class="string">&quot;share@baomidou.com&quot;</span>);</span><br><span class="line">    user.setManagerId(<span class="number">10L</span>);</span><br><span class="line">  </span><br><span class="line">    userMapper.update(user, wrapper);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>注意到我们的User类中，对<code>name</code>属性和<code>age</code>属性进行了如下的设置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> Long id;</span><br><span class="line"> <span class="meta">@TableField(condition = SqlCondition.LIKE)</span></span><br><span class="line"> <span class="keyword">private</span> String name;</span><br><span class="line"> <span class="meta">@TableField(condition = &quot;%s &amp;gt; #&#123;%s&#125;&quot;)</span></span><br><span class="line"> <span class="keyword">private</span> Integer age;</span><br><span class="line"> <span class="keyword">private</span> String email;</span><br><span class="line"> <span class="keyword">private</span> Long managerId;</span><br><span class="line"> <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/646.jpg" alt="646"></p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/500.jpg" alt="500"></p><p>再额外演示一下，链式lambda条件构造器的使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  LambdaUpdateChainWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> LambdaUpdateChainWrapper&lt;&gt;(userMapper);</span><br><span class="line">  wrapper.likeRight(User::getEmail, <span class="string">&quot;share&quot;</span>)</span><br><span class="line">    .like(User::getName, <span class="string">&quot;飞飞&quot;</span>)</span><br><span class="line">    .set(User::getEmail, <span class="string">&quot;ff@baomidou.com&quot;</span>)</span><br><span class="line">    .update();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><p><strong>反思</strong></p><p>由于<code>BaseMapper</code>提供的2个更新方法都是传入一个实体对象去执行更新，这<strong>在需要更新的列比较多时还好</strong>，若想要更新的只有那么一列，或者两列，则创建一个实体对象就显得有点麻烦。针对这种情况，<code>UpdateWrapper</code>提供有<code>set</code>方法，可以手动拼接SQL中的SET语句，此时可以不必传入实体对象，示例如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  LambdaUpdateWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> LambdaUpdateWrapper&lt;&gt;();</span><br><span class="line">  wrapper.likeRight(User::getEmail, <span class="string">&quot;share&quot;</span>).set(User::getManagerId, <span class="number">9L</span>);</span><br><span class="line">  userMapper.update(<span class="keyword">null</span>, wrapper);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p><h3 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h3><p><code>BaseMapper</code>一共提供了如下几个用于删除的方法</p><ul><li><code>deleteById</code> 根据主键id进行删除</li><li><code>deleteBatchIds</code> 根据主键id进行批量删除</li><li><code>deleteByMap</code> 根据Map进行删除（Map中的key为列名，value为值，根据列和值进行等值匹配）</li><li><code>delete(Wrapper&lt;T&gt; wrapper)</code> 根据条件构造器<code>Wrapper</code>进行删除</li></ul><p>与前面查询和更新的操作大同小异，不做赘述</p><h3 id="自定义SQL"><a href="#自定义SQL" class="headerlink" title="自定义SQL"></a>自定义SQL</h3><p>当mp提供的方法还不能满足需求时，则可以自定义SQL。</p><h4 id="原生mybatis"><a href="#原生mybatis" class="headerlink" title="原生mybatis"></a>原生mybatis</h4><p>示例如下</p><ul><li>注解方式</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.mappers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.mp.po.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yogurtzzz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/3/18 11:21</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"> </span><br><span class="line"> <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line"> <span class="function">List&lt;User&gt; <span class="title">selectRaw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>xml方式</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.example.mp.mappers.UserMapper&quot;</span>&gt;</span><br><span class="line"> &lt;select id=<span class="string">&quot;selectRaw&quot;</span> resultType=<span class="string">&quot;com.example.mp.po.User&quot;</span>&gt;</span><br><span class="line">        SELECT * FROM user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"><span class="keyword">package</span> com.example.mp.mappers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.mp.po.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"> <span class="function">List&lt;User&gt; <span class="title">selectRaw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用xml时，<strong>若xml文件与mapper接口文件不在同一目录下</strong>，则需要在<code>application.yml</code>中配置mapper.xml的存放路径</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  mapper-locations: /mappers<span class="comment">/*</span></span><br></pre></td></tr></table></figure><p>若有多个地方存放mapper，则用数组形式进行配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  mapper-locations: </span><br><span class="line">  - /mappers<span class="comment">/*</span></span><br><span class="line"><span class="comment">  - /com/example/mp/*</span></span><br></pre></td></tr></table></figure><p>测试代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCustomRawSql</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  List&lt;User&gt; users = userMapper.selectRaw();</span><br><span class="line">  users.forEach(System.out::println);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>结果</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/647.jpg" alt="647"></p><h4 id="mybatis-plus"><a href="#mybatis-plus" class="headerlink" title="mybatis-plus"></a>mybatis-plus</h4><p>也可以使用mp提供的Wrapper条件构造器，来自定义SQL</p><p>示例如下</p><ul><li>注解方式</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.mappers;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.Wrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.Constants;</span><br><span class="line"><span class="keyword">import</span> com.example.mp.po.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SQL中不写WHERE关键字，且固定使用$&#123;ew.customSqlSegment&#125;</span></span><br><span class="line"> <span class="meta">@Select(&quot;select * from user $&#123;ew.customSqlSegment&#125;&quot;)</span></span><br><span class="line"> <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span>Wrapper&lt;User&gt; wrapper)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>xml方式</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.mappers;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.Wrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.mp.po.User;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"> <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">(Wrapper&lt;User&gt; wrapper)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- UserMapper.xml --&gt;</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.example.mp.mappers.UserMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=<span class="string">&quot;findAll&quot;</span> resultType=<span class="string">&quot;com.example.mp.po.User&quot;</span>&gt;</span><br><span class="line">        SELECT * FROM user $&#123;ew.customSqlSegment&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><p><code>BaseMapper</code>中提供了2个方法进行分页查询，分别是<code>selectPage</code>和<code>selectMapsPage</code>，前者会将查询的结果封装成Java实体对象，后者会封装成<code>Map&lt;String,Object&gt;</code>。分页查询的食用示例如下</p><ol><li>创建mp的分页拦截器，注册到Spring容器中</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.config;</span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Configuration</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">       <span class="comment">/** 新版mp **/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">     interceptor.addInnerInterceptor(<span class="keyword">new</span> PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">     <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">       <span class="comment">/** 旧版mp 用 PaginationInterceptor **/</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>执行分页查询</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">     wrapper.ge(User::getAge, <span class="number">28</span>);</span><br><span class="line">           <span class="comment">// 设置分页信息, 查第3页, 每页2条数据</span></span><br><span class="line">     Page&lt;User&gt; page = <span class="keyword">new</span> Page&lt;&gt;(<span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line">           <span class="comment">// 执行分页查询</span></span><br><span class="line">     Page&lt;User&gt; userPage = userMapper.selectPage(page, wrapper);</span><br><span class="line">     System.out.println(<span class="string">&quot;总记录数 = &quot;</span> + userPage.getTotal());</span><br><span class="line">     System.out.println(<span class="string">&quot;总页数 = &quot;</span> + userPage.getPages());</span><br><span class="line">     System.out.println(<span class="string">&quot;当前页码 = &quot;</span> + userPage.getCurrent());</span><br><span class="line">           <span class="comment">// 获取分页查询结果</span></span><br><span class="line">     List&lt;User&gt; records = userPage.getRecords();</span><br><span class="line">     records.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>结果</li></ol><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/648.jpg" alt="648"></p><ol start="4"><li>其他</li></ol><p>注意到，分页查询总共发出了2次SQL，一次查总记录数，一次查具体数据。<strong>若希望不查总记录数，仅查分页结果</strong>。可以通过<code>Page</code>的重载构造函数，指定<code>isSearchCount</code>为<code>false</code>即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Page</span><span class="params">(<span class="keyword">long</span> current, <span class="keyword">long</span> size, <span class="keyword">boolean</span> isSearchCount)</span></span></span><br></pre></td></tr></table></figure><p>在实际开发中，可能遇到<strong>多表联查</strong>的场景，此时<code>BaseMapper</code>中提供的单表分页查询的方法无法满足需求，需要<strong>自定义SQL</strong>，示例如下（使用单表查询的SQL进行演示，实际进行多表联查时，修改SQL语句即可）</p><ol><li>在mapper接口中定义一个函数，接收一个Page对象为参数，并编写自定义SQL</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里采用纯注解方式。当然，若SQL比较复杂，建议还是采用XML的方式</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM user $&#123;ew.customSqlSegment&#125;&quot;)</span></span><br><span class="line"><span class="function">Page&lt;User&gt; <span class="title">selectUserPage</span><span class="params">(Page&lt;User&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;User&gt; wrapper)</span></span>;</span><br></pre></td></tr></table></figure><ol start="2"><li>执行查询</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPage2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">  wrapper.ge(User::getAge, <span class="number">28</span>).likeRight(User::getName, <span class="string">&quot;王&quot;</span>);</span><br><span class="line">  Page&lt;User&gt; page = <span class="keyword">new</span> Page&lt;&gt;(<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">  Page&lt;User&gt; userPage = userMapper.selectUserPage(page, wrapper);</span><br><span class="line">  System.out.println(<span class="string">&quot;总记录数 = &quot;</span> + userPage.getTotal());</span><br><span class="line">  System.out.println(<span class="string">&quot;总页数 = &quot;</span> + userPage.getPages());</span><br><span class="line"> userPage.getRecords().forEach(System.out::println);</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>结果</li></ol><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/649.jpg" alt="649"></p><h3 id="AR模式"><a href="#AR模式" class="headerlink" title="AR模式"></a>AR模式</h3><p>ActiveRecord模式，通过操作实体对象，直接操作数据库表。与ORM有点类似。</p><p>示例如下</p><ol><li>让实体类<code>User</code>继承自<code>Model</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.po;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.annotation.SqlCondition;</span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.extension.activerecord.Model;</span><br><span class="line">   <span class="keyword">import</span> lombok.Data;</span><br><span class="line">   <span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line">   <span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line">   <span class="meta">@Data</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@TableField(condition = SqlCondition.LIKE)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(condition = &quot;%s &amp;gt; #&#123;%s&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Long managerId;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol><li>直接调用实体对象上的方法</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertAr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     User user = <span class="keyword">new</span> User();</span><br><span class="line">     user.setId(<span class="number">15L</span>);</span><br><span class="line">     user.setName(<span class="string">&quot;我是AR猪&quot;</span>);</span><br><span class="line">     user.setAge(<span class="number">1</span>);</span><br><span class="line">     user.setEmail(<span class="string">&quot;ar@baomidou.com&quot;</span>);</span><br><span class="line">     user.setManagerId(<span class="number">1L</span>);</span><br><span class="line">     <span class="keyword">boolean</span> success = user.insert(); <span class="comment">// 插入</span></span><br><span class="line">     System.out.println(success);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>结果</li></ol><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/650.jpg" alt="650"></p><p>其他示例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectAr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">15L</span>);</span><br><span class="line">  User result = user.selectById();</span><br><span class="line">  System.out.println(result);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// 更新</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  User user = <span class="keyword">new</span> User();</span><br><span class="line">  user.setId(<span class="number">15L</span>);</span><br><span class="line">  user.setName(<span class="string">&quot;王全蛋&quot;</span>);</span><br><span class="line">  user.updateById();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//删除</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  User user = <span class="keyword">new</span> User();</span><br><span class="line">  user.setId(<span class="number">15L</span>);</span><br><span class="line">  user.deleteById();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="主键策略"><a href="#主键策略" class="headerlink" title="主键策略"></a>主键策略</h3><p>在定义实体类时，用<code>@TableId</code>指定主键，而其<code>type</code>属性，可以指定主键策略。</p><p>mp支持多种主键策略，默认的策略是基于雪花算法的自增id。全部主键策略定义在了枚举类<code>IdType</code>中，<code>IdType</code>有如下的取值</p><ul><li><p><code>AUTO</code></p><p>数据库ID自增，<strong>依赖于数据库</strong>。在插入操作生成SQL语句时，不会插入主键这一列</p></li><li><p><code>NONE</code></p><p>未设置主键类型。若在代码中没有手动设置主键，则会根据<strong>主键的全局策略</strong>自动生成（默认的主键全局策略是基于雪花算法的自增ID）</p></li><li><p><code>INPUT</code></p><p>需要手动设置主键，若不设置。插入操作生成SQL语句时，主键这一列的值会是<code>null</code>。oracle的序列主键需要使用这种方式</p></li><li><p><code>ASSIGN_ID</code></p><p>当没有手动设置主键，即实体类中的主键属性为空时，才会自动填充，使用雪花算法</p></li><li><p><code>ASSIGN_UUID</code></p><p>当实体类的主键属性为空时，才会自动填充，使用UUID</p></li><li><p>….（还有几种是已过时的，就不再列举）</p></li></ul><p>可以针对每个实体类，使用<code>@TableId</code>注解指定该实体类的主键策略，这可以理解为<strong>局部策略</strong>。若希望对所有的实体类，都采用同一种主键策略，挨个在每个实体类上进行配置，则太麻烦了，此时可以用主键的<strong>全局策略</strong>。只需要在<code>application.yml</code>进行配置即可。比如，配置了全局采用自增主键策略</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># application.yml</span><br><span class="line">mybatis-plus:</span><br><span class="line">  global-config:</span><br><span class="line">    db-config:</span><br><span class="line">      id-type: auto</span><br></pre></td></tr></table></figure><p>下面对不同主键策略的行为进行演示</p><ul><li><p><code>AUTO</code></p><p>在<code>User</code>上对<code>id</code>属性加上注解，然后将MYSQL的<code>user</code>表修改其主键为自增。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line">  <span class="meta">@Data</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">   <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">   <span class="keyword">private</span> Long id;</span><br><span class="line">   <span class="meta">@TableField(condition = SqlCondition.LIKE)</span></span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line">   <span class="meta">@TableField(condition = &quot;%s &amp;gt; #&#123;%s&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> Integer age;</span><br><span class="line">   <span class="keyword">private</span> String email;</span><br><span class="line">   <span class="keyword">private</span> Long managerId;</span><br><span class="line">   <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAuto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">&quot;我是青蛙呱呱&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">99</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;frog@baomidou.com&quot;</span>);</span><br><span class="line">    user.setCreateTime(LocalDateTime.now());</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">          System.out.println(user.getId());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>结果</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/651.jpg" alt="651"></p><p>可以看到，代码中没有设置主键ID，发出的SQL语句中也没有设置主键ID，并且插入结束后，主键ID会被写回到实体对象。</p><ul><li><p><code>NONE</code></p><p>在MYSQL的<code>user</code>表中，去掉主键自增。然后修改<code>User</code>类（若不配置<code>@TableId</code>注解，默认主键策略也是<code>NONE</code>）</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableId(type = IdType.NONE)</span></span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure><p>插入时，若实体类的主键ID有值，则使用之；若主键ID为空，则使用主键全局策略，来生成一个ID。</p><ul><li>其余的策略类似，不赘述</li></ul><p><strong>小结</strong></p><p><code>AUTO</code>依赖于数据库的自增主键，插入时，实体对象无需设置主键，插入成功后，主键会被写回实体对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INPUT`完全依赖于用户输入。实体对象中主键ID是什么，插入到数据库时就设置什么。若有值便设置值，若为`<span class="keyword">null</span>`则设置`<span class="keyword">null</span></span><br></pre></td></tr></table></figure><p>其余的几个策略，都是在实体对象中主键ID为空时，才会自动生成。</p><p><code>NONE</code>会跟随全局策略，<code>ASSIGN_ID</code>采用雪花算法，<code>ASSIGN_UUID</code>采用UUID</p><p>全局配置，在<code>application.yml</code>中进行即可；针对单个实体类的局部配置，使用<code>@TableId</code>即可。对于某个实体类，若它有局部主键策略，则采用之，否则，跟随全局策略。</p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>mybatis plus有许多可配置项，可在<code>application.yml</code>中进行配置，如上面的全局主键策略。下面列举部分配置项</p><h4 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h4><ul><li><code>configLocation</code>：若有单独的mybatis配置，用这个注解指定mybatis的配置文件（mybatis的全局配置文件）</li><li><code>mapperLocations</code>：mybatis mapper所对应的xml文件的位置</li><li><code>typeAliasesPackage</code>：mybatis的别名包扫描路径</li><li>…..</li></ul><h4 id="进阶配置"><a href="#进阶配置" class="headerlink" title="进阶配置"></a>进阶配置</h4><ul><li><p><code>mapUnderscoreToCamelCase</code>：是否开启自动驼峰命名规则映射。（默认开启）</p></li><li><p><code>dbTpe</code>：数据库类型。一般不用配，会根据数据库连接url自动识别</p></li><li><p><code>fieldStrategy</code>：（已过时）字段验证策略。<strong>该配置项在最新版的mp文档中已经找不到了</strong>，被细分成了<code>insertStrategy</code>，<code>updateStrategy</code>，<code>selectStrategy</code>。默认值是<code>NOT_NULL</code>，即对于实体对象中非空的字段，才会组装到最终的SQL语句中。</p><p>有如下几种可选配置</p><p>这个配置项，可在<code>application.yml</code>中进行<strong>全局配置</strong>，也可以在某一实体类中，对某一字段用<code>@TableField</code>注解进行<strong>局部配置</strong></p><p>这个字段验证策略有什么用呢？在UPDATE操作中能够体现出来，若用一个<code>User</code>对象执行UPDATE操作，我们希望只对<code>User</code>对象中非空的属性，更新到数据库中，其他属性不做更新，则<code>NOT_NULL</code>可以满足需求。而若<code>updateStrategy</code>配置为<code>IGNORED</code>，则不会进行非空判断，会将实体对象中的全部属性如实组装到SQL中，这样，执行UPDATE时，可能就将一些不想更新的字段，设置为了<code>NULL</code>。</p></li><li><ul><li><code>IGNORED</code>：忽略校验。即，不做校验。实体对象中的全部字段，无论值是什么，都如实地被组装到SQL语句中（为<code>NULL</code>的字段在SQL语句中就组装为<code>NULL</code>）。</li><li><code>NOT_NULL</code>：非<code>NULL</code>校验。只会将非<code>NULL</code>的字段组装到SQL语句中</li><li><code>NOT_EMPTY</code>：非空校验。当有字段是字符串类型时，只组装非空字符串；对其他类型的字段，等同于<code>NOT_NULL</code></li><li><code>NEVER</code>：不加入SQL。所有字段不加入到SQL语句</li></ul></li><li><p><code>tablePrefix</code>：添加表名前缀</p><p>比如</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">    global-config:</span><br><span class="line">      db-config:</span><br><span class="line">        table-prefix: xx_</span><br></pre></td></tr></table></figure><p>然后将MYSQL中的表做一下修改。但Java实体类保持不变（仍然为<code>User</code>）。</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/652.jpg" alt="652"></p><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.like(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;黄&quot;</span>);</span><br><span class="line">    Integer count = userMapper.selectCount(wrapper);</span><br><span class="line">    System.out.println(count);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>可以看到拼接出来的SQL，在表名前面添加了前缀</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/653.jpg" alt="653"></p><h3 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h3><p>mp提供一个生成器，可快速生成Entity实体类，Mapper接口，Service，Controller等全套代码。</p><p>示例如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratorTest</span> </span>&#123;</span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  AutoGenerator generator = <span class="keyword">new</span> AutoGenerator();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 全局配置</span></span><br><span class="line">  GlobalConfig config = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">  String projectPath = System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">  <span class="comment">// 设置输出到的目录</span></span><br><span class="line">  config.setOutputDir(projectPath + <span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">  config.setAuthor(<span class="string">&quot;yogurt&quot;</span>);</span><br><span class="line">  <span class="comment">// 生成结束后是否打开文件夹</span></span><br><span class="line">  config.setOpen(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 全局配置添加到 generator 上</span></span><br><span class="line">  generator.setGlobalConfig(config);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据源配置</span></span><br><span class="line">  DataSourceConfig dataSourceConfig = <span class="keyword">new</span> DataSourceConfig();</span><br><span class="line">  dataSourceConfig.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/yogurt?serverTimezone=Asia/Shanghai&quot;</span>);</span><br><span class="line">  dataSourceConfig.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">  dataSourceConfig.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">  dataSourceConfig.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据源配置添加到 generator</span></span><br><span class="line">  generator.setDataSource(dataSourceConfig);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 包配置, 生成的代码放在哪个包下</span></span><br><span class="line">  PackageConfig packageConfig = <span class="keyword">new</span> PackageConfig();</span><br><span class="line">  packageConfig.setParent(<span class="string">&quot;com.example.mp.generator&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 包配置添加到 generator</span></span><br><span class="line">  generator.setPackageInfo(packageConfig);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 策略配置</span></span><br><span class="line">  StrategyConfig strategyConfig = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line">  <span class="comment">// 下划线驼峰命名转换</span></span><br><span class="line">  strategyConfig.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">  strategyConfig.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">  <span class="comment">// 开启lombok</span></span><br><span class="line">  strategyConfig.setEntityLombokModel(<span class="keyword">true</span>);</span><br><span class="line">  <span class="comment">// 开启RestController</span></span><br><span class="line">  strategyConfig.setRestControllerStyle(<span class="keyword">true</span>);</span><br><span class="line">  generator.setStrategy(strategyConfig);</span><br><span class="line">  generator.setTemplateEngine(<span class="keyword">new</span> FreemarkerTemplateEngine());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开始生成</span></span><br><span class="line">  generator.execute();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行后，可以看到生成了如下图所示的全套代码</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/654.jpg" alt="654"></p><h2 id="高级功能"><a href="#高级功能" class="headerlink" title="高级功能"></a>高级功能</h2><p>高级功能的演示需要用到一张新的表<code>user2</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS user2;</span><br><span class="line"><span class="function">CREATE TABLE <span class="title">user2</span> <span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">id BIGINT(<span class="number">20</span>)</span> PRIMARY KEY NOT NULL COMMENT &#x27;主键id&#x27;,</span></span><br><span class="line"><span class="function">name <span class="title">VARCHAR</span><span class="params">(<span class="number">30</span>)</span> DEFAULT NULL COMMENT &#x27;姓名&#x27;,</span></span><br><span class="line"><span class="function">age <span class="title">INT</span><span class="params">(<span class="number">11</span>)</span> DEFAULT NULL COMMENT &#x27;年龄&#x27;,</span></span><br><span class="line"><span class="function">email <span class="title">VARCHAR</span><span class="params">(<span class="number">50</span>)</span> DEFAULT NULL COMMENT &#x27;邮箱&#x27;,</span></span><br><span class="line"><span class="function">manager_id <span class="title">BIGINT</span><span class="params">(<span class="number">20</span>)</span> DEFAULT NULL COMMENT &#x27;直属上级id&#x27;,</span></span><br><span class="line"><span class="function">create_time DATETIME DEFAULT NULL COMMENT &#x27;创建时间&#x27;,</span></span><br><span class="line"><span class="function">update_time DATETIME DEFAULT NULL COMMENT &#x27;修改时间&#x27;,</span></span><br><span class="line"><span class="function">version <span class="title">INT</span><span class="params">(<span class="number">11</span>)</span> DEFAULT &#x27;1&#x27; COMMENT &#x27;版本&#x27;,</span></span><br><span class="line"><span class="function">deleted <span class="title">INT</span><span class="params">(<span class="number">1</span>)</span> DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除标识,0-未删除,1-已删除&#x27;,</span></span><br><span class="line"><span class="function">CONSTRAINT manager_fk FOREIGN <span class="title">KEY</span><span class="params">(manager_id)</span> REFERENCES <span class="title">user2</span><span class="params">(id)</span></span></span><br><span class="line"><span class="function">) ENGINE </span>= INNODB CHARSET=UTF8;</span><br><span class="line"></span><br><span class="line"><span class="function">INSERT INTO <span class="title">user2</span><span class="params">(id, name, age, email, manager_id, create_time)</span></span></span><br><span class="line"><span class="function"><span class="title">VALUES</span></span></span><br><span class="line"><span class="function"><span class="params">(<span class="number">1</span>, <span class="string">&#x27;老板&#x27;</span>, <span class="number">40</span> ,<span class="string">&#x27;boss@baomidou.com&#x27;</span> ,NULL, <span class="string">&#x27;2021-03-28 13:12:40&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function"><span class="params">(<span class="number">2</span>, <span class="string">&#x27;王狗蛋&#x27;</span>, <span class="number">40</span> ,<span class="string">&#x27;gd@baomidou.com&#x27;</span> ,<span class="number">1</span>, <span class="string">&#x27;2021-03-28 13:12:40&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function"><span class="params">(<span class="number">3</span>, <span class="string">&#x27;王鸡蛋&#x27;</span>, <span class="number">40</span> ,<span class="string">&#x27;jd@baomidou.com&#x27;</span> ,<span class="number">2</span>, <span class="string">&#x27;2021-03-28 13:12:40&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function"><span class="params">(<span class="number">4</span>, <span class="string">&#x27;王鸭蛋&#x27;</span>, <span class="number">40</span> ,<span class="string">&#x27;yd@baomidou.com&#x27;</span> ,<span class="number">2</span>, <span class="string">&#x27;2021-03-28 13:12:40&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function"><span class="params">(<span class="number">5</span>, <span class="string">&#x27;王猪蛋&#x27;</span>, <span class="number">40</span> ,<span class="string">&#x27;zd@baomidou.com&#x27;</span> ,<span class="number">2</span>, <span class="string">&#x27;2021-03-28 13:12:40&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function"><span class="params">(<span class="number">6</span>, <span class="string">&#x27;王软蛋&#x27;</span>, <span class="number">40</span> ,<span class="string">&#x27;rd@baomidou.com&#x27;</span> ,<span class="number">2</span>, <span class="string">&#x27;2021-03-28 13:12:40&#x27;</span>)</span>,</span></span><br><span class="line"><span class="function"><span class="params">(<span class="number">7</span>, <span class="string">&#x27;王铁蛋&#x27;</span>, <span class="number">40</span> ,<span class="string">&#x27;td@baomidou.com&#x27;</span> ,<span class="number">2</span>, <span class="string">&#x27;2021-03-28 13:12:40&#x27;</span>)</span></span></span><br></pre></td></tr></table></figure><p>并创建对应的实体类<code>User2</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.po;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User2</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> Long id;</span><br><span class="line"> <span class="keyword">private</span> String name;</span><br><span class="line"> <span class="keyword">private</span> Integer age;</span><br><span class="line"> <span class="keyword">private</span> String email;</span><br><span class="line"> <span class="keyword">private</span> Long managerId;</span><br><span class="line"> <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"> <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"> <span class="keyword">private</span> Integer version;</span><br><span class="line"> <span class="keyword">private</span> Integer deleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以及Mapper接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.mappers;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.mp.po.User2;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">User2Mapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User2</span>&gt; </span>&#123; &#125;</span><br></pre></td></tr></table></figure><h3 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h3><p>首先，为什么要有逻辑删除呢？直接删掉不行吗？当然可以，但日后若想要恢复，或者需要查看这些数据，就做不到了。<strong>逻辑删除是为了方便数据恢复，和保护数据本身价值的一种方案</strong>。</p><p>日常中，我们在电脑中删除一个文件后，也仅仅是把该文件放入了回收站，日后若有需要还能进行查看或恢复。当我们确定不再需要某个文件，可以将其从回收站中彻底删除。这也是类似的道理。</p><p>mp提供的逻辑删除实现起来非常简单</p><p>只需要在<code>application.yml</code>中进行逻辑删除的相关配置即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  global-config:</span><br><span class="line">    db-config:</span><br><span class="line">      logic-delete-field: deleted # 全局逻辑删除的实体字段名</span><br><span class="line">      logic-delete-value: <span class="number">1</span> # 逻辑已删除值(默认为<span class="number">1</span>)</span><br><span class="line">      logic-not-delete-value: <span class="number">0</span> # 逻辑未删除值(默认为<span class="number">0</span>)</span><br><span class="line">      # 若逻辑已删除和未删除的值和默认值一样，则可以不配置这<span class="number">2</span>项</span><br></pre></td></tr></table></figure><p>测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp;</span><br><span class="line"><span class="keyword">import</span> com.example.mp.mappers.User2Mapper;</span><br><span class="line"><span class="keyword">import</span> com.example.mp.po.User2;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogicDeleteTest</span> </span>&#123;</span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> User2Mapper mapper;</span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLogicDel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i = mapper.deleteById(<span class="number">6</span>);</span><br><span class="line">  System.out.println(<span class="string">&quot;rowAffected = &quot;</span> + i);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/655.jpg" alt="655"></p><p>可以看到，发出的SQL不再是<code>DELETE</code>，而是<code>UPDATE</code></p><p>此时我们再执行一次<code>SELECT</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelect</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> List&lt;User2&gt; users = mapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/656.jpg" alt="656"></p><p>可以看到，发出的SQL语句，会自动在WHERE后面拼接逻辑未删除的条件。查询出来的结果中，没有了id为6的王软蛋。</p><p>若想要SELECT的列，不包括逻辑删除的那一列，则可以在实体类中通过<code>@TableField</code>进行配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(select = false)</span></span><br><span class="line"><span class="keyword">private</span> Integer deleted;</span><br></pre></td></tr></table></figure><p>可以看到下图的执行结果中，SELECT中已经不包含deleted这一列了</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/657.jpg" alt="657"></p><p>前面在<code>application.yml</code>中做的配置，是全局的。通常来说，对于多个表，我们也会统一逻辑删除字段的名称，统一逻辑已删除和未删除的值，所以全局配置即可。当然，若要对某些表进行单独配置，在实体类的对应字段上使用<code>@TableLogic</code>即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableLogic(value = &quot;0&quot;, delval = &quot;1&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Integer deleted;</span><br></pre></td></tr></table></figure><p><strong>小结</strong></p><p>开启mp的逻辑删除后，会对SQL产生如下的影响</p><ul><li>INSERT语句：没有影响</li><li>SELECT语句：追加WHERE条件，过滤掉已删除的数据</li><li>UPDATE语句：追加WHERE条件，防止更新到已删除的数据</li><li>DELETE语句：转变为UPDATE语句</li></ul><p>注意，上述的影响，只针对mp自动注入的SQL生效。如果是自己手动添加的自定义SQL，则不会生效。比如</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">User2Mapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User2</span>&gt; </span>&#123;</span><br><span class="line"> <span class="meta">@Select(&quot;select * from user2&quot;)</span></span><br><span class="line"> <span class="function">List&lt;User2&gt; <span class="title">selectRaw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用这个<code>selectRaw</code>，则mp的逻辑删除不会生效。</p><p>另，逻辑删除可在<code>application.yml</code>中进行全局配置，也可在实体类中用<code>@TableLogic</code>进行局部配置。</p><h3 id="自动填充"><a href="#自动填充" class="headerlink" title="自动填充"></a>自动填充</h3><p>表中常常会有“新增时间”，“修改时间”，“操作人” 等字段。比较原始的方式，是每次插入或更新时，手动进行设置。mp可以通过配置，对某些字段进行自动填充，食用示例如下</p><ol><li>在实体类中的某些字段上，通过<code>@TableField</code>设置自动填充</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Long managerId;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span> <span class="comment">// 插入时自动填充</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.UPDATE)</span> <span class="comment">// 更新时自动填充</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">    <span class="keyword">private</span> Integer deleted;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>实现自动填充处理器</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.component;</span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line">   <span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line">   <span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Component</span> <span class="comment">//需要注册到Spring容器中</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">           <span class="comment">// 插入时自动填充</span></span><br><span class="line">           <span class="comment">// 注意第二个参数要填写实体类中的字段名称，而不是表的列名称</span></span><br><span class="line">     strictFillStrategy(metaObject, <span class="string">&quot;createTime&quot;</span>, LocalDateTime::now);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">           <span class="comment">// 更新时自动填充</span></span><br><span class="line">     strictFillStrategy(metaObject, <span class="string">&quot;updateTime&quot;</span>, LocalDateTime::now);</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  User2 user = <span class="keyword">new</span> User2();</span><br><span class="line">  user.setId(<span class="number">8L</span>);</span><br><span class="line">  user.setName(<span class="string">&quot;王一蛋&quot;</span>);</span><br><span class="line">  user.setAge(<span class="number">29</span>);</span><br><span class="line">  user.setEmail(<span class="string">&quot;yd@baomidou.com&quot;</span>);</span><br><span class="line">  user.setManagerId(<span class="number">2L</span>);</span><br><span class="line">  mapper.insert(user);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>根据下图结果，可以看到对createTime进行了自动填充</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/658.jpg" alt="658"></p><p>注意，自动填充仅在该字段为空时会生效，若该字段不为空，则直接使用已有的值。如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  User2 user = <span class="keyword">new</span> User2();</span><br><span class="line">  user.setId(<span class="number">8L</span>);</span><br><span class="line">  user.setName(<span class="string">&quot;王一蛋&quot;</span>);</span><br><span class="line">  user.setAge(<span class="number">29</span>);</span><br><span class="line">  user.setEmail(<span class="string">&quot;yd@baomidou.com&quot;</span>);</span><br><span class="line">  user.setManagerId(<span class="number">2L</span>);</span><br><span class="line">  user.setCreateTime(LocalDateTime.of(<span class="number">2000</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">  mapper.insert(user);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/659.jpg" alt="659"></p><p>更新时的自动填充，测试如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  User2 user = <span class="keyword">new</span> User2();</span><br><span class="line">  user.setId(<span class="number">8L</span>);</span><br><span class="line">  user.setName(<span class="string">&quot;王一蛋&quot;</span>);</span><br><span class="line">  user.setAge(<span class="number">99</span>);</span><br><span class="line">  mapper.updateById(user);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/660.jpg" alt="660"></p><h3 id="乐观锁插件"><a href="#乐观锁插件" class="headerlink" title="乐观锁插件"></a>乐观锁插件</h3><p>当出现并发操作时，需要确保各个用户对数据的操作不产生冲突，此时需要一种并发控制手段。悲观锁的方法是，在对数据库的一条记录进行修改时，先直接加锁（数据库的锁机制），锁定这条数据，然后再进行操作；而乐观锁，正如其名，它先假设不存在冲突情况，而在实际进行数据操作时，再检查是否冲突。乐观锁的一种通常实现是<strong>版本号</strong>，在MySQL中也有名为MVCC的基于版本号的并发事务控制。</p><p>在读多写少的场景下，乐观锁比较适用，能够减少加锁操作导致的性能开销，提高系统吞吐量。</p><p>在写多读少的场景下，悲观锁比较使用，否则会因为乐观锁不断失败重试，反而导致性能下降。</p><p>乐观锁的实现如下：</p><ol><li>取出记录时，获取当前version</li><li>更新时，带上这个version</li><li>执行更新时， set version = newVersion where version = oldVersion</li><li>如果oldVersion与数据库中的version不一致，就更新失败</li></ol><p>这种思想和CAS（Compare And Swap）非常相似。</p><p>乐观锁的实现步骤如下</p><ol><li>配置乐观锁插件</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.config;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.OptimisticLockerInnerInterceptor;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line">   <span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Configuration</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line">       <span class="comment">/** 3.4.0以后的mp版本，推荐用如下的配置方式 **/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">     interceptor.addInnerInterceptor(<span class="keyword">new</span> OptimisticLockerInnerInterceptor());</span><br><span class="line">     <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">       <span class="comment">/** 旧版mp可以采用如下方式。注意新旧版本中，新版的类，名称带有Inner, 旧版的不带, 不要配错了 **/</span></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">       @Bean</span></span><br><span class="line"><span class="comment">    public OptimisticLockerInterceptor opLocker() &#123;</span></span><br><span class="line"><span class="comment">     return new OptimisticLockerInterceptor();</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在实体类中表示版本的字段上添加注解<code>@Version</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Long managerId;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    <span class="meta">@Version</span></span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">    <span class="keyword">private</span> Integer deleted;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOpLocker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> version = <span class="number">1</span>; <span class="comment">// 假设这个version是先前查询时获得的</span></span><br><span class="line">  User2 user = <span class="keyword">new</span> User2();</span><br><span class="line">  user.setId(<span class="number">8L</span>);</span><br><span class="line">  user.setEmail(<span class="string">&quot;version@baomidou.com&quot;</span>);</span><br><span class="line">  user.setVersion(version);</span><br><span class="line">  <span class="keyword">int</span> i = mapper.updateById(user);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>执行之前先看一下数据库的情况</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/501.jpg" alt="501"></p><p>根据下图执行结果，可以看到SQL语句中添加了version相关的操作</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/682.jpg" alt="682"></p><p>当UPDATE返回了1，表示影响行数为1，则更新成功。反之，由于WHERE后面的version与数据库中的不一致，匹配不到任何记录，则影响行数为0，表示更新失败。更新成功后，新的version会被封装回实体对象中。</p><p>实体类中version字段，类型只支持int，long，Date，Timestamp，LocalDateTime</p><p><strong>注意，乐观锁插件仅支持</strong><strong><code>updateById(id)</code>与<code>update(entity, wrapper)</code>方法</strong></p><p>注意：如果使用<code>wrapper</code>，则<code>wrapper</code>不能复用！示例如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOpLocker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  User2 user = <span class="keyword">new</span> User2();</span><br><span class="line">  user.setId(<span class="number">8L</span>);</span><br><span class="line">  user.setVersion(<span class="number">1</span>);</span><br><span class="line">  user.setAge(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 第一次使用</span></span><br><span class="line">  LambdaQueryWrapper&lt;User2&gt; wrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">  wrapper.eq(User2::getName, <span class="string">&quot;王一蛋&quot;</span>);</span><br><span class="line">  mapper.update(user, wrapper);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 第二次复用</span></span><br><span class="line">  user.setAge(<span class="number">3</span>);</span><br><span class="line">  mapper.update(user, wrapper);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/681.jpg" alt="681"></p><p>可以看到在第二次复用<code>wrapper</code>时，拼接出的SQL中，后面WHERE语句中出现了2次version，是有问题的。</p><h3 id="性能分析插件"><a href="#性能分析插件" class="headerlink" title="性能分析插件"></a>性能分析插件</h3><p>该插件会输出SQL语句的执行时间，以便做SQL语句的性能分析和调优。</p><p>注：3.2.0版本之后，mp自带的性能分析插件被官方移除了，而推荐食用第三方性能分析插件</p><p>食用步骤</p><ol><li>引入maven依赖</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;p6spy&lt;/groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;p6spy&lt;/artifactId&gt;</span><br><span class="line">       &lt;version&gt;<span class="number">3.9</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">   &lt;/dependency&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>修改<code>application.yml</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">     datasource:</span><br><span class="line">       driver-<span class="class"><span class="keyword">class</span>-<span class="title">name</span>: <span class="title">com</span>.<span class="title">p6spy</span>.<span class="title">engine</span>.<span class="title">spy</span>.<span class="title">P6SpyDriver</span> #换成<span class="title">p6spy</span>的驱动</span></span><br><span class="line"><span class="class">       <span class="title">url</span>: <span class="title">jdbc</span>:<span class="title">p6spy</span>:<span class="title">mysql</span>://<span class="title">localhost</span>:3306/<span class="title">yogurt</span>?<span class="title">serverTimezone</span></span>=Asia/Shanghai #url修改</span><br><span class="line">       username: root</span><br><span class="line">       password: root</span><br></pre></td></tr></table></figure><ol start="3"><li>在<code>src/main/resources</code>资源目录下添加<code>spy.properties</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#spy.properties</span><br><span class="line">   #<span class="number">3.2</span><span class="number">.1</span>以上使用</span><br><span class="line">   modulelist=com.baomidou.mybatisplus.extension.p6spy.MybatisPlusLogFactory,com.p6spy.engine.outage.P6OutageFactory</span><br><span class="line">   # 真实JDBC driver , 多个以逗号分割,默认为空。由于上面设置了modulelist, 这里可以不用设置driverlist</span><br><span class="line">   #driverlist=com.mysql.cj.jdbc.Driver</span><br><span class="line">   # 自定义日志打印</span><br><span class="line">   logMessageFormat=com.baomidou.mybatisplus.extension.p6spy.P6SpyLogger</span><br><span class="line">   #日志输出到控制台</span><br><span class="line">   appender=com.baomidou.mybatisplus.extension.p6spy.StdoutLogger</span><br><span class="line">   #若要日志输出到文件, 把上面的appnder注释掉, 或者采用下面的appender, 再添加logfile配置</span><br><span class="line">   #不配置appender时, 默认是往文件进行输出的</span><br><span class="line">   #appender=com.p6spy.engine.spy.appender.FileLogger</span><br><span class="line">   #logfile=log.log</span><br><span class="line">   # 设置 p6spy driver 代理</span><br><span class="line">   deregisterdrivers=<span class="keyword">true</span></span><br><span class="line">   # 取消JDBC URL前缀</span><br><span class="line">   useprefix=<span class="keyword">true</span></span><br><span class="line">   # 配置记录 Log 例外,可去掉的结果集有error,info,batch,debug,statement,commit,rollback,result,resultset.</span><br><span class="line">   excludecategories=info,debug,result,commit,resultset</span><br><span class="line">   # 日期格式</span><br><span class="line">   dateformat=yyyy-MM-dd HH:mm:ss</span><br><span class="line">   # 是否开启慢SQL记录</span><br><span class="line">   outagedetection=<span class="keyword">true</span></span><br><span class="line">   # 慢SQL记录标准 <span class="number">2</span> 秒</span><br><span class="line">   outagedetectioninterval=<span class="number">2</span></span><br><span class="line">   # 执行时间设置, 只有超过这个执行时间的才进行记录, 默认值<span class="number">0</span>, 单位毫秒</span><br><span class="line">   executionThreshold=<span class="number">10</span></span><br></pre></td></tr></table></figure><p>随便运行一个测试用例，可以看到该SQL的执行时长被记录了下来</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/680.jpg" alt="680"></p><h3 id="多租户SQL解析器"><a href="#多租户SQL解析器" class="headerlink" title="多租户SQL解析器"></a>多租户SQL解析器</h3><p>多租户的概念：多个用户共用一套系统，但他们的数据有需要相对的独立，保持一定的隔离性。</p><p>多租户的数据隔离一般有如下的方式：</p><ul><li><p>不同租户使用不同的数据库服务器</p><p>优点是：不同租户有不同的独立数据库，有助于扩展，以及对不同租户提供更好的个性化，出现故障时恢复数据较为简单。</p><p>缺点是：增加了数据库数量，购置成本，维护成本更高</p></li><li><p>不同租户使用相同的数据库服务器，但使用不同的数据库（不同的schema）</p><p>优点是购置和维护成本低了一些，缺点是数据恢复较为困难，因为不同租户的数据都放在了一起</p></li><li><p>不同租户使用相同的数据库服务器，使用相同的数据库，共享数据表，在表中增加租户id来做区分</p><p>优点是，购置和维护成本最低，支持用户最多，缺点是隔离性最低，安全性最低</p></li></ul><p>食用实例如下</p><p>添加多租户拦截器配置。添加配置后，在执行CRUD的时候，会自动在SQL语句最后拼接租户id的条件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.handler.TenantLineHandler;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.TenantLineInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.jsqlparser.expression.Expression;</span><br><span class="line"><span class="keyword">import</span> net.sf.jsqlparser.expression.LongValue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">  interceptor.addInnerInterceptor(<span class="keyword">new</span> TenantLineInnerInterceptor(<span class="keyword">new</span> TenantLineHandler() &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Expression <span class="title">getTenantId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 返回租户id的值, 这里固定写死为1</span></span><br><span class="line">                <span class="comment">// 一般是从当前上下文中取出一个 租户id</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LongValue(<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            ** 通常会将表示租户id的列名，需要排除租户id的表等信息，封装到一个配置类中（如TenantConfig）</span></span><br><span class="line"><span class="comment">            **/</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getTenantIdColumn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 返回表中的表示租户id的列名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;manager_id&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">ignoreTable</span><span class="params">(String tableName)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 表名不为 user2 的表, 不拼接多租户条件</span></span><br><span class="line">    <span class="keyword">return</span> !<span class="string">&quot;user2&quot;</span>.equals(tableName);</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果用了分页插件注意先 add TenantLineInnerInterceptor 再 add PaginationInnerInterceptor</span></span><br><span class="line">        <span class="comment">// 用了分页插件必须设置 MybatisConfiguration#useDeprecatedExecutor = false</span></span><br><span class="line">  <span class="keyword">return</span> interceptor;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTenant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  LambdaQueryWrapper&lt;User2&gt; wrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">  wrapper.likeRight(User2::getName, <span class="string">&quot;王&quot;</span>)</span><br><span class="line">    .select(User2::getName, User2::getAge, User2::getEmail, User2::getManagerId);</span><br><span class="line">  user2Mapper.selectList(wrapper);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/640" alt="图片"></p><h3 id="动态表名SQL解析器"><a href="#动态表名SQL解析器" class="headerlink" title="动态表名SQL解析器"></a>动态表名SQL解析器</h3><p>当数据量特别大的时候，我们通常会采用分库分表。这时，可能就会有多张表，其表结构相同，但表名不同。例如<code>order_1</code>，<code>order_2</code>，<code>order_3</code>，查询时，我们可能需要动态设置要查的表名。mp提供了动态表名SQL解析器，食用示例如下</p><p>先在mysql中拷贝一下<code>user2</code>表</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/600.jpg" alt="600"></p><p>配置动态表名拦截器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mp.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.handler.TableNameHandler;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.DynamicTableNameInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">  DynamicTableNameInnerInterceptor dynamicTableNameInnerInterceptor = <span class="keyword">new</span> DynamicTableNameInnerInterceptor();</span><br><span class="line">  HashMap&lt;String, TableNameHandler&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">// 对于user2表，进行动态表名设置</span></span><br><span class="line">  map.put(<span class="string">&quot;user2&quot;</span>, (sql, tableName) -&gt; &#123;</span><br><span class="line">   String _ = <span class="string">&quot;_&quot;</span>;</span><br><span class="line">   <span class="keyword">int</span> random = <span class="keyword">new</span> Random().nextInt(<span class="number">2</span>) + <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">return</span> tableName + _ + random; <span class="comment">// 若返回null, 则不会进行动态表名替换, 还是会使用user2</span></span><br><span class="line">  &#125;);</span><br><span class="line">  dynamicTableNameInnerInterceptor.setTableNameHandlerMap(map);</span><br><span class="line">  interceptor.addInnerInterceptor(dynamicTableNameInnerInterceptor);</span><br><span class="line">  <span class="keyword">return</span> interceptor;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/641.jpg" alt="641"></p><p>测试</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line"> public void testDynamicTable() &#123;</span><br><span class="line">  user2Mapper.selectList(null);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li><p>条件构造器<code>AbstractWrapper</code>中提供了多个方法用于构造SQL语句中的WHERE条件，而其子类<code>QueryWrapper</code>额外提供了<code>select</code>方法，可以只选取特定的列，子类<code>UpdateWrapper</code>额外提供了<code>set</code>方法，用于设置SQL中的SET语句。除了普通的<code>Wrapper</code>，还有基于lambda表达式的<code>Wrapper</code>，如<code>LambdaQueryWrapper</code>，<code>LambdaUpdateWrapper</code>，它们在构造WHERE条件时，直接以<strong>方法引用</strong>来指定WHERE条件中的列，比普通<code>Wrapper</code>通过字符串来指定要更加优雅。另，还有<strong>链式Wrapper</strong>，如<code>LambdaQueryChainWrapper</code>，它封装了<code>BaseMapper</code>，可以更方便地获取结果。</p></li><li><p>条件构造器采用<strong>链式调用</strong>来拼接多个条件，条件之间默认以<code>AND</code>连接</p></li><li><p>当<code>AND</code>或<code>OR</code>后面的条件需要被括号包裹时，将括号中的条件以lambda表达式形式，作为参数传入<code>and()</code>或<code>or()</code></p><p>特别的，当<code>()</code>需要放在WHERE语句的最开头时，可以使用<code>nested()</code>方法</p></li><li><p>条件表达式时当需要传入自定义的SQL语句，或者需要调用数据库函数时，可用<code>apply()</code>方法进行SQL拼接</p></li><li><p>条件构造器中的各个方法可以通过一个<code>boolean</code>类型的变量<code>condition</code>，来根据需要灵活拼接WHERE条件（仅当<code>condition</code>为<code>true</code>时会拼接SQL语句）</p></li><li><p>使用lambda条件构造器，可以通过lambda表达式，直接使用实体类中的属性进行条件构造，比普通的条件构造器更加优雅</p></li><li><p>若mp提供的方法不够用，可以通过<strong>自定义SQL</strong>（原生mybatis）的形式进行扩展开发</p></li><li><p>使用mp进行分页查询时，需要创建一个分页拦截器（Interceptor），注册到Spring容器中，随后查询时，通过传入一个分页对象（Page对象）进行查询即可。单表查询时，可以使用<code>BaseMapper</code>提供的<code>selectPage</code>或<code>selectMapsPage</code>方法。复杂场景下（如多表联查），使用自定义SQL。</p></li><li><p>AR模式可以直接通过操作实体类来操作数据库。让实体类继承自<code>Model</code>即可</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> MyBatis-plus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于hexo+butterfly的个人博客搭建教程（四） 主题美化篇</title>
      <link href="/2022/01/25/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3(%E5%9B%9B)/"/>
      <url>/2022/01/25/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3(%E5%9B%9B)/</url>
      
        <content type="html"><![CDATA[<p>本文介绍主题进一步美化，以及添加更多有趣的功能。</p><h2 id="添加看板娘"><a href="#添加看板娘" class="headerlink" title="添加看板娘"></a>添加看板娘</h2><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format27.png" alt="format27"></p><p>1：进入 <code>Butterfly</code> 主题，在 <code>[博客名]\themes\butterfly\source\</code> 目录下打开命令提示符，输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/stevenjoezhang/live2d-widget.git live2d-widget</span><br></pre></td></tr></table></figure><p>2：找到路径 <code>[博客名]\themes\butterfly\source\live2d-widget\autoload.js</code>，打开 <code>autoload.js</code>，修改内容：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- const live2d_path = &quot;https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget/&quot;;</span></span><br><span class="line"><span class="addition">+ const live2d_path = &quot;/live2d-widget/&quot;;</span></span><br></pre></td></tr></table></figure><p>3：在 <code>Butterfly</code> 的主题配置文件 <code>[Blogroot]\_config.butterfly.yml</code> 中，<br><code>butterfly</code> 主题其实自带 <code>fontawesome</code> 依赖，无需引入，</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    # Inject</span><br><span class="line">    # Insert the code to head (before &#x27;&lt;/head&gt;&#x27; tag) and the bottom (before &#x27;&lt;/body&gt;&#x27; tag)</span><br><span class="line">    # 插入代码到头部 &lt;/head&gt; 之前 和 底部 &lt;/body&gt; 之前</span><br><span class="line">    inject:</span><br><span class="line">      head:</span><br><span class="line">        # - &lt;link rel=&quot;stylesheet&quot; href=&quot;/xxx.css&quot;&gt;</span><br><span class="line">      bottom:</span><br><span class="line">        # - &lt;script src=&quot;xxxx&quot;&gt;&lt;/script&gt;</span><br><span class="line"><span class="addition">+       - &lt;script defer src=&quot;/live2d-widget/autoload.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>4：保存所有文件的修改，然后顺序执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>5：自定义修改<br>有一定前端基础的小伙伴可以通过修改 <code>[Blogroot]\themes\butterfly\source\live2d-widget</code> 路径下的样式资源文件：</p><ul><li><code>waifu-tips.js</code>: 包含了按钮和对话框的逻辑</li><li><code>waifu-tips.json</code> : 定义了触发条件（selector，CSS 选择器）和触发时显示的文字（text）；</li><li><code>waifu.css</code>: 看板娘的样式表。可以对看板娘的位置布局等做自定义修改。</li></ul><h2 id="图片设置"><a href="#图片设置" class="headerlink" title="图片设置"></a>图片设置</h2><h2 id="站点图标"><a href="#站点图标" class="headerlink" title="站点图标"></a>站点图标</h2><p>站点图标又称站点icon(<code>favicon.ico</code>)<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favicon:</span> <span class="string">/img/favicon.png</span> <span class="comment"># 将图片放入 themes -&gt; Butterfly -&gt; source -&gt; img 里</span></span><br></pre></td></tr></table></figure><h2 id="封面图片设置"><a href="#封面图片设置" class="headerlink" title="封面图片设置"></a>封面图片设置</h2><p>在访问系统首页时，出现的封面图片<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">index_img:</span> <span class="string">图片地址</span> <span class="comment"># 主页封面图片</span></span><br><span class="line"><span class="attr">default_top_img:</span> <span class="string">图片地址</span> <span class="comment"># 文章详情页的顶部图片</span></span><br><span class="line"><span class="attr">archive_img:</span> <span class="string">图片地址</span> <span class="comment"># 归档页顶部的图片</span></span><br><span class="line"><span class="attr">tag_img:</span> <span class="string">图片地址</span> <span class="comment"># 标签页顶部的图片</span></span><br><span class="line"><span class="attr">category_img:</span> <span class="string">图片地址</span> <span class="comment"># 分类页顶部的图片</span></span><br></pre></td></tr></table></figure><h2 id="错误图片"><a href="#错误图片" class="headerlink" title="错误图片"></a>错误图片</h2><p>配置了该属性后会替换无法展示的图片<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">error_img:</span></span><br><span class="line">  <span class="attr">flink:</span> <span class="string">/img/friend_404.gif</span></span><br><span class="line">  <span class="attr">post_page:</span> <span class="string">/img/404.jpg</span></span><br></pre></td></tr></table></figure><h2 id="字数统计"><a href="#字数统计" class="headerlink" title="字数统计"></a>字数统计</h2><p>为 <code>Butterfly</code> 配上字数统计特性，你需要如下几个步骤:</p><ol><li>打开 hexo 工作目录</li><li>进入命令提示符输入<code>npm install hexo-wordcount --save</code> or <code>yarn add hexo-wordcount</code></li><li>修改主题配置文件<code>_config.butterfly.yml</code>：</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wordcount:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_wordcount:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_wordcount:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="文章摘要"><a href="#文章摘要" class="headerlink" title="文章摘要"></a>文章摘要</h2><p>文章摘要（吸引读者往下读）<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">index_post_content:</span></span><br><span class="line">  <span class="attr">method:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">length:</span> <span class="number">500</span> <span class="comment"># 节选文章的前500个字</span></span><br></pre></td></tr></table></figure><h2 id="分享"><a href="#分享" class="headerlink" title="分享"></a>分享</h2><p>分享你的内容sharejs</p><p>如果你不知道 <a href="https://github.com/overtrue/share.js/">sharejs</a>，到官网看看说明吧。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sharejs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sites:</span> <span class="string">facebook,twitter,wechat,weibo,qq</span>  <span class="comment">#想要显示的内容</span></span><br></pre></td></tr></table></figure><h2 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h2><p>从 3.0.0 开始，开启评论需要在 comments-use 中填写你需要的评论。<br>支持双评论显示，只需要配置两个评论（第一个为默认显示）<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="attr">use:</span> <span class="comment"># 使用的评论（请注意，填写的评论首字母需要大写。最多支持两个，如果不需要请留空）</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Valine</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Disqus</span></span><br><span class="line">  <span class="comment"># - Valine</span></span><br><span class="line">  <span class="comment"># - Disqus</span></span><br><span class="line">  <span class="attr">text:</span> <span class="literal">true</span> <span class="comment"># 是否显示评论服务商的名字</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">false</span> <span class="comment"># 是否为评论开启 lazyload，开启后，只有滚动到评论位置时才会加载评论所需要的资源（开启 lazyload 后，评论数将不显示）</span></span><br><span class="line">  <span class="attr">count:</span> <span class="literal">false</span> <span class="comment"># 是否在文章顶部显示评论数 livere 和 utterances 不支持评论数显示</span></span><br></pre></td></tr></table></figure><h2 id="Valine"><a href="#Valine" class="headerlink" title="Valine"></a>Valine</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">valine:</span></span><br><span class="line">  <span class="attr">appId:</span> <span class="string">填入申请到的appid</span> <span class="comment"># leancloud application app id</span></span><br><span class="line">  <span class="attr">appKey:</span> <span class="string">填入申请到的秘钥</span> <span class="comment"># leancloud application app key</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">monsterid</span> <span class="comment"># gravatar style https://valine.js.org/#/avatar</span></span><br><span class="line">  <span class="attr">serverURLs:</span> <span class="comment"># This configuration is suitable for domestic custom domain name users, overseas version will be automatically detected (no need to manually fill in)</span></span><br><span class="line">  <span class="attr">bg:</span> <span class="string">/img/comment_bg.png</span> <span class="comment"># valine background</span></span><br><span class="line">  <span class="attr">visitor:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="string">记录你的邮箱，方便快速回复</span></span><br><span class="line">  <span class="attr">master:</span> <span class="comment"># md5加密后的博主邮箱</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">A5FB062F4B03DF13194A698AF2383568</span>  <span class="comment">#可添加多个</span></span><br><span class="line">  <span class="attr">friends:</span> <span class="comment"># md5加密后的小伙伴邮箱</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">6E85D9254372CD179BBEA9881410F4D6</span></span><br><span class="line">  <span class="attr">tagMeta:</span> <span class="string">&#x27;博主,朋友,访客&#x27;</span> <span class="comment"># 标签要显示的文字,默认&#x27;博主,朋友,访客&#x27;</span></span><br><span class="line">  <span class="attr">option:</span></span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format28.png" alt="format28"></p><h2 id="在线聊天"><a href="#在线聊天" class="headerlink" title="在线聊天"></a>在线聊天</h2><p>从 3.0 开始，Butterfly 主题内置了 4 种在綫聊天工具。你可以选择开启一种，方便你与访客的交流。<br>通用设置<br>这些工具都提供了一个按钮可以打开 / 关闭聊天窗口。<br>主题也提供了一个集合主题特色的按钮来替换这些工具本身的按钮，这个聊天按钮将会出现在右下角里。<br>你只需要把 chat_btn 打开就行。<br>修改主题配置文件_config.butterfly.yml：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">chat_btn:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format29.png" alt="format29"></p><h2 id="daovoice"><a href="#daovoice" class="headerlink" title="daovoice"></a>daovoice</h2><p>打开 <a href="http://daovoice.io/">daovoice</a> 并注册帐号,找到你的 app id</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format30.png" alt="format30"></p><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">daovoice:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">app_id:</span> <span class="string">xxxxx</span></span><br></pre></td></tr></table></figure><p>可在聊天设置里配置聊天按钮等样式<img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format31.png" alt="format31"></p><h2 id="百度统计"><a href="#百度统计" class="headerlink" title="百度统计"></a>百度统计</h2><ol><li>登录百度统计的官方网站</li><li>找到你百度统计的统计代码</li></ol><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format32.png" alt="format32">修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">baidu_analytics:</span> <span class="string">你的代码</span></span><br></pre></td></tr></table></figure><h2 id="谷歌统计"><a href="#谷歌统计" class="headerlink" title="谷歌统计"></a>谷歌统计</h2><ol><li>登录谷歌分析的官方网站</li><li>找到你的谷歌分析的跟踪 ID</li></ol><p><img src="https://img-blog.csdnimg.cn/img_convert/c2d57f91029357b692d9ad8c6229a4e8.png" alt="img"></p><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">google_analytics:</span> <span class="string">你的代码</span> <span class="comment"># 通常以`UA-`打头</span></span><br></pre></td></tr></table></figure><h2 id="腾讯移动分析"><a href="#腾讯移动分析" class="headerlink" title="腾讯移动分析"></a>腾讯移动分析</h2><ol><li>登录腾讯移动分析的官方网站</li><li>选择 WEB应用</li><li>找到你的站点 ID</li></ol><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format33.png" alt="format33"></p><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tencent_analytics:</span> <span class="string">你的ID</span></span><br></pre></td></tr></table></figure><h2 id="CNZZ分析"><a href="#CNZZ分析" class="headerlink" title="CNZZ分析"></a>CNZZ分析</h2><ol><li>登录 CNZZ 分析的官方网站</li><li>找到 站点设置 - 获取代码</li><li>找到你的 web_id</li></ol><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cnzz_analytics:</span> <span class="string">你的代码</span></span><br></pre></td></tr></table></figure><h2 id="谷歌广告（赚点小费）"><a href="#谷歌广告（赚点小费）" class="headerlink" title="谷歌广告（赚点小费）"></a>谷歌广告（赚点小费）</h2><p>主题已集成谷歌广告（自动广告）<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">google_adsense:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">auto_ads:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">js:</span> <span class="string">https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js</span></span><br><span class="line">  <span class="attr">client:</span> <span class="comment"># 填入个人识别码</span></span><br><span class="line">  <span class="attr">enable_page_level_ads:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="手动广告"><a href="#手动广告" class="headerlink" title="手动广告"></a>手动广告</h2><p>主题预留了三个位置可供插入广告，分别为主页文章 (每三篇文章出现广告)/aside 公告之后 / 文章页打赏之后。，把 html 代码填写到对应的位置<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ad:</span></span><br><span class="line">  <span class="attr">index:</span></span><br><span class="line">  <span class="attr">aside:</span></span><br><span class="line">  <span class="attr">post:</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">index:</span> <span class="string">&lt;ins</span> <span class="string">class=&quot;adsbygoogle&quot;</span> <span class="string">style=&quot;display:block&quot;</span> <span class="string">data-ad-format=&quot;fluid&quot;</span> <span class="string">data-ad-layout-key=&quot;xxxxxxxxxxxx&quot;</span> <span class="string">data-ad-client=&quot;ca-pub-xxxxxxxxxx&quot;</span> <span class="string">data-ad-slot=&quot;xxxxxxxxxx&quot;&gt;&lt;/ins&gt;&lt;script&gt;(adsbygoogle=window.adsbygoogle||[]).push(&#123;&#125;)&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><h2 id="网站验证"><a href="#网站验证" class="headerlink" title="网站验证"></a>网站验证</h2><p>如果需要搜索引擎收录网站，可能需要登录对应搜索引擎的管理平台进行提交。<br>各自的验证码可从各自管理平台拿到<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Google Webmaster tools verification setting</span></span><br><span class="line"><span class="comment"># See: https://www.google.com/webmasters/</span></span><br><span class="line"><span class="attr">google_site_verification:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bing Webmaster tools verification setting</span></span><br><span class="line"><span class="comment"># See: https://www.bing.com/webmaster/</span></span><br><span class="line"><span class="attr">bing_site_verification:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Baidu Webmaster tools verification setting</span></span><br><span class="line"><span class="comment"># See: https://ziyuan.baidu.com/site/</span></span><br><span class="line"><span class="attr">baidu_site_verification:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 360 Webmaster tools verification setting</span></span><br><span class="line"><span class="comment"># see http://zhanzhang.so.com/</span></span><br><span class="line"><span class="attr">qihu_site_verification:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Yandex Webmaster tools verification setting</span></span><br><span class="line"><span class="comment"># see https://webmaster.yandex.com/</span></span><br><span class="line"><span class="attr">yandex_site_verification:</span></span><br></pre></td></tr></table></figure><h2 id="自定义主题色"><a href="#自定义主题色" class="headerlink" title="自定义主题色"></a>自定义主题色</h2><p>可以修改大部分 UI 颜色<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme_color:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">main:</span> <span class="string">&quot;#49B1F5&quot;</span></span><br><span class="line">  <span class="attr">paginator:</span> <span class="string">&quot;#00c4b6&quot;</span></span><br><span class="line">  <span class="attr">button_hover:</span> <span class="string">&quot;#FF7242&quot;</span></span><br><span class="line">  <span class="attr">text_selection:</span> <span class="string">&quot;#00c4b6&quot;</span></span><br><span class="line">  <span class="attr">link_color:</span> <span class="string">&quot;#99a9bf&quot;</span></span><br><span class="line">  <span class="attr">meta_color:</span> <span class="string">&quot;#858585&quot;</span></span><br><span class="line">  <span class="attr">hr_color:</span> <span class="string">&quot;#A4D8FA&quot;</span></span><br><span class="line">  <span class="attr">code_foreground:</span> <span class="string">&quot;#F47466&quot;</span></span><br><span class="line">  <span class="attr">code_background:</span> <span class="string">&quot;rgba(27, 31, 35, .05)&quot;</span></span><br><span class="line">  <span class="attr">toc_color:</span> <span class="string">&quot;#00c4b6&quot;</span></span><br><span class="line">  <span class="attr">blockquote_padding_color:</span> <span class="string">&quot;#49b1f5&quot;</span></span><br><span class="line">  <span class="attr">blockquote_background_color:</span> <span class="string">&quot;#49b1f5&quot;</span></span><br></pre></td></tr></table></figure><h2 id="网站背景"><a href="#网站背景" class="headerlink" title="网站背景"></a>网站背景</h2><p>默认显示白色，可设置图片或者颜色<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">background:</span> <span class="comment">#图片或者颜色</span></span><br></pre></td></tr></table></figure><p>留意: 如果你的网站根目录不是’/‘, 使用本地图片时，需加上你的根目录。<br>例如：网站是 <code>https://yoursite.com/blog</code>, 引用一张 <code>img/xx.png</code> 图片，则设置 <code>background</code> 为 <code>url (/blog/img/xx.png)</code></p><h2 id="footer-背景（页脚背景）"><a href="#footer-背景（页脚背景）" class="headerlink" title="footer 背景（页脚背景）"></a>footer 背景（页脚背景）</h2><p>footer 的背景会与 <code>top_img</code> 的一致，当设置 <code>false</code> 时，将与主题色一致。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># footer是否显示图片背景(与top_img一致)</span></span><br><span class="line"><span class="attr">footer_bg:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="打字效果"><a href="#打字效果" class="headerlink" title="打字效果"></a>打字效果</h2><p>打字效果 <a href="https://github.com/disjukr/activate-power-mode">activate-power-mode</a><br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Typewriter Effect (打字效果)</span></span><br><span class="line"><span class="comment"># https://github.com/disjukr/activate-power-mode</span></span><br><span class="line"><span class="attr">activate_power_mode:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">colorful:</span> <span class="literal">true</span> <span class="comment"># open particle animation (冒光特效)</span></span><br><span class="line">  <span class="attr">shake:</span> <span class="literal">true</span> <span class="comment">#  open shake (抖动特效)</span></span><br></pre></td></tr></table></figure><h3 id="静止彩带"><a href="#静止彩带" class="headerlink" title="静止彩带"></a>静止彩带</h3><p>好看的彩带背景，可设置每次刷新更换彩带，或者每次点击更换彩带<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">canvas_ribbon:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">size:</span> <span class="number">150</span></span><br><span class="line">  <span class="attr">alpha:</span> <span class="number">0.6</span></span><br><span class="line">  <span class="attr">zIndex:</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">click_to_change:</span> <span class="literal">false</span>  <span class="comment">#设置是否每次点击都更换綵带</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span> <span class="comment"># false 手机端不显示 true 手机端显示</span></span><br></pre></td></tr></table></figure><h3 id="动态彩带"><a href="#动态彩带" class="headerlink" title="动态彩带"></a>动态彩带</h3><p>好看的彩带背景，会飘动<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">canvas_ribbon_piao:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span> <span class="comment"># false 手机端不显示 true 手机端显示</span></span><br></pre></td></tr></table></figure><h3 id="canvas-nest"><a href="#canvas-nest" class="headerlink" title="canvas-nest"></a>canvas-nest</h3><p>好看的星空例子特效，会飘动<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">canvas_nest:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&#x27;0,0,255&#x27;</span> <span class="comment">#color of lines, default: &#x27;0,0,0&#x27;; RGB values: (R,G,B).(<span class="doctag">note:</span> use &#x27;,&#x27; to separate.)</span></span><br><span class="line">  <span class="attr">opacity:</span> <span class="number">0.7</span> <span class="comment"># the opacity of line (0~1), default: 0.5.</span></span><br><span class="line">  <span class="attr">zIndex:</span> <span class="number">-1</span> <span class="comment"># z-index property of the background, default: -1.</span></span><br><span class="line">  <span class="attr">count:</span> <span class="number">99</span> <span class="comment"># the number of lines, default: 99.</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span> <span class="comment"># false 手机端不显示 true 手机端显示</span></span><br></pre></td></tr></table></figure><h2 id="鼠标点击效果"><a href="#鼠标点击效果" class="headerlink" title="鼠标点击效果"></a>鼠标点击效果</h2><h2 id="烟花"><a href="#烟花" class="headerlink" title="烟花"></a>烟花</h2><p>zIndex 建议只在 -1 和 9999 上选<br>-1 代表烟火效果在底部<br>9999 代表烟火效果在前面<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">fireworks:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">zIndex:</span> <span class="number">9999</span> <span class="comment"># -1 or 9999</span></span><br></pre></td></tr></table></figure><h3 id="爱心"><a href="#爱心" class="headerlink" title="爱心"></a>爱心</h3><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 点击出现爱心</span></span><br><span class="line"><span class="attr">click_heart:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="文字"><a href="#文字" class="headerlink" title="文字"></a>文字</h3><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 点击出现文字，文字可自行修改</span></span><br><span class="line"><span class="attr">ClickShowText:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">text:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">I</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">LOVE</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">YOU</span></span><br><span class="line">  <span class="attr">fontSize:</span> <span class="string">15px</span></span><br></pre></td></tr></table></figure><h2 id="页面美化"><a href="#页面美化" class="headerlink" title="页面美化"></a>页面美化</h2><p>会改变 ol、ul、h1-h5 的样式<br><code>field</code> 配置生效的区域</p><ul><li>post 只在文章页生效</li><li>site 在全站生效<br>修改主题配置文件<code>_config.butterfly.yml</code>：</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 美化页面显示</span></span><br><span class="line"><span class="attr">beautify:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span> <span class="comment"># site/post</span></span><br><span class="line">  <span class="attr">title-prefix-icon:</span> <span class="string">&#x27;\f0c1&#x27;</span></span><br><span class="line">  <span class="attr">title-prefix-icon-color:</span> <span class="string">&quot;#F47466&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format34.png" alt="format34"></p><p>对比如下</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format35.png" alt="format35"></p><h3 id="全局字体"><a href="#全局字体" class="headerlink" title="全局字体"></a>全局字体</h3><p>可自行设置字体的 <code>font-family</code><br>如不需要配置，请留空<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">font:</span></span><br><span class="line">  <span class="attr">global-font-size:</span></span><br><span class="line">  <span class="attr">code-font-size:</span></span><br><span class="line">  <span class="attr">font-family:</span> <span class="string">-apple-system,</span> <span class="string">BlinkMacSystemFont,</span> <span class="string">&quot;Segoe UI&quot;</span><span class="string">,</span> <span class="string">&quot;Helvetica Neue&quot;</span><span class="string">,</span> <span class="string">Lato,</span> <span class="string">Roboto,</span> <span class="string">&quot;PingFang SC&quot;</span><span class="string">,</span> <span class="string">&quot;Microsoft JhengHei&quot;</span><span class="string">,</span> <span class="string">&quot;Microsoft YaHei&quot;</span><span class="string">,</span> <span class="string">sans-serif</span></span><br><span class="line">  <span class="attr">code-font-family:</span> <span class="string">consolas,</span> <span class="string">Menlo,</span> <span class="string">&quot;PingFang SC&quot;</span><span class="string">,</span> <span class="string">&quot;Microsoft JhengHei&quot;</span><span class="string">,</span> <span class="string">&quot;Microsoft YaHei&quot;</span><span class="string">,</span> <span class="string">sans-serif</span></span><br></pre></td></tr></table></figure><h3 id="Blog-标题字体"><a href="#Blog-标题字体" class="headerlink" title="Blog 标题字体"></a>Blog 标题字体</h3><p>可自行设置字体的 <code>font-family</code><br>如不需要配置，请留空<br>如不需要使用网络字体，只需要把 font_link 留空就行<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">blog_title_font:</span></span><br><span class="line">  <span class="attr">font_link:</span> <span class="string">https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap</span></span><br><span class="line">  <span class="attr">font-family:</span> <span class="string">Titillium</span> <span class="string">Web,</span> <span class="string">&#x27;PingFang SC&#x27;</span><span class="string">,</span> <span class="string">&#x27;Hiragino Sans GB&#x27;</span><span class="string">,</span> <span class="string">&#x27;Microsoft JhengHei&#x27;</span><span class="string">,</span> <span class="string">&#x27;Microsoft YaHei&#x27;</span><span class="string">,</span> <span class="string">sans-serif</span></span><br></pre></td></tr></table></figure><h2 id="网站副标题"><a href="#网站副标题" class="headerlink" title="网站副标题"></a>网站副标题</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">可设置主页中显示的网站副标题或者喜欢的座右铭。</span></span><br><span class="line"><span class="string">修改主题配置文件_config.butterfly.yml：</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主页subtitle</span></span><br><span class="line"><span class="attr">subtitle:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 打字效果</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 循环或者只打字一次</span></span><br><span class="line">  <span class="attr">loop:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># source调用第三方服务</span></span><br><span class="line">  <span class="comment"># source: false 关闭调用</span></span><br><span class="line">  <span class="comment"># source: 1  调用搏天api的随机语录（简体） https://api.btstu.cn/</span></span><br><span class="line">  <span class="comment"># source: 2  调用一言网的一句话（简体） https://hitokoto.cn/</span></span><br><span class="line">  <span class="comment"># source: 3  调用一句网（简体） http://yijuzhan.com/</span></span><br><span class="line">  <span class="comment"># source: 4  调用今日诗词（简体） https://www.jinrishici.com/</span></span><br><span class="line">  <span class="comment"># subtitle 会先显示 source , 再显示 sub 的内容</span></span><br><span class="line">  <span class="attr">source:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 如果有英文逗号&#x27; , &#x27;,请使用转义字元 &amp;#44;</span></span><br><span class="line">  <span class="comment"># 如果有英文双引号&#x27; &quot; &#x27;,请使用转义字元 &amp;quot;</span></span><br><span class="line">  <span class="comment"># 开头不允许转义字元，如需要，请把整个句子用双引号包住</span></span><br><span class="line">  <span class="comment"># 例如 ”&amp;quotNever put off till tomorrow what you can do today&amp;quot&quot;</span></span><br><span class="line">  <span class="comment"># 如果关闭打字效果，subtitle只会显示sub的第一行文字</span></span><br><span class="line">  <span class="attr">sub:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">今日事&amp;#44;今日毕</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Never</span> <span class="string">put</span> <span class="string">off</span> <span class="string">till</span> <span class="string">tomorrow</span> <span class="string">what</span> <span class="string">you</span> <span class="string">can</span> <span class="string">do</span> <span class="string">today</span></span><br></pre></td></tr></table></figure><h2 id="主页-top-img-显示大小"><a href="#主页-top-img-显示大小" class="headerlink" title="主页 top_img 显示大小"></a>主页 top_img 显示大小</h2><p>默认的显示为全屏。site-info 的区域会居中显示<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主页设置</span></span><br><span class="line"><span class="comment"># 默认top_img全屏，site_info在中间</span></span><br><span class="line"><span class="comment"># 使用默认, 都无需填写（建议默认）</span></span><br><span class="line"><span class="attr">index_site_info_top:</span> <span class="comment"># 主页标题距离顶部距离  例如 300px/300em/300rem/10%</span></span><br><span class="line"><span class="attr">index_top_img_height:</span>  <span class="comment">#主页top_img高度 例如 300px/300em/300rem  不能使用百分比</span></span><br></pre></td></tr></table></figure><p>注意：index_top_img_height 的值不能使用百分比。<br>2 个都不填的话，会使用默认值</p><h2 id="页面加载动画-preloader"><a href="#页面加载动画-preloader" class="headerlink" title="页面加载动画 preloader"></a>页面加载动画 preloader</h2><p>当进入网页时，因为加载速度的问题，可能会导致 top_img 图片出现断层显示，或者网页加载不全而出现等待时间，开启 preloader 后，会显示加载动画，等页面加载完，加载动画会消失。<br>修改主题配置文件_config.butterfly.yml：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">preloader:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="PWA"><a href="#PWA" class="headerlink" title="PWA"></a>PWA</h2><p>PWA简单来说就是让网站有App体验,要为 Butterfly 配上 PWA 特性，你需要如下几个步骤:</p><ol><li>打开 hexo 工作目录</li><li><code>npm install hexo-offline --save</code> 或者 <code>yarn add hexo-offline</code></li><li>修改主题配置文件<code>_config.butterfly.yml</code>：</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># offline config passed to sw-precache.</span></span><br><span class="line"><span class="attr">offline:</span></span><br><span class="line">  <span class="attr">maximumFileSizeToCacheInBytes:</span> <span class="number">10485760</span> <span class="comment"># 缓存的最大文件大小，以字节为单位</span></span><br><span class="line">  <span class="attr">staticFileGlobs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">public/**/*.&#123;js,html,css,png,jpg,gif,svg,webp,eot,ttf,woff,woff2&#125;</span></span><br><span class="line">  <span class="comment"># 静态文件合集，如果你的站点使用了例如webp格式的文件，请将文件类型添加进去。</span></span><br><span class="line">  <span class="attr">stripPrefix:</span> <span class="string">public</span></span><br><span class="line">  <span class="attr">verbose:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">runtimeCaching:</span></span><br><span class="line">    <span class="comment"># CDNs - should be cacheFirst, since they should be used specific versions so should not change</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">urlPattern:</span> <span class="string">/*</span> <span class="comment"># 如果你需要加载CDN资源，请配置该选项，如果没有，可以不配置。</span></span><br><span class="line">      <span class="attr">handler:</span> <span class="string">cacheFirst</span></span><br><span class="line">      <span class="attr">options:</span></span><br><span class="line">        <span class="attr">origin:</span> <span class="string">your_websie_url</span> <span class="comment"># 可替换成你的 url</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>更多内容请查看 <a href="https://github.com/JLHwung/hexo-offline">hexo-offline</a> 的官方文档</p><p>1 在主题配置文件中开启 pwa 选项。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pwa:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">manifest:</span> <span class="string">/img/pwa/manifest.json</span></span><br><span class="line">  <span class="attr">apple_touch_icon:</span> <span class="string">/img/pwa/apple-touch-icon.png</span></span><br><span class="line">  <span class="attr">favicon_32_32:</span> <span class="string">/img/pwa/32.png</span></span><br><span class="line">  <span class="attr">favicon_16_16:</span> <span class="string">/img/pwa/16.png</span></span><br><span class="line">  <span class="attr">mask_icon:</span> <span class="string">/img/pwa/safari-pinned-tab.svg</span></span><br></pre></td></tr></table></figure><p>2 在创建 source/ 目录中创建 manifest.json 文件。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;string&quot;</span>, <span class="string">//应用全称</span></span><br><span class="line">    <span class="attr">&quot;short_name&quot;:</span> <span class="string">&quot;Junzhou&quot;</span>, <span class="string">//应用简称</span></span><br><span class="line">    <span class="attr">&quot;theme_color&quot;:</span> <span class="string">&quot;#49b1f5&quot;</span>, <span class="string">//匹配浏览器的地址栏颜色</span></span><br><span class="line">    <span class="attr">&quot;background_color&quot;:</span> <span class="string">&quot;#49b1f5&quot;</span>,<span class="string">//加载应用时的背景色</span></span><br><span class="line">    <span class="attr">&quot;display&quot;:</span> <span class="string">&quot;standalone&quot;</span>,<span class="string">//首选显示模式</span> <span class="string">其他选项有：fullscreen</span>,<span class="string">minimal-ui</span>,<span class="string">browser</span></span><br><span class="line">    <span class="attr">&quot;scope&quot;:</span> <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;start_url&quot;:</span> <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;icons&quot;:</span> [ <span class="string">//该数组指定icons图标参数，用来时适配不同设备（需为png，至少包含一个192px*192px的图标）</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;src&quot;:</span> <span class="string">&quot;images/pwaicons/36.png&quot;</span>, <span class="string">//图标文件的目录，需在source/目录下自行创建。</span></span><br><span class="line">          <span class="attr">&quot;sizes&quot;:</span> <span class="string">&quot;36x36&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;src&quot;:</span> <span class="string">&quot;images/pwaicons/48.png&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;sizes&quot;:</span> <span class="string">&quot;48x48&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;src&quot;:</span> <span class="string">&quot;images/pwaicons/72.png&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;sizes&quot;:</span> <span class="string">&quot;72x72&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;src&quot;:</span> <span class="string">&quot;images/pwaicons/96.png&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;sizes&quot;:</span> <span class="string">&quot;96x96&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;src&quot;:</span> <span class="string">&quot;images/pwaicons/144.png&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;sizes&quot;:</span> <span class="string">&quot;144x144&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;src&quot;:</span> <span class="string">&quot;images/pwaicons/192.png&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;sizes&quot;:</span> <span class="string">&quot;192x192&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;src&quot;:</span> <span class="string">&quot;images/pwaicons/512.png&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;sizes&quot;:</span> <span class="string">&quot;512x512&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;splash_pages&quot;:</span> <span class="literal">null</span> <span class="string">//配置自定义启动动画。</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>你也可以通过 Web App Manifest 快速创建 manifest.json。（Web App Manifest 要求至少包含一个 512*512 像素的图标）</p><p>可以通过 Chrome 插件 Lighthouse 检查 PWA 配置是否生效以及配置是否正确。<br>打开博客页面<br>启动 Lighthouse 插件 (Lighthouse 插件要求至少包含一个 512*512 像素的图标)<br>关于 PWA（渐进式增强 Web 应用）的更多内容请参閲 Google Tools for Web Developers</p><h2 id="图片大图查看模式fancybox"><a href="#图片大图查看模式fancybox" class="headerlink" title="图片大图查看模式fancybox"></a>图片大图查看模式fancybox</h2><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fancybox http://fancyapps.com/fancybox/3/</span></span><br><span class="line"><span class="attr">fancybox:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="medium-zoom"><a href="#medium-zoom" class="headerlink" title="medium_zoom"></a>medium_zoom</h2><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">medium_zoom:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="Snackbar-弹窗"><a href="#Snackbar-弹窗" class="headerlink" title="Snackbar 弹窗"></a>Snackbar 弹窗</h2><p>Snackbar 弹窗，根据自己爱好开启<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">snackbar:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">bottom-left</span></span><br><span class="line">  <span class="attr">bg_light:</span> <span class="string">&#x27;#49b1f5&#x27;</span> <span class="comment">#light mode时弹窗背景</span></span><br><span class="line">  <span class="attr">bg_dark:</span> <span class="string">&#x27;#2d3035&#x27;</span> <span class="comment">#dark mode时弹窗背景</span></span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format36.gif" alt="format36"></p><h2 id="豆瓣"><a href="#豆瓣" class="headerlink" title="豆瓣"></a>豆瓣</h2><p>很多人使用 <a href="https://github.com/mythsman/hexo-douban">hexo-douban</a> 这款插件。但是该插件是直接生成相应的网页，而不会去读取对应的 markdown 文件。因此，可在设置里进行相应的配置。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果你有使用hexo-douban，可配置这个</span></span><br><span class="line"><span class="attr">douban:</span></span><br><span class="line">  <span class="attr">meta:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">movies_img:</span> <span class="string">https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/movie.jpg</span></span><br><span class="line">  <span class="attr">books_img:</span></span><br><span class="line">  <span class="attr">games_img:</span></span><br></pre></td></tr></table></figure><h2 id="Pjax"><a href="#Pjax" class="headerlink" title="Pjax"></a>Pjax</h2><p>当用户点击链接，通过 ajax 更新页面需要变化的部分，然后使用 HTML5 的 pushState 修改浏览器的 URL 地址。<br>这样可以不用重复加载相同的资源（css/js）， 从而提升网页的加载速度。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果你有使用hexo-douban，可配置这个</span></span><br><span class="line"><span class="attr">pjax:</span> </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/music/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/no-pjax/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
            <tag> hexo </tag>
            
            <tag> butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>负载均衡最短响应策略</title>
      <link href="/2022/01/19/dubbo%E6%96%B0%E5%A2%9E%E6%9C%80%E7%9F%AD%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5%E5%88%86%E6%9E%90/"/>
      <url>/2022/01/19/dubbo%E6%96%B0%E5%A2%9E%E6%9C%80%E7%9F%AD%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h3 id="2020-年-5-月-15-日，Dubbo-发布-2-7-7-release-版本。其中有这么一个-Features"><a href="#2020-年-5-月-15-日，Dubbo-发布-2-7-7-release-版本。其中有这么一个-Features" class="headerlink" title="2020 年 5 月 15 日，Dubbo 发布 2.7.7 release 版本。其中有这么一个 Features"></a><strong>2020 年 5 月 15 日，Dubbo 发布 2.7.7 release 版本。其中有这么一个 Features</strong></h3><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format.png" alt="format"></p><p>新增一个负载均衡策略。</p><p>先看一下提交记录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/chickenlj/incubator-dubbo/commit/6d2ba7ec7b5a1cb7971143d4262d0a1bfc826d45</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format1.png" alt="format1"></p><p>负载均衡是基于 SPI 实现的，我们看到对应的文件中多了一个名为 shortestresponse 的 key。</p><p>这个，就是新增的负载均衡策略了。看名字，你也知道了这个策略的名称就叫：最短响应。</p><p>所以截止 2.7.7 版本，官方提供了五种负载均衡算法了，他们分别是：</p><ol><li>ConsistentHashLoadBalance 一致性哈希负载均衡</li><li>LeastActiveLoadBalance 最小活跃数负载均衡</li><li>RandomLoadBalance 加权随机负载均衡</li><li>RoundRobinLoadBalance 加权轮询负载均衡</li><li>ShortestResponseLoadBalance 最短响应时间负载均衡</li></ol><p>最短响应时间负载均衡</p><p>首先，我们看一下这个类上的注解，先有个整体的认知。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.dubbo.rpc.cluster.loadbalance.ShortestResponseLoadBalance</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format2.png" alt="format2"></p><p>翻译一下是什么意思：</p><ol><li>从多个服务提供者中选择出调用成功的且响应时间最短的服务提供者，由于满足这样条件的服务提供者有可能有多个。所以当选择出多个服务提供者后要根据他们的权重做分析。</li><li>但是如果只选择出来了一个，直接用选出来这个。</li><li>如果真的有多个，看它们的权重是否一样，如果不一样，则走加权随机算法的逻辑。</li><li>如果它们的权重是一样的，则随机调用一个。</li></ol><p>再配个图，就好理解了，可以先不管图片中的标号：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format3.png" alt="format3"></p><p>有了上面的整体概念的铺垫了，接下来分析源码的时候就简单了。</p><p>源码一共就 66 行，我把它分为 5 个片段去一一分析。</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format4.png" alt="format4"></p><p>这里一到五的标号，对应上面流程图中的标号。我们一个个的说。</p><h2 id="标号为①的部分"><a href="#标号为①的部分" class="headerlink" title="标号为①的部分"></a>标号为①的部分</h2><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format5.png" alt="format5"></p><p>这一部分是定义并初始化一些参数，为接下来的代码服务的，翻译一下每个参数对应的注释：</p><p>length 参数：服务提供者的数量。</p><p>shortestResponse 参数：所有服务提供者的估计最短响应时间。（这个地方我觉得注释描述的不太准确，看后面的代码可以知道这只是一个零时变量，在循环中存储当前最短响应时间是多少。）</p><p>shortCount 参数：具有相同最短响应时间的服务提供者个数，初始化为 0。</p><p>shortestIndexes 参数：数组里面放的是具有相同最短响应时间的服务提供者的下标。</p><p>weights 参数：每一个服务提供者的权重。</p><p>totalWeight 参数：多个具有相同最短响应时间的服务提供者对应的预热（预热这个点还是挺重要的，在下面讲最小活跃数负载均衡的时候有详细说明）权重之和。</p><p>firstWeight 参数：第一个具有最短响应时间的服务提供者的权重。</p><p>sameWeight 参数：多个满足条件的提供者的权重是否一致。</p><h2 id="标号为②的部分"><a href="#标号为②的部分" class="headerlink" title="标号为②的部分"></a>标号为②的部分</h2><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format6.png" alt="format6"></p><p>这一部分代码的关键，就在上面框起来的部分。而框起来的部分，最关键的地方，就在于第一行。</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format7.png" alt="format7"></p><p>获取调用成功的平均时间。</p><p>成功调用的平均时间怎么算的？</p><p>调用成功的请求数总数对应的总耗时 / 调用成功的请求数总数 = 成功调用的平均时间。</p><p>所以，在下面这个方法中，首先获取到了调用成功的请求数总数：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format8.png" alt="format8"></p><p>这个 succeeded 参数是怎么来的呢？</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format9.png" alt="format9"></p><p>答案就是：总的请求数减去请求失败的数量，就是请求成功的总数！</p><p>那么为什么不能直接获取请求成功的总数呢？</p><p>因为在 RpcStatus 里面没有这个参数。</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format10.png" alt="format10"></p><p>请求成功的总数我们有了，接下来成功总耗时怎么拿到的呢？</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format11.png" alt="format11"></p><p>答案就是：总的请求时间减去请求失败的总时间，就是请求成功的总耗时！</p><p>那么为什么不能直接获取请求成功的总耗时呢？</p><p>别问，问就是……</p><p>我们看一下 RpcStatus 中的这几个参数是在哪里维护的：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.dubbo.rpc.RpcStatus#endCount(org.apache.dubbo.rpc.RpcStatus, long, boolean)</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format12.png" alt="format12">其中的第二个入参是本次请求调用时长，第三个入参是本次调用是否成功。</p><p>具体的方法不必细说了吧，已经显而易见了。</p><p>再回去看框起来的那三行代码：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format13.png" alt="format13"></p><ol><li>第一行获取到了该服务提供者成功请求的平均耗时。</li><li>第二行获取的是该服务提供者的活跃数，也就是堆积的请求数。</li><li>第三行获取的就是如果当前这个请求发给这个服务提供者预计需要等待的时间。乘以 active 的原因是因为它需要排在堆积的请求的后面嘛。</li></ol><p>这里，我们就获取到了如果选择当前循环中的服务提供者的预计等待时间是多长。</p><p>后面的代码怎么写？</p><p>当然是出来一个更短的就把这个踢出去呀，或者出来一个一样长时间的就记录一下，接着去 pk 权重了。</p><p>所以，接下来 shortestIndexes 参数和 weights 参数就排上用场了：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format14.png" alt="format14"></p><p>另外，多说一句的，它里面有这样的一行注释：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format15.png" alt="format15"></p><p>和 LeastActiveLoadBalance 负载均衡策略一致，我给你截图对比一下：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format16.png" alt="format16">可以看到，确实是非常的相似，只是一个是判断谁的响应时间短，一个是判断谁的活跃数低。</p><h2 id="标号为③的地方"><a href="#标号为③的地方" class="headerlink" title="标号为③的地方"></a>标号为③的地方</h2><p>标号为③的地方是这样的：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format17.png" alt="format17"></p><p>里面参数的含义我们都知道了，所以，标号为③的地方的含义就很好解释了：经过选择后只有一个服务提供者满足条件。所以，直接使用这个服务提供者。</p><h1 id="标号为④的地方"><a href="#标号为④的地方" class="headerlink" title="标号为④的地方"></a>标号为④的地方</h1><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format18.png" alt="format18"></p><p>这个地方我就不展开讲了（后面的加权随机负载均衡那一小节有详细说明），熟悉的朋友一眼就看出来这是加权随机负载均衡的写法了。</p><p>不信？我给你对比一下：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format19.png" alt="format19"></p><p>你看，是不是一模一样的。</p><h1 id="标号为⑤的地方"><a href="#标号为⑤的地方" class="headerlink" title="标号为⑤的地方"></a>标号为⑤的地方</h1><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format20.png" alt="format20"></p><p>一行代码，没啥说的。就是从多个满足条件的且权重一样的服务提供者中随机选择一个。</p><p>如果一定要多说一句的话，我截个图吧：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format21.png" alt="format21"></p><p>可以看到，这行代码在最短响应时间、加权随机、最小活跃数负载均衡策略中都出现了，且都在最后一行。</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> 公众号开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于hexo+butterfly的个人博客搭建教程（三）基础配置篇</title>
      <link href="/2022/01/17/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3(%E4%B8%89)/"/>
      <url>/2022/01/17/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3(%E4%B8%89)/</url>
      
        <content type="html"><![CDATA[<h1 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h1><p>上文我们通过配置主题，发现博客内容已经有了很大的变化了</p><p>本文续接上文，对主题进行配置个性化主题。</p><h2 id="使用VsCode编辑主题-可选"><a href="#使用VsCode编辑主题-可选" class="headerlink" title="使用VsCode编辑主题(可选)"></a>使用VsCode编辑主题(可选)</h2><p>这里我们使用之前第一篇文章vscode，进行主题配置</p><p>打开vscode&gt;文件(右上角)&gt;打开文件夹（找到自己博客的路径）&gt;打开即可。</p><h2 id="语言"><a href="#语言" class="headerlink" title="语言"></a>语言</h2><p>修改项目配置文件 <code>_config.yml</code><br>默认语言是 en</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></span><br></pre></td></tr></table></figure><p>主题支持三种语言：</p><ol><li>default(en)</li><li>zh-CN (简体中文)</li><li>zh-TW (繁体中文)</li></ol><h2 id="网站资料"><a href="#网站资料" class="headerlink" title="网站资料"></a>网站资料</h2><p>修改网站各种资料，例如标题、副标题和邮箱等个人资料，请修改项目目录的<code>_config.yml</code></p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format26.png" alt="format26"></p><h2 id="导航菜单"><a href="#导航菜单" class="headerlink" title="导航菜单"></a>导航菜单</h2><p>修改 主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="string">首页:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-home</span>    </span><br><span class="line">  <span class="string">文章:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="string">标签:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-tags</span></span><br><span class="line">  <span class="string">分类:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-folder-open</span></span><br><span class="line">  <span class="string">列表||fas</span> <span class="attr">fa-list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">音乐</span> <span class="string">||</span> <span class="string">/music/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-music</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">电影</span> <span class="string">||</span> <span class="string">/movies/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-video</span></span><br><span class="line">  <span class="string">友链:</span> <span class="string">/link/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-link</span></span><br><span class="line">  <span class="string">关于:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-heart</span></span><br></pre></td></tr></table></figure><p>必须是 <code>/xxx/</code>，后面 <code>||</code> 分开，然后写图标名<a href="https://fontawesome.com/icons?from=io">可以自定义的图标网</a>。</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>代码块中的所有功能只适用于 Hexo 默认的 highlight 渲染，如果使用第三方的渲染器，不一定会有效</p><h2 id="代码高亮主题"><a href="#代码高亮主题" class="headerlink" title="代码高亮主题"></a>代码高亮主题</h2><p>Butterfly 支持 6 种代码高亮样式, 自定义主题请查看<a href="https://demo.百度.me/posts/4aa8abbe/#%E4%BB%A3%E7%A2%BC%E9%AB%98%E4%BA%AE%E4%B8%BB%E9%A1%8C">自定义主题</a></p><ul><li>default</li><li>darker</li><li>pale night</li><li>light</li><li>ocean</li><li>mac</li><li>mac light</li></ul><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_theme:</span> <span class="string">light</span></span><br></pre></td></tr></table></figure><h2 id="代码复制"><a href="#代码复制" class="headerlink" title="代码复制"></a>代码复制</h2><p>Butterfly主题支持代码复制功能。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_copy:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="代码展开-关闭"><a href="#代码展开-关闭" class="headerlink" title="代码展开/关闭"></a>代码展开/关闭</h2><p>在默认情况下，代码框自动展开，可设置是否所有代码框都关闭状态，点击 <code>&gt;</code> 可展开代码</p><ul><li><p>true 全部代码框不展开，需点击 <code>&gt;</code> 打开</p></li><li><p>false 代码狂展开，有 <code>&gt;</code> 点击按钮</p></li><li><p>none 不显示 <code>&gt;</code> 按钮<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_shrink:</span> <span class="literal">true</span> <span class="comment">#代码框不展开，需点击 &#x27;&gt;&#x27; 打开</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="代码换行"><a href="#代码换行" class="headerlink" title="代码换行"></a>代码换行</h2><p>在默认情况下，<code>hexo-highlight</code> 在编译的时候不会实现代码自动换行。如果你不希望在代码块的区域里有横向滚动条的话，那么你可以考虑开启这个功能。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">code_word_wrap:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>然后找到 <code>Hexo</code> 配置文件<code>_config.yml</code>，将 <code>line_number</code> 改成 <code>false</code>:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">auto_detect:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">tab_replace:</span></span><br></pre></td></tr></table></figure><h2 id="社交图标"><a href="#社交图标" class="headerlink" title="社交图标"></a>社交图标</h2><p>社交图标即主页上个性标签下的各种社交账号关联。</p><blockquote><p>书写格式：<code>图标名：url || 描述性文字</code></p></blockquote><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">social:</span></span><br><span class="line">  <span class="attr">fab fa-github:</span> <span class="string">https://github.com/xxxxx</span> <span class="string">||</span> <span class="string">Github</span></span><br><span class="line">  <span class="attr">fas fa-envelope:</span> <span class="string">mailto:xxxxxx@gmail.com</span> <span class="string">||</span> <span class="string">Email</span></span><br></pre></td></tr></table></figure><p>图标名可在这寻找: <a href="https://fontawesome.com/icons?from=io">https://fontawesome.com/icons?from=io</a></p><h2 id="顶部图"><a href="#顶部图" class="headerlink" title="顶部图"></a>顶部图</h2><p>顶部图有 2 种配置：具体 url 和（留空，true 和 false，三个效果一样）</p><h3 id="page页"><a href="#page页" class="headerlink" title="page页"></a>page页</h3><p>当具体 url 时</p><p>主页的顶部图可以在主题配置文件中设置 index_img<br>archives 页的顶部图可以在主题配置文件中设置 archive_img<br>其他 page 页的顶部图可以在各自的 md 页面设置 front-matter 中的 top_img<br>页面如果没有设置各自的 top_img，则会显示 default_top_img 图片<br>设置留空， true 和 false<br>主页会显示纯颜色的顶部图，其他 page 的顶部图没有设置时，也会显示纯颜色的顶部图</p><h3 id="post页"><a href="#post页" class="headerlink" title="post页"></a>post页</h3><p>post 页的顶部图会优先显示各自<code>front-matter</code>中的<code>top_img</code>, 如果没有设置，则会缩略图（即各自 front-matter 中的 cover)，如果没有则会显示显示 <code>default_top_img</code> 图片</p><h2 id="文章置顶"><a href="#文章置顶" class="headerlink" title="文章置顶"></a>文章置顶</h2><p>要为文章置顶，你需要安装插件 (hexo-generator-index-pin-top 或者 hexo-generator-indexed)</p><p>如果使用 hexo-generator-index-pin-top, 需要先卸载掉 hexo-generator-index，然后在文章的 front-matter 区域里添加 top: true 属性来把这篇文章置顶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">npm</span> <span class="string">uninstall</span> <span class="string">hexo-generator-index</span> <span class="string">--save</span></span><br><span class="line"><span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-generator-index-pin-top</span> <span class="string">--save</span></span><br></pre></td></tr></table></figure><h2 id="文章封面"><a href="#文章封面" class="headerlink" title="文章封面"></a>文章封面</h2><p>文章的 markdown 文档上，在 Front-matter 添加cover, 并填上要显示的图片地址。</p><p>如果不配置 cover, 可以设置显示默认的 cover。<br>如果不想在首页显示 cover, 可以设置为 false。<br>修改主题配置文件_config.butterfly.yml：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cover:</span></span><br><span class="line">  <span class="comment"># 是否显示文章封面</span></span><br><span class="line">  <span class="attr">index_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">aside_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">archives_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 封面显示的位置</span></span><br><span class="line">  <span class="comment"># 三个值可配置 left , right , both</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">both</span></span><br><span class="line">  <span class="comment"># 当没有设置cover时，默认的封面显示</span></span><br><span class="line">  <span class="attr">default_cover:</span> <span class="comment"># 当配置多张图片时，会随机选择</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">图片地址1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">图片地址2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">图片地址3</span></span><br></pre></td></tr></table></figure><h2 id="文章页相关配置"><a href="#文章页相关配置" class="headerlink" title="文章页相关配置"></a>文章页相关配置</h2><h3 id="文章-meta-显示"><a href="#文章-meta-显示" class="headerlink" title="文章 meta 显示"></a>文章 meta 显示</h3><p>这个选项是用来显示文章的相关信息的。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><p>post_meta:<br>  page:<br>    date_type: both # created or updated or both 主页文章日期是创建日或者更新日或都显示<br>    categories: true # true or false 主页是否显示分类<br>    tags: true # true or false 主页是否显示标签<br>    label: true # true or false 显示描述性文字<br>  post:<br>    date_type: both # created or updated or both 文章页日期是创建日或者更新日或都显示<br>    categories: true # true or false 文章页是否显示分类<br>    tags: true # true or false 文章页是否显示标签<br>    label: true # true or false 显示描述性文字<br>在文章详情页顶部的资料，<code>date_type</code>: 可设置文章日期显示创建日期 (created) 或者更新日期 (updated) 或者两种都显示 (both)<br><code>categories</code> 是否显示分类<br>tags 是否显示标签</p><h2 id="文章版权"><a href="#文章版权" class="headerlink" title="文章版权"></a>文章版权</h2><p>为你的博客文章展示文章版权和许可协议。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post_copyright:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">decode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">license:</span> <span class="string">CC</span> <span class="string">BY-NC-SA</span> <span class="number">4.0</span></span><br><span class="line">  <span class="attr">license_url:</span> <span class="string">https://creativecommons.org/licenses/by-nc-sa/4.0/</span></span><br></pre></td></tr></table></figure><p>如果有文章（例如：转载文章）不需要显示版权，可以在文章 Front-matter 单独设置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">copyright:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>从 3.0.0 开始，支持对单独文章设置版权信息，可以在文章 Front-matter 单独设置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">copyright:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">copyright_author:</span> <span class="string">xxxx</span></span><br><span class="line"><span class="attr">copyright_author_href:</span> <span class="string">https://xxxxxx.com</span></span><br><span class="line"><span class="attr">copyright_url:</span> <span class="string">https://xxxxxx.com</span></span><br><span class="line"><span class="attr">copyright_info:</span> <span class="string">此文章版权归xxxxx所有，如有转载，请注明来自原作者</span></span><br></pre></td></tr></table></figure><h2 id="文章打赏"><a href="#文章打赏" class="headerlink" title="文章打赏"></a>文章打赏</h2><p>在你每篇文章的结尾，可以添加打赏按钮。相关二维码可以自行配置。对于没有提供二维码的，可配置一张软件的 icon 图片，然后在 link 上添加相应的打赏链接。用户点击图片就会跳转到链接去。link 可以不写，会默认为图片的链接。<br>修改主题配置文件_config.butterfly.yml：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">reward:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">QR_code:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">img:</span> <span class="string">/image/wechat.jpg</span></span><br><span class="line">      <span class="attr">link:</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">微信</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">img:</span> <span class="string">/image/alipay.jpg</span></span><br><span class="line">      <span class="attr">link:</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">支付宝</span></span><br></pre></td></tr></table></figure><h2 id="TOC目录"><a href="#TOC目录" class="headerlink" title="TOC目录"></a>TOC目录</h2><p>在文章页，会有一个目录，用于显示 TOC。</p><ul><li>enable: 是否显示 TOC</li><li>number: 是否显示章节数</li><li>auto_open: 可选择进入文章页面时，是否自动打开 sidebar 显示 TOC</li></ul><p>修改主题配置文件<code>_config.butterfly.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">toc:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">auto_open:</span> <span class="literal">true</span> <span class="comment"># auto open the sidebar</span></span><br></pre></td></tr></table></figure><p>为特定的文章配置<br>在你的文章 md 文件的头部，Front-matter 中加入 toc_number、toc 和 auto_open，并配置 true 或者 false 即可。<br>主题会优先判断文章 Markdown 的 Front-matter 是否有配置，如有，则以 Front-matter 的配置为准。否则，以主题配置文件中的配置为准相关文章</p><h2 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h2><p>相关文章推荐的原理是根据文章 tags 的比重来推荐<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">related_post:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">6</span> <span class="comment"># 显示推荐文章数目</span></span><br><span class="line">  <span class="attr">date_type:</span> <span class="string">created</span> <span class="comment"># or created or updated 文章日期显示创建日或者更新日</span></span><br></pre></td></tr></table></figure><h2 id="文章锚点"><a href="#文章锚点" class="headerlink" title="文章锚点"></a>文章锚点</h2><p>开启文章锚点后，当你在文章页进行滚动时，文章链接会根据标题 ID 进行替换<br>(注意：每替换一次，会留下一个歷史记录。所以如果一篇文章有很多锚点的话，网页的歷史记录会很多。)<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor: <span class="keyword">true</span></span><br></pre></td></tr></table></figure><h2 id="文章过期提醒"><a href="#文章过期提醒" class="headerlink" title="文章过期提醒"></a>文章过期提醒</h2><p>可设置是否显示文章过期提醒，以更新时间为基准。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">noticeOutdate:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">flat</span> <span class="comment"># style: simple/flat</span></span><br><span class="line">  <span class="attr">limit_day:</span> <span class="number">365</span> <span class="comment"># When will it be shown</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">top</span> <span class="comment"># position: top/bottom</span></span><br><span class="line">  <span class="attr">message_prev:</span> <span class="string">It</span> <span class="string">has</span> <span class="string">been</span></span><br><span class="line">  <span class="attr">message_next:</span> <span class="string">days</span> <span class="string">since</span> <span class="string">the</span> <span class="string">last</span> <span class="string">update,</span> <span class="string">the</span> <span class="string">content</span> <span class="string">of</span> <span class="string">the</span> <span class="string">article</span> <span class="string">may</span> <span class="string">be</span> <span class="string">outdated.</span></span><br></pre></td></tr></table></figure><p><strong>limit_day：</strong> 距离更新时间多少天才显示文章过期提醒<br><strong>message_prev：</strong> 距离更新时间多少天才显示文章过期提醒<br><strong>message_next：</strong> 天数之后的文字</p><h2 id="头像"><a href="#头像" class="headerlink" title="头像"></a>头像</h2><p>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">avatar:</span>  </span><br><span class="line"><span class="attr">img:</span> <span class="string">/img/avatar.png</span>  </span><br><span class="line"><span class="attr">effect:</span> <span class="literal">true</span> <span class="string">*#</span> <span class="string">头像会一直转圈*</span></span><br></pre></td></tr></table></figure><h2 id="复制相关配置"><a href="#复制相关配置" class="headerlink" title="复制相关配置"></a>复制相关配置</h2><p>可配置网站是否可以复制、复制的内容是否添加版权信息</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">copy:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 是否开启网站复制权限</span></span><br><span class="line">  <span class="attr">copyright:</span> <span class="comment"># 复制的内容后面加上版权信息</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 是否开启复制版权信息添加</span></span><br><span class="line">    <span class="attr">limit_count:</span> <span class="number">50</span> <span class="comment"># 字数限制，当复制文字大于这个字数限制时，将在复制的内容后面加上版权信息</span></span><br></pre></td></tr></table></figure><p>添加版权后复制内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">作者: runyu</span><br><span class="line">链接: http://localhost:4000/posts/博客搭建</span><br><span class="line">来源: 个人博客</span><br><span class="line">着作权归作者所有。商业转载请联络作者获得授权，非商业转载请註明出处。</span><br></pre></td></tr></table></figure><h2 id="Footer-设置项目年份"><a href="#Footer-设置项目年份" class="headerlink" title="Footer 设置项目年份"></a>Footer 设置项目年份</h2><p>since 是一个来展示你站点起始时间的选项。它位于页面的最底部。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="attr">owner:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">since:</span> <span class="number">2022</span></span><br></pre></td></tr></table></figure><h2 id="页脚自定义文本"><a href="#页脚自定义文本" class="headerlink" title="页脚自定义文本"></a>页脚自定义文本</h2><p>custom_text 是一个给你用来在页脚自定义文本的选项。通常你可以在这里写声明文本等。支持 HTML。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">custom_text:</span> <span class="string">Hi,</span> <span class="string">welcome</span> <span class="string">to</span> <span class="string">my</span> <span class="string">&lt;a</span> <span class="string">href=&quot;&quot;&gt;博客&lt;/a&gt;!</span> <span class="comment"># 也叫自定义文本</span></span><br></pre></td></tr></table></figure><h2 id="ICP"><a href="#ICP" class="headerlink" title="ICP"></a>ICP</h2><p>对于部分有备案的域名，可以在 ICP 配置显示。<br>修改主题配置文件_config.butterfly.yml：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ICP:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">http://www.beian.miit.gov.cn/state/outPortal/loginPortal.action</span></span><br><span class="line">  <span class="attr">text:</span> <span class="string">粤ICP备xxxx</span></span><br><span class="line">  <span class="attr">icon:</span> <span class="string">/img/icp.png</span></span><br></pre></td></tr></table></figure><h2 id="右下角按钮简繁转换"><a href="#右下角按钮简繁转换" class="headerlink" title="右下角按钮简繁转换"></a>右下角按钮简繁转换</h2><p>简体繁体互换, 右下角会有简繁转换按钮。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><p>translate:<br>  enable: true</p><h2 id="默认按钮显示文字-网站是简体，应设置为’default-繁’"><a href="#默认按钮显示文字-网站是简体，应设置为’default-繁’" class="headerlink" title="默认按钮显示文字(网站是简体，应设置为’default: 繁’)"></a>默认按钮显示文字(网站是简体，应设置为’default: 繁’)</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">default:</span> <span class="string">简</span></span><br><span class="line"><span class="comment">#网站默认语言，1: 繁体中文, 2: 简体中文</span></span><br><span class="line"><span class="attr">defaultEncoding:</span> <span class="number">1</span></span><br><span class="line"><span class="comment">#延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0</span></span><br><span class="line"><span class="attr">translateDelay:</span> <span class="number">0</span></span><br><span class="line"><span class="comment">#当文字是简体时，按钮显示的文字</span></span><br><span class="line"><span class="attr">msgToTraditionalChinese:</span> <span class="string">&quot;繁&quot;</span></span><br><span class="line"><span class="comment">#当文字是繁体时，按钮显示的文字</span></span><br><span class="line"><span class="attr">msgToSimplifiedChinese:</span> <span class="string">&quot;简&quot;</span></span><br></pre></td></tr></table></figure><h2 id="夜间模式"><a href="#夜间模式" class="headerlink" title="夜间模式"></a>夜间模式</h2><p>右下角会有夜间模式按钮<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">darkmode:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># dark mode和 light mode切换按钮</span></span><br><span class="line">  <span class="attr">button:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">autoChangeMode:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="阅读模式"><a href="#阅读模式" class="headerlink" title="阅读模式"></a>阅读模式</h2><p>阅读模式下会去掉除文章外的内容，避免干扰阅读。只会出现在文章页面，右下角会有阅读模式按钮。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">readmode:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="侧边排版"><a href="#侧边排版" class="headerlink" title="侧边排版"></a>侧边排版</h2><p>可自行决定哪个项目需要显示，可决定位置，也可以设置不显示侧边栏。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">aside:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">true</span> <span class="comment"># 手机页面（ 显示宽度 &lt; 768px ）是否显示aside内容</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">right</span> <span class="comment"># left or right</span></span><br><span class="line">  <span class="attr">card_author:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">description:</span></span><br><span class="line">    <span class="attr">button:</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">Github</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://github.com/百度127/hexo-theme-butterfly</span></span><br><span class="line">  <span class="attr">card_announcement:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">This</span> <span class="string">is</span> <span class="string">my</span> <span class="string">Blog</span></span><br><span class="line">  <span class="attr">card_recent_post:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">5</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">sort:</span> <span class="string">date</span> <span class="comment"># date or updated</span></span><br><span class="line">  <span class="attr">card_categories:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">8</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">expand:</span> <span class="string">none</span> <span class="comment"># none/true/false</span></span><br><span class="line">  <span class="attr">card_tags:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">40</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">color:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">card_archives:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">monthly</span> <span class="comment"># yearly or monthly</span></span><br><span class="line">    <span class="attr">format:</span> <span class="string">MMMM</span> <span class="string">YYYY</span> <span class="comment"># eg: YYYY年MM月</span></span><br><span class="line">    <span class="attr">order:</span> <span class="number">-1</span> <span class="comment"># Sort of order. 1, asc for ascending; -1, desc for descending</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">8</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">  <span class="attr">card_webinfo:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="访问人数"><a href="#访问人数" class="headerlink" title="访问人数"></a>访问人数</h2><p>访问 <a href="http://busuanzi.ibruce.info/">busuanzi</a> 的官方网站查看更多的介绍。<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">busuanzi:</span></span><br><span class="line">  <span class="attr">site_uv:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">site_pv:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">page_pv:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="运行时间"><a href="#运行时间" class="headerlink" title="运行时间"></a>运行时间</h2><p>网页已运行时间<br>修改主题配置文件<code>_config.butterfly.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">runtimeshow:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">publish_date:</span> <span class="number">10</span><span class="string">/1/2022</span> <span class="number">00</span><span class="string">:00:00</span>  </span><br><span class="line">  <span class="comment">##网页开通时间</span></span><br><span class="line">  <span class="comment">#格式: 月/日/年 时间</span></span><br><span class="line">  <span class="comment">#也可以写成 年/月/日 时间</span></span><br></pre></td></tr></table></figure><h2 id="Gallery-相册图库"><a href="#Gallery-相册图库" class="headerlink" title="Gallery 相册图库"></a>Gallery 相册图库</h2><p>一个图库集合。<br><strong>写法</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;div</span> <span class="string">class=&quot;gallery-group-main&quot;&gt;</span></span><br><span class="line">&#123;<span class="string">%</span> <span class="string">galleryGroup</span> <span class="string">name</span> <span class="string">description</span> <span class="string">link</span> <span class="string">img-url</span> <span class="string">%</span>&#125;</span><br><span class="line">&#123;<span class="string">%</span> <span class="string">galleryGroup</span> <span class="string">name</span> <span class="string">description</span> <span class="string">link</span> <span class="string">img-url</span> <span class="string">%</span>&#125;</span><br><span class="line">&#123;<span class="string">%</span> <span class="string">galleryGroup</span> <span class="string">name</span> <span class="string">description</span> <span class="string">link</span> <span class="string">img-url</span> <span class="string">%</span>&#125;</span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure><ul><li>name: 图库名字</li><li>description：图库描述</li><li>link：连接到对应相册的地址</li><li>img-url：图库封面的地址</li></ul><p>如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;div</span> <span class="string">class=&quot;gallery-group-main&quot;&gt;</span></span><br><span class="line">&#123;<span class="string">%</span> <span class="string">galleryGroup</span> <span class="string">&#x27;壁纸&#x27;</span> <span class="string">&#x27;收藏的一些壁纸&#x27;</span> <span class="string">&#x27;/Gallery/wallpaper&#x27;</span> <span class="string">https://i.loli.net/2019/11/10/T7Mu8Aod3egmC4Q.png</span> <span class="string">%</span>&#125;</span><br><span class="line">&#123;<span class="string">%</span> <span class="string">galleryGroup</span> <span class="string">&#x27;漫威&#x27;</span> <span class="string">&#x27;关于漫威的图片&#x27;</span> <span class="string">&#x27;/Gallery/marvel&#x27;</span> <span class="string">https://i.loli.net/2019/12/25/8t97aVlp4hgyBGu.jpg</span> <span class="string">%</span>&#125;</span><br><span class="line">&#123;<span class="string">%</span> <span class="string">galleryGroup</span> <span class="string">&#x27;OH MY GIRL&#x27;</span> <span class="string">&#x27;关于OH MY GIRL的图片&#x27;</span> <span class="string">&#x27;/Gallery/ohmygirl&#x27;</span> <span class="string">https://i.loli.net/2019/12/25/hOqbQ3BIwa6KWpo.jpg</span> <span class="string">%</span>&#125;</span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Gallery-相册"><a href="#Gallery-相册" class="headerlink" title="Gallery 相册"></a>Gallery 相册</h2><p>写法:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">%</span> <span class="string">gallery</span> <span class="string">%</span>&#125;</span><br><span class="line"><span class="string">markdown</span> <span class="string">图片格式</span></span><br><span class="line">&#123;<span class="string">%</span> <span class="string">endgallery</span> <span class="string">%</span>&#125;</span><br></pre></td></tr></table></figure><p>如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">%</span> <span class="string">gallery</span> <span class="string">%</span>&#125;</span><br><span class="line"><span class="type">![](https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg)</span></span><br><span class="line"><span class="type">![](https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg)</span></span><br><span class="line"><span class="type">![](https://i.loli.net/2019/12/25/gEy5Zc1Ai6VuO4N.jpg)</span></span><br><span class="line"><span class="type">![](https://i.loli.net/2019/12/25/d6QHbytlSYO4FBG.jpg)</span></span><br><span class="line"><span class="type">![](https://i.loli.net/2019/12/25/6nepIJ1xTgufatZ.jpg)</span></span><br><span class="line"><span class="type">![](https://i.loli.net/2019/12/25/E7Jvr4eIPwUNmzq.jpg)</span></span><br><span class="line"><span class="type">![](https://i.loli.net/2019/12/25/mh19anwBSWIkGlH.jpg)</span></span><br><span class="line"><span class="type">![](https://i.loli.net/2019/12/25/2tu9JC8ewpBFagv.jpg)</span></span><br><span class="line">&#123;<span class="string">%</span> <span class="string">endgallery</span> <span class="string">%</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="回答问题-tag-hide"><a href="#回答问题-tag-hide" class="headerlink" title="回答问题 tag-hide"></a>回答问题 tag-hide</h2><p>如果你想把一些文字、内容隐藏起来，并提供按钮让用户点击显示。可以使用这个。</p><div class="note success flat"><p>success inline</p></div><p>inline 在文本里面添加按钮隐藏内容，只限文字(content不能包含英文逗号)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">%</span> <span class="string">hideInline</span> <span class="string">content</span>,<span class="string">display</span>,<span class="string">bg</span>,<span class="string">color</span> <span class="string">%</span>&#125;</span><br></pre></td></tr></table></figure><ul><li>content: 文本内容</li><li>display: 按钮显示的文字 (可选)</li><li>bg: 按钮的背景颜色 (可选)</li><li>color: 按钮文字的颜色 (可选)</li></ul><p>例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">哪个英文字母最酷？ &#123;% hideInline 因为西装裤(C装酷),查看答案,#FF7242,#fff %&#125;</span><br><span class="line">门里站着一个人? &#123;% hideInline 闪 %&#125;</span><br></pre></td></tr></table></figure><p>绘图mermaid（饼状图、柱状图等）<br>使用 mermaid 标籤可以绘製 Flowchart（流程图）、Sequence diagram（时序图 ）、Class Diagram（类别图）、State Diagram（状态图）、Gantt（甘特图）和 Pie Chart（圆形图），具体可以查看 mermaid 文档<br>修改主题配置文件_config.butterfly.yml：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mermaid:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># built-in themes: default/forest/dark/neutral</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">default</span></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">%</span> <span class="string">mermaid</span> <span class="string">%</span>&#125;</span><br><span class="line"><span class="string">pie</span></span><br><span class="line">    <span class="string">title</span> <span class="string">Key</span> <span class="string">elements</span> <span class="string">in</span> <span class="string">Product</span> <span class="string">X</span></span><br><span class="line">    <span class="string">&quot;Calcium&quot;</span> <span class="string">:</span> <span class="number">42.96</span></span><br><span class="line">    <span class="string">&quot;Potassium&quot;</span> <span class="string">:</span> <span class="number">50.05</span></span><br><span class="line">    <span class="string">&quot;Magnesium&quot;</span> <span class="string">:</span> <span class="number">10.01</span></span><br><span class="line">    <span class="string">&quot;Iron&quot;</span> <span class="string">:</span>  <span class="number">5</span></span><br><span class="line">&#123;<span class="string">%</span> <span class="string">endmermaid</span> <span class="string">%</span>&#125;</span><br></pre></td></tr></table></figure><p>文章持续更新~</p>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
            <tag> hexo </tag>
            
            <tag> butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于hexo+butterfly的个人博客搭建教程（二） 快速入门篇</title>
      <link href="/2022/01/13/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3(%E4%BA%8C)/"/>
      <url>/2022/01/13/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3(%E4%BA%8C)/</url>
      
        <content type="html"><![CDATA[<p>接上文 原来 hexo 自带的主题使用的是landscape主题，为了让主题变得更好看，我们选择在官网找并更换主题 主题库：<a href="https://hexo.io/themes/">https://hexo.io/themes/</a><br>hexo-theme-butterfly 是基于 Molunerfinn 的 hexo-theme-melody 的基础上进行开发的。</p><p>这款主题非常好看，好用，功能十分齐全。本文将对butterfly 主题进行介绍。</p><h1 id="安装（快速开始）"><a href="#安装（快速开始）" class="headerlink" title="安装（快速开始）"></a>安装（快速开始）</h1><p>在您的项目根目录下：例如我的文件夹名称（hexoBlogX）</p><p>git clone -b master <a href="https://github.com/jerryc127/hexo-theme-butterfly.git">https://github.com/jerryc127/hexo-theme-butterfly.git</a> themes/butterfly<br><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format23.png" alt="format23"></p><p>出现如下图文件</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format24.png" alt="format24"></p><p>即为完成。</p><h2 id="应用主题"><a href="#应用主题" class="headerlink" title="应用主题"></a>应用主题</h2><p>修改站点配置文件<code>_config.yml</code>，把主题改为 <code>butterfly</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme: butterfly</span><br></pre></td></tr></table></figure><h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h2><p>如果沒有 pug 以及 stylus 的渲染器，还需要下载，否则在项目运行时会报错：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus --save</span><br></pre></td></tr></table></figure><h2 id="升级建议"><a href="#升级建议" class="headerlink" title="升级建议"></a>升级建议</h2><p>为了減少升级主题带来的不便，我们还需要做以下操作：请采用如下方式<br><strong>方式一：</strong><br>把主题文件夹中的 <code>_config.yml</code> 复制到 Hexo 根目录下，同时重命名为 <code>_config.butterfly.yml</code>。</p><p>将blog (你的博客文件夹名)/themes / Butterfly/config.yml 复制到 blog (你的博客文件夹名)/ _config.butterfly.yml (将_config.yml重命名)</p><h1 id="主题页面配置"><a href="#主题页面配置" class="headerlink" title="主题页面配置"></a>主题页面配置</h1><h2 id="Front-matter-选项详解"><a href="#Front-matter-选项详解" class="headerlink" title="Front-matter 选项详解"></a>Front-matter 选项详解</h2><p>Front-matter 是每个markdown文件最上方以 — 分隔的区域，用于指定文章的参数。</p><p>如果可选的参数，可根据自己的需要添加，不用全部都写在 markdown里， 是在每一个markdown文件里配置</p><h3 id="Page-Front-matter"><a href="#Page-Front-matter" class="headerlink" title="Page Front-matter"></a>Page Front-matter</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 【必填】页面标题</span><br><span class="line">date: 【必填】页面创建日期</span><br><span class="line">type: 【必填】标签、分类和友情链接三个页面必须填写</span><br><span class="line">updated: 【可选】页面更新日期</span><br><span class="line">comments: 【可选】页面评论模块(默认为true)</span><br><span class="line">description: 【可选】页面描述</span><br><span class="line">keywords: 【可选】页面关键字</span><br><span class="line">top_img: 【可选】页面顶部图片</span><br><span class="line">mathjax: 【可选】展示 mathjax (当设置 mathjax 的 per_page: false 时，才需要配置，默认 false)</span><br><span class="line">katex: 【可选】展示 katex (当设置 katex 的 per_page: false 时，才需要配置，默认 false)</span><br><span class="line">aside: 【可选】展示侧边栏 (默认 true)</span><br><span class="line">aplayer： 【可选】在需要的页面加载 aplayer 的 js 和 css, 请参考文章下面的音乐配置</span><br><span class="line">highlight_shrink： 【可选】配置代码框是否展开 (true/false)(默认设置为 highlight_shrink 的配置)</span><br></pre></td></tr></table></figure><h3 id="Post-Front-matter"><a href="#Post-Front-matter" class="headerlink" title="Post Front-matter"></a>Post Front-matter</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 【必需】文章标题</span><br><span class="line">date: 【必需】文章创建日期</span><br><span class="line">updated: 【可选】文章更新日期</span><br><span class="line">tags: 【可选】文章标签</span><br><span class="line">categories: 【可选】文章分类</span><br><span class="line">keywords: 【可选】文章关键字</span><br><span class="line">description: 【可选】文章描述</span><br><span class="line">top_img: 【可选】文章顶部图片</span><br><span class="line">comments： 【可选】显示文章评论模块 (默认 true)</span><br><span class="line">cover: 【可选】文章缩略图 (如果没有设置 top_img, 文章页顶部将显示缩略图，可设为 false / 图片地址 / 留空)</span><br><span class="line">toc: 【可选】显示文章 TOC (默认为设置中 toc 的 enable 配置)</span><br><span class="line">toc_number: 【可选】显示 toc_number (默认为设置中 toc 的 number 配置)</span><br><span class="line">auto_open: 【可选】是否自动打开 TOC (默认为设置中 toc 的 auto_open 配置)</span><br><span class="line">copyright: 【可选】显示文章版权模块 (默认为设置中 post_copyright 的 enable 配置)</span><br><span class="line">copyright_author: 【可选】文章版权模块的文章作者</span><br><span class="line">copyright_author_href: 【可选】文章版权模块的文章作者链接</span><br><span class="line">copyright_url: 【可选】文章版权模块的文章连结链接</span><br><span class="line">copyright_info: 【可选】文章版权模块的版权声明文字</span><br><span class="line">mathjax: 【可选】显示 mathjax (当设置 mathjax 的 per_page: false 时，才需要配置，默认 false)</span><br><span class="line">katex: 【可选】显示 katex (当设置 katex 的 per_page: false 时，才需要配置，默认 false)</span><br><span class="line">aplayer: 【可选】在需要的页面加载 aplayer 的 js 和 css, 请参考文章下面的音乐 配置</span><br><span class="line">highlight_shrink：【可选】配置代码框是否展开 (true/false)(默认为设置中 highlight_shrink 的配置)</span><br></pre></td></tr></table></figure><h2 id="标签页"><a href="#标签页" class="headerlink" title="标签页"></a>标签页</h2><p>在项目根目录下，在命令行输入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure><p>找到 <code>source/tags/index.md</code> 这个文件, 修改这个文件内容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 标签</span><br><span class="line">date: 2020-08-28 14:17:49</span><br><span class="line">type: &quot;tags&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure><h2 id="分类页"><a href="#分类页" class="headerlink" title="分类页"></a>分类页</h2><p>在项目根目录下，在命令行输入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page categories</span><br></pre></td></tr></table></figure><p>找到 <code>source/categories/index.md</code> 这个文件, 修改这个文件内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 分类</span><br><span class="line">date: 2020-08-28 14:17:49</span><br><span class="line">type: &quot;categories&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure><h2 id="友情链接"><a href="#友情链接" class="headerlink" title="友情链接"></a>友情链接</h2><p>在项目根目录下，在命令行输入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page link</span><br></pre></td></tr></table></figure><p>找到 <code>source/link/index.md</code> 这个文件, 修改这个文件内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 友情链接</span><br><span class="line">date: 2020-08-28 14:17:49</span><br><span class="line">type: &quot;link&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure><h2 id="新增友情链接"><a href="#新增友情链接" class="headerlink" title="新增友情链接"></a>新增友情链接</h2><p>在 Hexo 项目目录中的 source/_data，创建一个文件 link.yml, 并写入如下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">- class_name: 友情链接</span><br><span class="line">  class_desc: 那些人，那些事</span><br><span class="line">  link_list:</span><br><span class="line">    - name: JerryC</span><br><span class="line">      link: https://jerryc.me/</span><br><span class="line">      avatar: https://jerryc.me/image/avatar.png</span><br><span class="line">      descr: 今日事,今日毕</span><br><span class="line">    - name: Hexo</span><br><span class="line">      link: https://hexo.io/zh-tw/</span><br><span class="line">      avatar: https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg</span><br><span class="line">      descr: 快速、简单且强大的网誌框架</span><br><span class="line">- class_name: 网站</span><br><span class="line">  class_desc: 值得推荐的网站</span><br><span class="line">  link_list:</span><br><span class="line">    - name: Youtube</span><br><span class="line">      link: https://www.youtube.com/</span><br><span class="line">      avatar: https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png</span><br><span class="line">      descr: 视频网站</span><br><span class="line">    - name: Weibo</span><br><span class="line">      link: https://www.weibo.com/</span><br><span class="line">      avatar: https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png</span><br><span class="line">      descr: 中国最大社交分享平台</span><br><span class="line">    - name: Twitter</span><br><span class="line">      link: https://twitter.com/</span><br><span class="line">      avatar: https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png</span><br><span class="line">      descr: 社交分享平台</span><br></pre></td></tr></table></figure><p>可以按自己的友链修改<br>class_name 和 class_desc 支持 html 格式书写，如不需要，也可以留空。<br>友情链接界面也可以由用户自己自定义，只需要在友情链接的 md 档设置就行，以普通的 Markdown 格式书写。</p><p>命令提示符中依次输入</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>浏览器地址栏输入：<a href="http://localhost:4000/link/%E5%B0%B1%E5%8F%AF%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%A6%82%E4%B8%8B%E6%95%88%E6%9E%9C">http://localhost:4000/link/就可会出现如下效果</a><br><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format25.png" alt="format25"></p><p>音乐<br>音乐界面使用了插件 hexo-tag-aplayer<br>具体使用方法请参考插件<a href="https://github.com/MoePlayer/hexo-tag-aplayer/blob/master/docs/README-zh_cn.md">文档</a></p><p>电影<br>电影界面使用了插件 hexo-douban<br>具体使用方法请参考插件的<a href="https://github.com/mythsman/hexo-douban">文档</a>。<br>注意：hexo-douban 会主动生成页面，所以不需要自己创建。对应网页的 top_img 可以在主题配置文件中修改。<br>404页面<br>主题内置了一个简单的 404 页面，可在设置中开启</p><div class="note warning flat"><p>本地预览时，访问出错的网站是不会跳到 404 页面的。如需本地预览，请访问 <a href="http://localhost:4000/404.html">http://localhost:4000/404.html</a></p></div><p>修改配置文件_config.butterfly.yml:</p><h2 id="404页面"><a href="#404页面" class="headerlink" title="404页面"></a>404页面</h2><p>主题内置了一个简单的 404 页面，可在设置中开启</p><p>本地预览时，访问出错的网站是不会跳到 404 页面的。如需本地预览，请访问</p><p><a href="http://localhost:4000/404.html">http://localhost:4000/404.html</a></p><p>修改配置文件<code>_config.butterfly.yml</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 404页面</span><br><span class="line"># A simple 404 page</span><br><span class="line">error_404:</span><br><span class="line">  enable: true</span><br><span class="line">  subtitle: 页面没有找到</span><br><span class="line">  background: https://i.loli.net/2020/05/19/aKOcLiyPl2JQdFD.png</span><br></pre></td></tr></table></figure><p>404页面如下：</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/format22.png" alt="format22"></p>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
            <tag> hexo </tag>
            
            <tag> butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于hexo+butterfly的个人博客搭建教程（一） 环境搭建篇</title>
      <link href="/2022/01/10/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3(%E4%B8%80)/"/>
      <url>/2022/01/10/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3(%E4%B8%80)/</url>
      
        <content type="html"><![CDATA[<h1 id="为什么要搭建属于自己的博客"><a href="#为什么要搭建属于自己的博客" class="headerlink" title="为什么要搭建属于自己的博客"></a>为什么要搭建属于自己的博客</h1><p>问：为什么要搭建属于自己的博客呢？</p><p>答：在这里，可以定制自己的个人网站，分享自己的生活和经验，帮助到他人的同事，也能方便自己更好的找到自己想要的东西，防止知识的遗忘。同时还会有小小的成就感，并且可以提升自己的写作能力。</p><p>问：要收费吗？</p><p>答：当然是免费的。当然，如果你能不断的坚持，还能为你带来一点小小的收入。</p><p>有些对代码一无所知的朋友，即便没有编程基础，也能通过教程搭建自己的博客。当然来访的可能还有一些有编程能力的，对教程的内容不要吐槽啰嗦，自行略过，挑重点即可。那么接下来开始进行博客的搭建</p><h1 id="环境准备-针对Windows系统搭建"><a href="#环境准备-针对Windows系统搭建" class="headerlink" title="环境准备(针对Windows系统搭建)"></a>环境准备(针对Windows系统搭建)</h1><p>操作系统：Windows 10  </p><p>1：GitHub</p><p>2：Node.js</p><p>3：Hexo</p><p>4：VsCode(推荐)</p><p>以上环境，在自己的电脑配置好就可以开始搭建博客了。</p><h2 id="安装-Git"><a href="#安装-Git" class="headerlink" title="安装 Git"></a>安装 Git</h2><p>Git是一款免费、开源的分布式版本控制系统，用于敏捷高效地处理任何或小或大的项目。Git的读音为/gɪt/。 Git是一个开源的分布式版本控制系统，用以有效、高速的处理从很小到非常大的项目版本管理。</p><h3 id="Git安装"><a href="#Git安装" class="headerlink" title="Git安装"></a>Git安装</h3><p>点击 <a href="https://git-scm.com/">Git 官网</a>根据你电脑系统的配置信息，下载对应的安装程序。</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218150307923.png" alt="image-20220218150307923"></p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218150331712.png" alt="image-20220218150331712"></p><p>1 :下载好 Git 的安装包，开始安装，打开安装包，出现如图的界面，无脑下一步下一步就可以了。<img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218150348271.png" alt="image-20220218150348271"></p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16451679327135.png" alt="企业微信截图_16451679327135"></p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218150626778.png" alt="image-20220218150626778"></p><p>2 :安装完成后，进入桌面</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218151356038.png" alt="image-20220218151356038"></p><p>输入：git –version </p><p>​    git –version</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218151506884.png" alt="image-20220218151506884"></p><p>出现图示版本号即为成功~。</p><h3 id="注册自己的git账号"><a href="#注册自己的git账号" class="headerlink" title="注册自己的git账号"></a>注册自己的git账号</h3><p>点击<a href="http://github.com/">GIT官网</a>进入官网首页</p><p>1 ：点击Sign up</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218152221368.png" alt="image-20220218152221368"></p><p>2：输入自己的邮箱 点击下一步</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218153522936.png" alt="image-20220218153522936"></p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218155212666.png" alt="image-20220218155212666"></p><p>3 输入基本信息</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218155324491.png" alt="image-20220218155324491"></p><p>4选择免费版本</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218155414427.png" alt="image-20220218155414427"></p><p>出现如下界面就表示创建成功！</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218155433547.png" alt="image-20220218155433547"></p><h2 id="安装Node-js"><a href="#安装Node-js" class="headerlink" title="安装Node.js"></a>安装Node.js</h2><h3 id="进入Node-js官网"><a href="#进入Node-js官网" class="headerlink" title="进入Node.js官网"></a>进入<a href="https://nodejs.org/en/download/">Node.js</a>官网</h3><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218160321638.png" alt="image-20220218160321638"></p><p> 下载后点击安装</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218160433837.png" alt="image-20220218160433837"></p><p>选择自己的安装路径</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218161424318.png" alt="image-20220218161424318"></p><p> 依旧是无脑下一步下一步完成即可。 出现如下图表示安装成功</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218160956103.png" alt="image-20220218160956103"></p><p>打开命令提示符输入node -v 和 npm -v 出现版本号即为成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218160543156.png" alt="image-20220218160543156"></p><h3 id="配置环境变量（防止安装的模块和缓存都在系统盘c盘）"><a href="#配置环境变量（防止安装的模块和缓存都在系统盘c盘）" class="headerlink" title="配置环境变量（防止安装的模块和缓存都在系统盘c盘）"></a>配置环境变量（防止安装的模块和缓存都在系统盘c盘）</h3><p>配置全局安装的模块路径和缓存路径（不一定是安装路径） 在nodejs文件夹,创建 node_global 在nodejs文件夹,创建 node_cache</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218161623497.png" alt="image-20220218161623497"></p><p>创建好后，在命令提示符运行如下命令,输入回车即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set prefix &quot;D:\nodejs\node_global&quot;</span><br><span class="line">npm config set cache &quot;D:\nodejs\node_cache&quot;</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218162026857.png" alt="image-20220218162026857"></p><h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><ul><li><p>进入 “我的电脑”-右键-“属性”-“高级系统设置”-“高级”-“环境变量”</p></li><li><p>选择 系统变量 创建 NODE_PATH 变量</p><ul><li>变量名：<code>NODE_PATH</code></li><li>变量值：<code>D:\Program Files\nodejs\node_modules</code>(安装的路径)</li><li><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218162447899.png" alt="image-20220218162447899"></li></ul></li><li><p>在 系统变量 中 选择 <strong>Path</strong> 添加如下属性：</p></li><li><p>把前半部分的nodejs路径换成自己的nodejs的路径</p></li></ul><h3 id="测试安装"><a href="#测试安装" class="headerlink" title="测试安装"></a>测试安装</h3><p> 进入命令提示符 输入如下代码进行安装测试</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express -g</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218162910326.png" alt="image-20220218162910326"></p><p>在自己配置的D:\nodejs\node_global\node_modules （这是我的）出现express文件夹则表示成功</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218162823732.png" alt="image-20220218162823732"></p><h3 id="修改npm源"><a href="#修改npm源" class="headerlink" title="修改npm源"></a>修改npm源</h3><p>由于官方 NPM 源下载 包的速度太慢，所以我们将 NPM 的源 替换成 <code>淘宝源</code>，命令提示符运行如下命令即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><p>那么 Node.js的安装就完成了~。</p><h2 id="3：Hexo安装"><a href="#3：Hexo安装" class="headerlink" title="3：Hexo安装"></a>3：Hexo安装</h2><p>3.1    首先进入一个磁盘作为你博客文件的存放位置，然后新建一个文件夹，比如名为 testBlog 的文件夹，创建完后，先不要点进去，在此处点击鼠标右键，选择 <code>Git Bash Here</code>，然后依次输入如下命令</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218164115552.png" alt="image-20220218164115552"></p><p>右键 Git Bash Here 依次输入以下命令即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#1:hexo框架安装</span><br><span class="line">npm install -g hexo-cli</span><br><span class="line">#2:初始化文件夹</span><br><span class="line">hexo init &lt;新建文件夹的名称&gt;  </span><br><span class="line">#3:进入你的文件夹</span><br><span class="line">cd &lt;新建文件夹的名称&gt;</span><br><span class="line">#4:安装博客所需要的依赖文件</span><br><span class="line">npm install </span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218164606559.png" alt="image-20220218164606559"></p><p>安装完成后 输入如下命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g #生成文件</span><br><span class="line">hexo s #启动项目</span><br></pre></td></tr></table></figure><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218164852678.png" alt="image-20220218164852678"></p><p>在浏览器输入<a href="http://localhost:4000/">http://localhost:4000/</a> 出现如下样式则表明您的博客搭建完成啦~</p><p><img src="https://cienacloud-1301881073.cos.ap-shanghai.myqcloud.com/images/blog/image-20220218165112643.png" alt="image-20220218165112643"></p><h2 id="4：安装VsCode"><a href="#4：安装VsCode" class="headerlink" title="4：安装VsCode"></a>4：安装VsCode</h2><p>​                VsCode介绍  ：VSCode（全称：Visual Studio Code）是一款由微软开发且跨平台的免费源代码编辑器。该软件支持语法高亮、代码自动补全（又称 IntelliSense）、代码重构、查看定义功能，并且内置了命令行工具和 Git 版本控制系统。用户可以更改主题和键盘快捷方式实现个性化设置，也可以通过内置的扩展程序商店安装扩展以拓展软件功能。</p><p>VS Code 使用 Monaco Editor 作为其底层的代码编辑器。</p><p>在 2019 年的 Stack Overflow 组织的开发者调查中，Visual Studio Code 被认为是最受开发者欢迎的开发环境。</p><p>Visual Studio Code 默认支持非常多的编程语言，包括 JavaScript、TypeScript、CSS 和 HTML；也可以通过下载扩展支持 Python、C/C++、Java 和 Go 在内的其他语言。支持功能包括语法高亮、括号补全、代码折叠和代码片段；对于部分语言，可以使用 IntelliSense。Visual Studio Code 也支持调试 Node.js 程序。和 GitHub 的 Atom一样，Visual Studio Code 也基于 Electron 框架构建。</p><p>Visual Studio Code 支持同时打开多个目录，并将信息保存在工作区中以便复用。</p><p>作为跨平台的编辑器，Visual Studio Code 允许用户更改文件的代码页、换行符和编程语言。</p><p>使用此编辑器能够更好的帮助我们找到代码需要修改编辑的地方，提升自己的效率。</p><h3 id="安装VsCode"><a href="#安装VsCode" class="headerlink" title="安装VsCode"></a>安装<a href="https://code.visualstudio.com/Download">VsCode</a></h3><p><img src="http://www.cineacloud.cloud/che/createBlog/image-20220314170143849.png" alt="image-20220314170143849"></p><p><img src="http://www.cineacloud.cloud/che/createBlog/RdNbTSV.png" alt="img"></p><p>选中接受协议选项，然后点击 Next：</p><p><img src="http://www.cineacloud.cloud/che/createBlog/QS0i03A.png" alt="img"></p><p>选择安装路径，也可以直接使用默认的：</p><p><img src="http://www.cineacloud.cloud/che/createBlog/PJQW7JX.png" alt="img"></p><p>点击 Next：</p><p><img src="http://www.cineacloud.cloud/che/createBlog/uETeoPN.png" alt="img"></p><p>注意安装路径设置、环境变量默认自动添加到系统中，勾选以下所有选项：</p><p><img src="http://www.cineacloud.cloud/che/createBlog/RM04TZb.png" alt="img"></p><p>最后我们点击 Install 就可以完成安装了：</p><p><img src="http://www.cineacloud.cloud/che/createBlog/4ySmHjw.png" alt="img"></p><p><img src="http://www.cineacloud.cloud/che/createBlog/a0SB4Wc.png" alt="img"></p><hr><h2 id="安装汉化包"><a href="#安装汉化包" class="headerlink" title="安装汉化包"></a>安装汉化包</h2><p>VScode 安装汉化包很简单，打开 VScode，点击安装扩展，在搜索框输入 Chinese，然后点 Install 就可以：</p><p><img src="http://www.cineacloud.cloud/che/createBlog/8F3353F0-343A-4469-8EEB-DAD1A050BA2F.jpeg" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客搭建 </tag>
            
            <tag> hexo </tag>
            
            <tag> butterfly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>amr文件转换为mp3文件</title>
      <link href="/2022/01/10/amr%E8%BD%AC%E6%8D%A2%E6%88%90MP3/"/>
      <url>/2022/01/10/amr%E8%BD%AC%E6%8D%A2%E6%88%90MP3/</url>
      
        <content type="html"><![CDATA[<h1 id="微信公众号录音文件-amr文件转mp3"><a href="#微信公众号录音文件-amr文件转mp3" class="headerlink" title="微信公众号录音文件(amr文件转mp3)"></a>微信公众号录音文件(amr文件转mp3)</h1><p><strong>音频转码工具，主要用于将微信语音 amr 格式转换为 mp3 格式以便在 html5 的 audio 标签中进行播放</strong></p><p>1.调用微信提供的接口获取录音的InputStream字节流</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> InputStream <span class="title">getInputStream</span><span class="params">(String mediaId)</span> </span>&#123;</span><br><span class="line">    InputStream is = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String URL_DOWNLOAD_TEMP_MEDIA = <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/media/get?access_token=ACCESS_TOKEN&amp;media_id=MEDIA_ID&quot;</span>;</span><br><span class="line">        String url = URL_DOWNLOAD_TEMP_MEDIA.replace(<span class="string">&quot;ACCESS_TOKEN&quot;</span>, <span class="string">&quot;自己写代码获取accessToken&quot;</span>).replace(<span class="string">&quot;MEDIA_ID&quot;</span>, mediaId);</span><br><span class="line">        URL urlGet = <span class="keyword">new</span> URL(url);</span><br><span class="line">        HttpURLConnection http = (HttpURLConnection) urlGet.openConnection();</span><br><span class="line">        http.setRequestMethod(<span class="string">&quot;GET&quot;</span>); <span class="comment">// 必须是get方式请求</span></span><br><span class="line">        http.setRequestProperty(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">        http.setDoOutput(<span class="keyword">true</span>);</span><br><span class="line">        http.setDoInput(<span class="keyword">true</span>);</span><br><span class="line">        System.setProperty(<span class="string">&quot;sun.net.client.defaultConnectTimeout&quot;</span>, <span class="string">&quot;30000&quot;</span>);<span class="comment">// 连接超时30秒</span></span><br><span class="line">        System.setProperty(<span class="string">&quot;sun.net.client.defaultReadTimeout&quot;</span>, <span class="string">&quot;30000&quot;</span>); <span class="comment">// 读取超时30秒</span></span><br><span class="line">        http.connect();</span><br><span class="line">        <span class="comment">// 获取文件转化为byte流</span></span><br><span class="line">        is = http.getInputStream();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> is;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.将获取到的字节流保存为amr文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">downloadMediaId</span><span class="params">(HttpServletRequest request, String mediaId)</span> </span>&#123;</span><br><span class="line">    String relfilePath = <span class="keyword">null</span>;</span><br><span class="line">    InputStream inputStream = getInputStream(mediaId);</span><br><span class="line">    FileOutputStream fileOutputStream = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//服务器资源保存路径</span></span><br><span class="line">        String savePath = request.getSession().getServletContext().getRealPath(<span class="string">&quot;/&quot;</span>) + <span class="string">&quot;upload/&quot;</span> + DateUtil.getYear() + <span class="string">&quot;/wxmedia/audio/&quot;</span>;</span><br><span class="line">        savePath = savePath + <span class="string">&quot;audio/&quot;</span>; </span><br><span class="line">        String filename = String.valueOf(System.currentTimeMillis()) + <span class="string">&quot;.amr&quot;</span>;</span><br><span class="line">        relfilePath = <span class="string">&quot;upload/&quot;</span> + DateUtil.getYear() + <span class="string">&quot;/wxmedia/audio/&quot;</span> + filename;</span><br><span class="line">        File file = <span class="keyword">new</span> File(savePath);</span><br><span class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">            file.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">        fileOutputStream = <span class="keyword">new</span> FileOutputStream(savePath + filename);</span><br><span class="line">        <span class="keyword">while</span> ((len = inputStream.read(data)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 判断结果是否有错</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span> String(data).indexOf(<span class="string">&quot;errmsg&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            fileOutputStream.write(data, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStream.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (fileOutputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fileOutputStream.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> relfilePath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3.将保存的amr文件转成mp3文件</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">amrToMp3</span><span class="params">(String sourcePath, String targetPath)</span> </span>&#123;</span><br><span class="line">    File source = <span class="keyword">new</span> File(sourcePath);</span><br><span class="line">    File target = <span class="keyword">new</span> File(targetPath);</span><br><span class="line">    AudioUtils.amrToMp3(source, target);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4.所需的jar包依赖</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!--amr文件转音频map文件--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.dadiyang&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jave&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.0</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h1 id="音频转码工具"><a href="#音频转码工具" class="headerlink" title="音频转码工具"></a>音频转码工具</h1><p>支持 Linux/Windows/Mac 平台</p><p>因为是基于 JAVE 项目的修改，而 JAVE 是依赖 ffmpeg 所以可以适用于所有 ffmpeg 所支持的文件格式的转换。具体可以查看 JAVE 官方文档</p><h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><ol><li>初始化时判断当前运行环境，将bin目录中对应的 ffmpeg 可执行文件拷贝到临时目录中</li><li>根据文件类型及配置通过 Runtime.getRuntime().exec(cmd) 执行 ffmpeg 对应的转码命令</li></ol><h1 id="JAVE-项目的问题"><a href="#JAVE-项目的问题" class="headerlink" title="JAVE 项目的问题"></a>JAVE 项目的问题</h1><p>ffmpeg 是依赖运行环境的，JAVE 项目封装了ffmpeg，它通过上述的原理使 java 可以调用ffmpeg而且支持跨平台。</p><ol><li>项目老旧没再维护。官网最近版本是2009年发布的，其依赖的ffmpeg早已过时，很多情况下用不了。</li><li>转码一直报异常 EncoderException: Stream mapping</li><li>没有发布maven仓库，而且 JAVE 本身也不是一个maven项目</li><li>不支持mac</li></ol><h1 id="本项目特点"><a href="#本项目特点" class="headerlink" title="本项目特点"></a>本项目特点</h1><p>本项目为解决上述问题而生。</p><ul><li>这是一个maven项目，而且已发布到中央仓库。</li><li>项目依赖的 ffmpeg 可执行文件经过验证可以使用（单元测试中提供了一个简单的检验方法）</li><li>解决了amr转mp3出现的 EncoderException: Stream mapping</li><li>支持 Linux/Windows/Mac 平台</li></ul><h1 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h1><p>如果程序无法通过拷贝资源文件的方式获取到 ffmpeg 的可执行文件或者内置的 ffmpeg 不支持你所使用的操作系统</p><p>你可以通过环境变量或者在 java 中设置 <code>System.setProperty(&quot;ffmpeg.home&quot;, &quot;ffmpeg可执行文件所在的目录&quot;)</code> 的方式指定你的系统中安装的可用的 ffmpeg 文件的目录</p><p>如 <code>System.setProperty(&quot;ffmpeg.home&quot;, &quot;/usr/local/bin/&quot;)</code></p><p>作者：llsydn<br>链接：<a href="https://juejin.cn/post/6994592524232818695">https://juejin.cn/post/6994592524232818695</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> 公众号开发 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
